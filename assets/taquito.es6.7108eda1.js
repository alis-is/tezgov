import{J as ha}from"./main.a3e23e34.js";import{B as V,L as la}from"./taquito-local-forging.es6.408ecfeb.js";import{j as q,V as L,h as Z,k as Ue,l as pa,m as Vi,n as fa,o as wn,q as da,r as ga,P as ue,e as ma,p as ya,s as Sn,t as Zi,u as ba,w as $s,x as Pr,I as Ms,i as ze,y as va,z as Bs,A as Vs,D as Ds,B as Ea}from"./taquito-utils.es6.d10e4807.js";var ks={exports:{}},tn={exports:{}},Fs=function(t,e){return function(){for(var n=new Array(arguments.length),s=0;s<n.length;s++)n[s]=arguments[s];return t.apply(e,n)}},wa=Fs,Oe=Object.prototype.toString;function en(r){return Array.isArray(r)}function Di(r){return typeof r>"u"}function Sa(r){return r!==null&&!Di(r)&&r.constructor!==null&&!Di(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function Hs(r){return Oe.call(r)==="[object ArrayBuffer]"}function Oa(r){return Oe.call(r)==="[object FormData]"}function _a(r){var t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&Hs(r.buffer),t}function Ra(r){return typeof r=="string"}function Aa(r){return typeof r=="number"}function Us(r){return r!==null&&typeof r=="object"}function Ir(r){if(Oe.call(r)!=="[object Object]")return!1;var t=Object.getPrototypeOf(r);return t===null||t===Object.prototype}function Pa(r){return Oe.call(r)==="[object Date]"}function Ia(r){return Oe.call(r)==="[object File]"}function xa(r){return Oe.call(r)==="[object Blob]"}function Ks(r){return Oe.call(r)==="[object Function]"}function Na(r){return Us(r)&&Ks(r.pipe)}function Ta(r){return Oe.call(r)==="[object URLSearchParams]"}function La(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function Ca(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function rn(r,t){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),en(r))for(var e=0,i=r.length;e<i;e++)t.call(null,r[e],e,r);else for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.call(null,r[n],n,r)}function ki(){var r={};function t(n,s){Ir(r[s])&&Ir(n)?r[s]=ki(r[s],n):Ir(n)?r[s]=ki({},n):en(n)?r[s]=n.slice():r[s]=n}for(var e=0,i=arguments.length;e<i;e++)rn(arguments[e],t);return r}function ja(r,t,e){return rn(t,function(n,s){e&&typeof n=="function"?r[s]=wa(n,e):r[s]=n}),r}function $a(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var ct={isArray:en,isArrayBuffer:Hs,isBuffer:Sa,isFormData:Oa,isArrayBufferView:_a,isString:Ra,isNumber:Aa,isObject:Us,isPlainObject:Ir,isUndefined:Di,isDate:Pa,isFile:Ia,isBlob:xa,isFunction:Ks,isStream:Na,isURLSearchParams:Ta,isStandardBrowserEnv:Ca,forEach:rn,merge:ki,extend:ja,trim:La,stripBOM:$a},Be=ct;function On(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Gs=function(t,e,i){if(!e)return t;var n;if(i)n=i(e);else if(Be.isURLSearchParams(e))n=e.toString();else{var s=[];Be.forEach(e,function(c,l){c===null||typeof c>"u"||(Be.isArray(c)?l=l+"[]":c=[c],Be.forEach(c,function(p){Be.isDate(p)?p=p.toISOString():Be.isObject(p)&&(p=JSON.stringify(p)),s.push(On(l)+"="+On(p))}))}),n=s.join("&")}if(n){var o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+n}return t},Ma=ct;function Qr(){this.handlers=[]}Qr.prototype.use=function(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1};Qr.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)};Qr.prototype.forEach=function(t){Ma.forEach(this.handlers,function(i){i!==null&&t(i)})};var Ba=Qr,Va=ct,Da=function(t,e){Va.forEach(t,function(n,s){s!==e&&s.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[s])})},qs=function(t,e,i,n,s){return t.config=e,i&&(t.code=i),t.request=n,t.response=s,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t},zs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ui,_n;function Ws(){if(_n)return ui;_n=1;var r=qs;return ui=function(e,i,n,s,o){var a=new Error(e);return r(a,i,n,s,o)},ui}var hi,Rn;function ka(){if(Rn)return hi;Rn=1;var r=Ws();return hi=function(e,i,n){var s=n.config.validateStatus;!n.status||!s||s(n.status)?e(n):i(r("Request failed with status code "+n.status,n.config,null,n.request,n))},hi}var li,An;function Fa(){if(An)return li;An=1;var r=ct;return li=r.isStandardBrowserEnv()?function(){return{write:function(i,n,s,o,a,c){var l=[];l.push(i+"="+encodeURIComponent(n)),r.isNumber(s)&&l.push("expires="+new Date(s).toGMTString()),r.isString(o)&&l.push("path="+o),r.isString(a)&&l.push("domain="+a),c===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(i){var n=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),li}var pi,Pn;function Ha(){return Pn||(Pn=1,pi=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}),pi}var fi,In;function Ua(){return In||(In=1,fi=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}),fi}var di,xn;function Ka(){if(xn)return di;xn=1;var r=Ha(),t=Ua();return di=function(i,n){return i&&!r(n)?t(i,n):n},di}var gi,Nn;function Ga(){if(Nn)return gi;Nn=1;var r=ct,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return gi=function(i){var n={},s,o,a;return i&&r.forEach(i.split(`
`),function(l){if(a=l.indexOf(":"),s=r.trim(l.substr(0,a)).toLowerCase(),o=r.trim(l.substr(a+1)),s){if(n[s]&&t.indexOf(s)>=0)return;s==="set-cookie"?n[s]=(n[s]?n[s]:[]).concat([o]):n[s]=n[s]?n[s]+", "+o:o}}),n},gi}var mi,Tn;function qa(){if(Tn)return mi;Tn=1;var r=ct;return mi=r.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a"),n;function s(o){var a=o;return e&&(i.setAttribute("href",a),a=i.href),i.setAttribute("href",a),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return n=s(window.location.href),function(a){var c=r.isString(a)?s(a):a;return c.protocol===n.protocol&&c.host===n.host}}():function(){return function(){return!0}}(),mi}var yi,Ln;function Zr(){if(Ln)return yi;Ln=1;function r(t){this.message=t}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,yi=r,yi}var bi,Cn;function jn(){if(Cn)return bi;Cn=1;var r=ct,t=ka(),e=Fa(),i=Gs,n=Ka(),s=Ga(),o=qa(),a=Ws(),c=zs,l=Zr();return bi=function(p){return new Promise(function(E,N){var F=p.data,A=p.headers,w=p.responseType,m;function G(){p.cancelToken&&p.cancelToken.unsubscribe(m),p.signal&&p.signal.removeEventListener("abort",m)}r.isFormData(F)&&delete A["Content-Type"];var P=new XMLHttpRequest;if(p.auth){var Er=p.auth.username||"",wr=p.auth.password?unescape(encodeURIComponent(p.auth.password)):"";A.Authorization="Basic "+btoa(Er+":"+wr)}var ut=n(p.baseURL,p.url);P.open(p.method.toUpperCase(),i(ut,p.params,p.paramsSerializer),!0),P.timeout=p.timeout;function _e(){if(!!P){var f="getAllResponseHeaders"in P?s(P.getAllResponseHeaders()):null,O=!w||w==="text"||w==="json"?P.responseText:P.response,_={data:O,status:P.status,statusText:P.statusText,headers:f,config:p,request:P};t(function(C){E(C),G()},function(C){N(C),G()},_),P=null}}if("onloadend"in P?P.onloadend=_e:P.onreadystatechange=function(){!P||P.readyState!==4||P.status===0&&!(P.responseURL&&P.responseURL.indexOf("file:")===0)||setTimeout(_e)},P.onabort=function(){!P||(N(a("Request aborted",p,"ECONNABORTED",P)),P=null)},P.onerror=function(){N(a("Network Error",p,null,P)),P=null},P.ontimeout=function(){var O=p.timeout?"timeout of "+p.timeout+"ms exceeded":"timeout exceeded",_=p.transitional||c;p.timeoutErrorMessage&&(O=p.timeoutErrorMessage),N(a(O,p,_.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",P)),P=null},r.isStandardBrowserEnv()){var ir=(p.withCredentials||o(ut))&&p.xsrfCookieName?e.read(p.xsrfCookieName):void 0;ir&&(A[p.xsrfHeaderName]=ir)}"setRequestHeader"in P&&r.forEach(A,function(O,_){typeof F>"u"&&_.toLowerCase()==="content-type"?delete A[_]:P.setRequestHeader(_,O)}),r.isUndefined(p.withCredentials)||(P.withCredentials=!!p.withCredentials),w&&w!=="json"&&(P.responseType=p.responseType),typeof p.onDownloadProgress=="function"&&P.addEventListener("progress",p.onDownloadProgress),typeof p.onUploadProgress=="function"&&P.upload&&P.upload.addEventListener("progress",p.onUploadProgress),(p.cancelToken||p.signal)&&(m=function(f){!P||(N(!f||f&&f.type?new l("canceled"):f),P.abort(),P=null)},p.cancelToken&&p.cancelToken.subscribe(m),p.signal&&(p.signal.aborted?m():p.signal.addEventListener("abort",m))),F||(F=null),P.send(F)})},bi}var rt=ct,$n=Da,za=qs,Wa=zs,Ja={"Content-Type":"application/x-www-form-urlencoded"};function Mn(r,t){!rt.isUndefined(r)&&rt.isUndefined(r["Content-Type"])&&(r["Content-Type"]=t)}function Ya(){var r;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(r=jn()),r}function Xa(r,t,e){if(rt.isString(r))try{return(t||JSON.parse)(r),rt.trim(r)}catch(i){if(i.name!=="SyntaxError")throw i}return(e||JSON.stringify)(r)}var ti={transitional:Wa,adapter:Ya(),transformRequest:[function(t,e){return $n(e,"Accept"),$n(e,"Content-Type"),rt.isFormData(t)||rt.isArrayBuffer(t)||rt.isBuffer(t)||rt.isStream(t)||rt.isFile(t)||rt.isBlob(t)?t:rt.isArrayBufferView(t)?t.buffer:rt.isURLSearchParams(t)?(Mn(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):rt.isObject(t)||e&&e["Content-Type"]==="application/json"?(Mn(e,"application/json"),Xa(t)):t}],transformResponse:[function(t){var e=this.transitional||ti.transitional,i=e&&e.silentJSONParsing,n=e&&e.forcedJSONParsing,s=!i&&this.responseType==="json";if(s||n&&rt.isString(t)&&t.length)try{return JSON.parse(t)}catch(o){if(s)throw o.name==="SyntaxError"?za(o,this,"E_JSON_PARSE"):o}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};rt.forEach(["delete","get","head"],function(t){ti.headers[t]={}});rt.forEach(["post","put","patch"],function(t){ti.headers[t]=rt.merge(Ja)});var nn=ti,Qa=ct,Za=nn,tc=function(t,e,i){var n=this||Za;return Qa.forEach(i,function(o){t=o.call(n,t,e)}),t},vi,Bn;function Js(){return Bn||(Bn=1,vi=function(t){return!!(t&&t.__CANCEL__)}),vi}var Vn=ct,Ei=tc,ec=Js(),rc=nn,ic=Zr();function wi(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new ic("canceled")}var nc=function(t){wi(t),t.headers=t.headers||{},t.data=Ei.call(t,t.data,t.headers,t.transformRequest),t.headers=Vn.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),Vn.forEach(["delete","get","head","post","put","patch","common"],function(n){delete t.headers[n]});var e=t.adapter||rc.adapter;return e(t).then(function(n){return wi(t),n.data=Ei.call(t,n.data,n.headers,t.transformResponse),n},function(n){return ec(n)||(wi(t),n&&n.response&&(n.response.data=Ei.call(t,n.response.data,n.response.headers,t.transformResponse))),Promise.reject(n)})},lt=ct,Ys=function(t,e){e=e||{};var i={};function n(h,p){return lt.isPlainObject(h)&&lt.isPlainObject(p)?lt.merge(h,p):lt.isPlainObject(p)?lt.merge({},p):lt.isArray(p)?p.slice():p}function s(h){if(lt.isUndefined(e[h])){if(!lt.isUndefined(t[h]))return n(void 0,t[h])}else return n(t[h],e[h])}function o(h){if(!lt.isUndefined(e[h]))return n(void 0,e[h])}function a(h){if(lt.isUndefined(e[h])){if(!lt.isUndefined(t[h]))return n(void 0,t[h])}else return n(void 0,e[h])}function c(h){if(h in e)return n(t[h],e[h]);if(h in t)return n(void 0,t[h])}var l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return lt.forEach(Object.keys(t).concat(Object.keys(e)),function(p){var y=l[p]||s,E=y(p);lt.isUndefined(E)&&y!==c||(i[p]=E)}),i},Si,Dn;function Xs(){return Dn||(Dn=1,Si={version:"0.26.1"}),Si}var sc=Xs().version,sn={};["object","boolean","number","function","string","symbol"].forEach(function(r,t){sn[r]=function(i){return typeof i===r||"a"+(t<1?"n ":" ")+r}});var kn={};sn.transitional=function(t,e,i){function n(s,o){return"[Axios v"+sc+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return function(s,o,a){if(t===!1)throw new Error(n(o," has been removed"+(e?" in "+e:"")));return e&&!kn[o]&&(kn[o]=!0,console.warn(n(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,o,a):!0}};function oc(r,t,e){if(typeof r!="object")throw new TypeError("options must be an object");for(var i=Object.keys(r),n=i.length;n-- >0;){var s=i[n],o=t[s];if(o){var a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new TypeError("option "+s+" must be "+c);continue}if(e!==!0)throw Error("Unknown option "+s)}}var ac={assertOptions:oc,validators:sn},Qs=ct,cc=Gs,Fn=Ba,Hn=nc,ei=Ys,Zs=ac,Ve=Zs.validators;function fr(r){this.defaults=r,this.interceptors={request:new Fn,response:new Fn}}fr.prototype.request=function(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=ei(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var i=e.transitional;i!==void 0&&Zs.assertOptions(i,{silentJSONParsing:Ve.transitional(Ve.boolean),forcedJSONParsing:Ve.transitional(Ve.boolean),clarifyTimeoutError:Ve.transitional(Ve.boolean)},!1);var n=[],s=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(e)===!1||(s=s&&E.synchronous,n.unshift(E.fulfilled,E.rejected))});var o=[];this.interceptors.response.forEach(function(E){o.push(E.fulfilled,E.rejected)});var a;if(!s){var c=[Hn,void 0];for(Array.prototype.unshift.apply(c,n),c=c.concat(o),a=Promise.resolve(e);c.length;)a=a.then(c.shift(),c.shift());return a}for(var l=e;n.length;){var h=n.shift(),p=n.shift();try{l=h(l)}catch(y){p(y);break}}try{a=Hn(l)}catch(y){return Promise.reject(y)}for(;o.length;)a=a.then(o.shift(),o.shift());return a};fr.prototype.getUri=function(t){return t=ei(this.defaults,t),cc(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")};Qs.forEach(["delete","get","head","options"],function(t){fr.prototype[t]=function(e,i){return this.request(ei(i||{},{method:t,url:e,data:(i||{}).data}))}});Qs.forEach(["post","put","patch"],function(t){fr.prototype[t]=function(e,i,n){return this.request(ei(n||{},{method:t,url:e,data:i}))}});var uc=fr,Oi,Un;function hc(){if(Un)return Oi;Un=1;var r=Zr();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var i;this.promise=new Promise(function(o){i=o});var n=this;this.promise.then(function(s){if(!!n._listeners){var o,a=n._listeners.length;for(o=0;o<a;o++)n._listeners[o](s);n._listeners=null}}),this.promise.then=function(s){var o,a=new Promise(function(c){n.subscribe(c),o=c}).then(s);return a.cancel=function(){n.unsubscribe(o)},a},e(function(o){n.reason||(n.reason=new r(o),i(n.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]},t.prototype.unsubscribe=function(i){if(!!this._listeners){var n=this._listeners.indexOf(i);n!==-1&&this._listeners.splice(n,1)}},t.source=function(){var i,n=new t(function(o){i=o});return{token:n,cancel:i}},Oi=t,Oi}var _i,Kn;function lc(){return Kn||(Kn=1,_i=function(t){return function(i){return t.apply(null,i)}}),_i}var Ri,Gn;function pc(){if(Gn)return Ri;Gn=1;var r=ct;return Ri=function(e){return r.isObject(e)&&e.isAxiosError===!0},Ri}var qn=ct,fc=Fs,xr=uc,dc=Ys,gc=nn;function to(r){var t=new xr(r),e=fc(xr.prototype.request,t);return qn.extend(e,xr.prototype,t),qn.extend(e,t),e.create=function(n){return to(dc(r,n))},e}var Gt=to(gc);Gt.Axios=xr;Gt.Cancel=Zr();Gt.CancelToken=hc();Gt.isCancel=Js();Gt.VERSION=Xs().version;Gt.all=function(t){return Promise.all(t)};Gt.spread=lc();Gt.isAxiosError=pc();tn.exports=Gt;tn.exports.default=Gt;(function(r){r.exports=tn.exports})(ks);const zn=ha(ks.exports);function mc(r,t,e,i){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{l(i.next(h))}catch(p){o(p)}}function c(h){try{l(i.throw(h))}catch(p){o(p)}}function l(h){h.done?s(h.value):n(h.value).then(a,c)}l((i=i.apply(r,t||[])).next())})}var cr;(function(r){r[r.CONTINUE=100]="CONTINUE",r[r.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",r[r.PROCESSING=102]="PROCESSING",r[r.OK=200]="OK",r[r.CREATED=201]="CREATED",r[r.ACCEPTED=202]="ACCEPTED",r[r.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",r[r.NO_CONTENT=204]="NO_CONTENT",r[r.RESET_CONTENT=205]="RESET_CONTENT",r[r.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",r[r.MULTI_STATUS=207]="MULTI_STATUS",r[r.ALREADY_REPORTED=208]="ALREADY_REPORTED",r[r.IM_USED=226]="IM_USED",r[r.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",r[r.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",r[r.FOUND=302]="FOUND",r[r.SEE_OTHER=303]="SEE_OTHER",r[r.NOT_MODIFIED=304]="NOT_MODIFIED",r[r.USE_PROXY=305]="USE_PROXY",r[r.SWITCH_PROXY=306]="SWITCH_PROXY",r[r.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",r[r.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",r[r.BAD_REQUEST=400]="BAD_REQUEST",r[r.UNAUTHORIZED=401]="UNAUTHORIZED",r[r.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",r[r.FORBIDDEN=403]="FORBIDDEN",r[r.NOT_FOUND=404]="NOT_FOUND",r[r.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",r[r.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",r[r.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",r[r.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",r[r.CONFLICT=409]="CONFLICT",r[r.GONE=410]="GONE",r[r.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",r[r.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",r[r.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",r[r.URI_TOO_LONG=414]="URI_TOO_LONG",r[r.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",r[r.RANGE_NOT_SATISFIABLE=416]="RANGE_NOT_SATISFIABLE",r[r.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",r[r.I_AM_A_TEAPOT=418]="I_AM_A_TEAPOT",r[r.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST",r[r.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",r[r.LOCKED=423]="LOCKED",r[r.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",r[r.UPGRADE_REQUIRED=426]="UPGRADE_REQUIRED",r[r.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",r[r.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",r[r.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",r[r.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",r[r.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",r[r.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",r[r.BAD_GATEWAY=502]="BAD_GATEWAY",r[r.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",r[r.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",r[r.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",r[r.VARIANT_ALSO_NEGOTIATES=506]="VARIANT_ALSO_NEGOTIATES",r[r.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",r[r.LOOP_DETECTED=508]="LOOP_DETECTED",r[r.NOT_EXTENDED=510]="NOT_EXTENDED",r[r.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED"})(cr||(cr={}));var jr;(function(r){r.TEXT="text",r.JSON="json"})(jr||(jr={}));class ri extends Error{constructor(t,e,i,n,s){super(t),this.message=t,this.status=e,this.statusText=i,this.body=n,this.url=s,this.name="HttpResponse"}}class yc extends Error{constructor(t){super(t),this.errorDetail=t,this.name="HttpRequestFailed"}}class bc{constructor(t=3e4){this.timeout=t}serialize(t){if(!t)return"";const e=[];for(const n in t)if(t.hasOwnProperty(n)&&typeof t[n]<"u"){const s=typeof t[n].toJSON=="function"?t[n].toJSON():t[n];if(s===null){e.push(encodeURIComponent(n));continue}if(Array.isArray(s)){s.forEach(o=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(o))});continue}e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}const i=e.join("&");return i?`?${i}`:""}createRequest({url:t,method:e,timeout:i=this.timeout,query:n,headers:s={},json:o=!0},a){return mc(this,void 0,void 0,function*(){let c,l;s["Content-Type"]||(s["Content-Type"]="application/json"),o?c=jr.JSON:(c=jr.TEXT,l=[h=>h]);try{return(yield zn.request({url:t+this.serialize(n),method:e!=null?e:"GET",headers:s,responseType:c,transformResponse:l,timeout:i,data:a})).data}catch(h){if(zn.isAxiosError(h)&&h.response){let p;throw typeof h.response.data=="object"?p=JSON.stringify(h.response.data):p=h.response.data,new ri(`Http error response: (${h.response.status}) ${p}`,h.response.status,h.response.statusText,p,t+this.serialize(n))}else throw new yc(h)}})}}function Ai(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function I(r,t,e,i){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{l(i.next(h))}catch(p){o(p)}}function c(h){try{l(i.throw(h))}catch(p){o(p)}}function l(h){h.done?s(h.value):n(h.value).then(a,c)}l((i=i.apply(r,t||[])).next())})}const vc="main",T={block:"head"};var Wn;(function(r){r.GET_BAKING_RIGHTS="getBakingRights",r.GET_BALLOTS="getBallots",r.GET_BALLOT_LIST="getBallotList",r.GET_BIG_MAP_KEY="getBigMapKey",r.GET_BIG_MAP_EXPR="getBigMapExpr",r.GET_BLOCK_HASH="getBlockHash",r.GET_BLOCK="getBlock",r.GET_BLOCK_HEADER="getBlockHeader",r.GET_BLOCK_METADATA="getBlockMetadata",r.GET_BALANCE="getBalance",r.GET_CHAIN_ID="getChainId",r.GET_CONSTANTS="getConstants",r.GET_CONTRACT="getContract",r.GET_CURRENT_PERIOD="getCurrentPeriod",r.GET_CURRENT_PROPOSAL="getCurrentProposal",r.GET_CURRENT_QUORUM="getCurrentQuorum",r.GET_DELEGATE="getDelegate",r.GET_DELEGATES="getDelegates",r.GET_ENDORSING_RIGHTS="getEndorsingRights",r.GET_ENTRYPOINTS="getEntrypoints",r.GET_LIVE_BLOCKS="getLiveBlocks",r.GET_MANAGER_KEY="getManagerKey",r.GET_NORMALIZED_SCRIPT="getNormalizedScript",r.GET_PROPOSALS="getProposals",r.GET_PROTOCOLS="getProtocols",r.GET_SAPLING_DIFF_BY_CONTRACT="getSaplingDiffByContract",r.GET_SAPLING_DIFF_BY_ID="getSaplingDiffById",r.GET_SCRIPT="getScript",r.GET_STORAGE="getStorage",r.GET_SUCCESSOR_PERIOD="getSuccessorPeriod",r.GET_TX_ROLLUP_INBOX="getTxRollupInbox",r.GET_TX_ROLLUP_STATE="getTxRollupState",r.GET_VOTES_LISTINGS="getVotesListings",r.PACK_DATA="packData"})(Wn||(Wn={}));function sr(r,t){const e=Array.isArray(r);typeof t>"u"&&(t=Object.keys(r));const i=e?[]:{};return t.forEach(n=>{const s=r[n];let o;if(!(typeof s>"u")){if(Array.isArray(s)){o=sr(s),i[n]=o;return}o=new V(s),i[n]=o}}),i}var Jn;(function(r){r.TOO_LARGE="too large"})(Jn||(Jn={}));var Yn;(function(r){r.BAKING_REWARDS="baking rewards",r.REWARDS="rewards",r.FEES="fees",r.DEPOSITS="deposits",r.LEGACY_REWARDS="legacy_rewards",r.LEGACY_FEES="legacy_fees",r.LEGACY_DEPOSITS="legacy_deposits",r.BLOCK_FEES="block fees",r.NONCE_REVELATION_REWARDS="nonce revelation rewards",r.DOUBLE_SIGNING_EVIDENCE_REWARDS="double signing evidence rewards",r.ENDORSING_REWARDS="endorsing rewards",r.BAKING_BONUSES="baking bonuses",r.STORAGE_FEES="storage fees",r.PUNISHMENTS="punishments",r.LOST_ENDORSING_REWARDS="lost endorsing rewards",r.SUBSIDY="subsidy",r.BURNED="burned",r.COMMITMENT="commitment",r.BOOTSTRAP="bootstrap",r.INVOICE="invoice",r.MINTED="minted",r.TX_ROLLUP_REJECTION_REWARDS="tx_rollup_rejection_rewards",r.TX_ROLLUP_REJECTION_PUNISHMENTS="tx_rollup_rejection_punishments",r.BONDS="bonds"})(Yn||(Yn={}));var v;(function(r){r.ORIGINATION="origination",r.DELEGATION="delegation",r.REVEAL="reveal",r.TRANSACTION="transaction",r.ACTIVATION="activate_account",r.ENDORSEMENT="endorsement",r.PREENDORSEMENT="preendorsement",r.SET_DEPOSITS_LIMIT="set_deposits_limit",r.DOUBLE_PREENDORSEMENT_EVIDENCE="double_preendorsement_evidence",r.ENDORSEMENT_WITH_SLOT="endorsement_with_slot",r.SEED_NONCE_REVELATION="seed_nonce_revelation",r.DOUBLE_ENDORSEMENT_EVIDENCE="double_endorsement_evidence",r.DOUBLE_BAKING_EVIDENCE="double_baking_evidence",r.PROPOSALS="proposals",r.BALLOT="ballot",r.FAILING_NOOP="failing_noop",r.REGISTER_GLOBAL_CONSTANT="register_global_constant",r.TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.TX_ROLLUP_COMMIT="tx_rollup_commit",r.TX_ROLLUP_RETURN_BOND="tx_rollup_return_bond",r.TX_ROLLUP_FINALIZE_COMMITMENT="tx_rollup_finalize_commitment",r.TX_ROLLUP_REMOVE_COMMITMENT="tx_rollup_remove_commitment",r.TX_ROLLUP_REJECTION="tx_rollup_rejection",r.TX_ROLLUP_DISPATCH_TICKETS="tx_rollup_dispatch_tickets",r.TRANSFER_TICKET="transfer_ticket"})(v||(v={}));class Nr{constructor(t,e=vc,i=new bc){this.url=t,this.chain=e,this.httpBackend=i}createURL(t){return`${this.url.replace(/\/+$/g,"")}${t}`}validateAddress(t){if(q(t)!==L.VALID)throw new Z(t)}validateContract(t){if(Ue(t)!==L.VALID)throw new Z(t)}getBlockHash({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/hash`),method:"GET"})})}getLiveBlocks({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/live_blocks`),method:"GET"})})}getBalance(t,{block:e}=T){return I(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/balance`),method:"GET"});return new V(i)})}getStorage(t,{block:e}=T){return I(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage`),method:"GET"})})}getScript(t,{block:e}=T){return I(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/script`),method:"GET"})})}getNormalizedScript(t,e={unparsing_mode:"Readable"},{block:i}=T){return I(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/contracts/${t}/script/normalized`),method:"POST"},e)})}getContract(t,{block:e}=T){return I(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}`),method:"GET"});return Object.assign(Object.assign({},i),{balance:new V(i.balance)})})}getManagerKey(t,{block:e}=T){return I(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/manager_key`),method:"GET"})})}getDelegate(t,{block:e}=T){return I(this,void 0,void 0,function*(){this.validateAddress(t);let i;try{i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/delegate`),method:"GET"})}catch(n){if(n instanceof ri&&n.status===cr.NOT_FOUND)i=null;else throw n}return i})}getBigMapKey(t,e,{block:i}=T){return I(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/contracts/${t}/big_map_get`),method:"POST"},e)})}getBigMapExpr(t,e,{block:i}=T){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/big_maps/${t}/${e}`),method:"GET"})})}getDelegates(t,{block:e}=T){return I(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}`),method:"GET"}),n=sr(i,["balance","full_balance","current_frozen_deposits","frozen_deposits","frozen_balance","frozen_deposits_limit","staking_balance","delegated_balance","voting_power"]);return Object.assign(Object.assign(Object.assign({},i),n),{frozen_balance_by_cycle:i.frozen_balance_by_cycle?i.frozen_balance_by_cycle.map(s=>{var{deposit:o,deposits:a,fees:c,rewards:l}=s,h=Ai(s,["deposit","deposits","fees","rewards"]);const p=sr({deposit:o,deposits:a,fees:c,rewards:l},["deposit","deposits","fees","rewards"]);return Object.assign(Object.assign({},h),{deposit:p.deposit,deposits:p.deposits,fees:p.fees,rewards:p.rewards})}):void 0})})}getConstants({block:t}=T){return I(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/context/constants`),method:"GET"}),i=sr(e,["time_between_blocks","hard_gas_limit_per_operation","hard_gas_limit_per_block","proof_of_work_threshold","tokens_per_roll","seed_nonce_revelation_tip","block_security_deposit","endorsement_security_deposit","block_reward","endorsement_reward","cost_per_byte","hard_storage_limit_per_operation","test_chain_duration","baking_reward_per_endorsement","delay_per_missing_endorsement","minimal_block_delay","liquidity_baking_subsidy","cache_layout","baking_reward_fixed_portion","baking_reward_bonus_per_slot","endorsing_reward_per_slot","double_baking_punishment","delay_increment_per_round","tx_rollup_commitment_bond"]);return Object.assign(Object.assign({},e),i)})}getBlock({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}`),method:"GET"})})}getBlockHeader({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/header`),method:"GET"})})}getBlockMetadata({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/metadata`),method:"GET"})})}getBakingRights(t={},{block:e}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/baking_rights`),method:"GET",query:t})})}getEndorsingRights(t={},{block:e}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/endorsing_rights`),method:"GET",query:t})})}getBallotList({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballot_list`),method:"GET"})})}getBallots({block:t}=T){return I(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballots`),method:"GET"});return sr(e,["yay","nay","pass"])})}getCurrentProposal({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_proposal`),method:"GET"})})}getCurrentQuorum({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_quorum`),method:"GET"})})}getVotesListings({block:t}=T){return I(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/listings`),method:"GET"});return e.map(i=>(i.voting_power&&(i.voting_power=new V(i.voting_power)),i)),e})}getProposals({block:t}=T){return I(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/proposals`),method:"GET"});return e.map(i=>i[1]=new V(i[1])),e})}forgeOperations(t,{block:e}=T){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/forge/operations`),method:"POST"},t)})}injectOperation(t){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL("/injection/operation"),method:"POST"},t)})}preapplyOperations(t,{block:e}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/preapply/operations`),method:"POST"},t)})}getEntrypoints(t,{block:e}=T){return I(this,void 0,void 0,function*(){return this.validateContract(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/entrypoints`),method:"GET"})})}runOperation(t,{block:e}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_operation`),method:"POST"},t)})}runCode(t,{block:e}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_code`),method:"POST"},t)})}runView(t,{block:e}=T){var{unparsing_mode:i="Readable"}=t,n=Ai(t,["unparsing_mode"]);return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_view`),method:"POST"},Object.assign({unparsing_mode:i},n))})}getChainId(){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/chain_id`),method:"GET"})})}packData(t,{block:e}=T){return I(this,void 0,void 0,function*(){const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/pack_data`),method:"POST"},t),{gas:n}=i,s=Ai(i,["gas"]);let o=n;const a=new V(n||"");return a.isNaN()||(o=a),Object.assign({gas:o},s)})}getRpcUrl(){return this.url}getCurrentPeriod({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_period`),method:"GET"})})}getSuccessorPeriod({block:t}=T){return I(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/successor_period`),method:"GET"})})}getSaplingDiffById(t,{block:e}=T){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/sapling/${t}/get_diff`),method:"GET"})})}getSaplingDiffByContract(t,{block:e}=T){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/single_sapling_get_diff`),method:"GET"})})}getProtocols({block:t}=T){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/protocols`),method:"GET"})})}getTxRollupState(t,{block:e}=T){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/tx_rollup/${t}/state`),method:"GET"})})}getTxRollupInbox(t,e,{block:i}=T){return I(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/tx_rollup/${t}/inbox/${e}`),method:"GET"})})}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Fi=function(r,t){return Fi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},Fi(r,t)};function j(r,t){Fi(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function $r(r){return typeof r=="function"}var Xn=!1,At={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){if(r){var t=new Error;""+t.stack}Xn=r},get useDeprecatedSynchronousErrorHandling(){return Xn}};function ke(r){setTimeout(function(){throw r},0)}var Mr={closed:!0,next:function(r){},error:function(r){if(At.useDeprecatedSynchronousErrorHandling)throw r;ke(r)},complete:function(){}},on=function(){return Array.isArray||function(r){return r&&typeof r.length=="number"}}();function eo(r){return r!==null&&typeof r=="object"}var Ec=function(){function r(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,i){return i+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return r.prototype=Object.create(Error.prototype),r}(),Tr=Ec,bt=function(){function r(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return r.prototype.unsubscribe=function(){var t;if(!this.closed){var e=this,i=e._parentOrParents,n=e._ctorUnsubscribe,s=e._unsubscribe,o=e._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof r)i.remove(this);else if(i!==null)for(var a=0;a<i.length;++a){var c=i[a];c.remove(this)}if($r(s)){n&&(this._unsubscribe=void 0);try{s.call(this)}catch(p){t=p instanceof Tr?Qn(p.errors):[p]}}if(on(o))for(var a=-1,l=o.length;++a<l;){var h=o[a];if(eo(h))try{h.unsubscribe()}catch(y){t=t||[],y instanceof Tr?t=t.concat(Qn(y.errors)):t.push(y)}}if(t)throw new Tr(t)}},r.prototype.add=function(t){var e=t;if(!t)return r.EMPTY;switch(typeof t){case"function":e=new r(t);case"object":if(e===this||e.closed||typeof e.unsubscribe!="function")return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof r)){var i=e;e=new r,e._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var n=e._parentOrParents;if(n===null)e._parentOrParents=this;else if(n instanceof r){if(n===this)return e;e._parentOrParents=[n,this]}else if(n.indexOf(this)===-1)n.push(this);else return e;var s=this._subscriptions;return s===null?this._subscriptions=[e]:s.push(e),e},r.prototype.remove=function(t){var e=this._subscriptions;if(e){var i=e.indexOf(t);i!==-1&&e.splice(i,1)}},r.EMPTY=function(t){return t.closed=!0,t}(new r),r}();function Qn(r){return r.reduce(function(t,e){return t.concat(e instanceof Tr?e.errors:e)},[])}var Br=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),J=function(r){j(t,r);function t(e,i,n){var s=r.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=Mr;break;case 1:if(!e){s.destination=Mr;break}if(typeof e=="object"){e instanceof t?(s.syncErrorThrowable=e.syncErrorThrowable,s.destination=e,e.add(s)):(s.syncErrorThrowable=!0,s.destination=new Zn(s,e));break}default:s.syncErrorThrowable=!0,s.destination=new Zn(s,e,i,n);break}return s}return t.prototype[Br]=function(){return this},t.create=function(e,i,n){var s=new t(e,i,n);return s.syncErrorThrowable=!1,s},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(bt),Zn=function(r){j(t,r);function t(e,i,n,s){var o=r.call(this)||this;o._parentSubscriber=e;var a,c=o;return $r(i)?a=i:i&&(a=i.next,n=i.error,s=i.complete,i!==Mr&&(c=Object.create(i),$r(c.unsubscribe)&&o.add(c.unsubscribe.bind(c)),c.unsubscribe=o.unsubscribe.bind(o))),o._context=c,o._next=a,o._error=n,o._complete=s,o}return t.prototype.next=function(e){if(!this.isStopped&&this._next){var i=this._parentSubscriber;!At.useDeprecatedSynchronousErrorHandling||!i.syncErrorThrowable?this.__tryOrUnsub(this._next,e):this.__tryOrSetError(i,this._next,e)&&this.unsubscribe()}},t.prototype.error=function(e){if(!this.isStopped){var i=this._parentSubscriber,n=At.useDeprecatedSynchronousErrorHandling;if(this._error)!n||!i.syncErrorThrowable?(this.__tryOrUnsub(this._error,e),this.unsubscribe()):(this.__tryOrSetError(i,this._error,e),this.unsubscribe());else if(i.syncErrorThrowable)n?(i.syncErrorValue=e,i.syncErrorThrown=!0):ke(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;ke(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var i=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};!At.useDeprecatedSynchronousErrorHandling||!i.syncErrorThrowable?(this.__tryOrUnsub(n),this.unsubscribe()):(this.__tryOrSetError(i,n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,i){try{e.call(this._context,i)}catch(n){if(this.unsubscribe(),At.useDeprecatedSynchronousErrorHandling)throw n;ke(n)}},t.prototype.__tryOrSetError=function(e,i,n){if(!At.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{i.call(this._context,n)}catch(s){return At.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=s,e.syncErrorThrown=!0,!0):(ke(s),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(J);function wc(r){for(;r;){var t=r,e=t.closed,i=t.destination,n=t.isStopped;if(e||n)return!1;i&&i instanceof J?r=i:r=null}return!0}function Sc(r,t,e){if(r){if(r instanceof J)return r;if(r[Br])return r[Br]()}return!r&&!t&&!e?new J(Mr):new J(r,t,e)}var dr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function an(r){return r}function Oc(r){return r.length===0?an:r.length===1?r[0]:function(e){return r.reduce(function(i,n){return n(i)},e)}}var W=function(){function r(t){this._isScalar=!1,t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,i){var n=this.operator,s=Sc(t,e,i);if(n?s.add(n.call(s,this.source)):s.add(this.source||At.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),At.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){At.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),wc(t)?t.error(e):console.warn(e)}},r.prototype.forEach=function(t,e){var i=this;return e=ts(e),new e(function(n,s){var o;o=i.subscribe(function(a){try{t(a)}catch(c){s(c),o&&o.unsubscribe()}},s,n)})},r.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},r.prototype[dr]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length===0?this:Oc(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=ts(t),new t(function(i,n){var s;e.subscribe(function(o){return s=o},function(o){return n(o)},function(){return i(s)})})},r.create=function(t){return new r(t)},r}();function ts(r){if(r||(r=At.Promise||Promise),!r)throw new Error("no Promise impl found");return r}var _c=function(){function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r}(),Ae=_c,ro=function(r){j(t,r);function t(e,i){var n=r.call(this)||this;return n.subject=e,n.subscriber=i,n.closed=!1,n}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,i=e.observers;if(this.subject=null,!(!i||i.length===0||e.isStopped||e.closed)){var n=i.indexOf(this.subscriber);n!==-1&&i.splice(n,1)}}},t}(bt),io=function(r){j(t,r);function t(e){var i=r.call(this,e)||this;return i.destination=e,i}return t}(J),We=function(r){j(t,r);function t(){var e=r.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype[Br]=function(){return new io(this)},t.prototype.lift=function(e){var i=new es(this,this);return i.operator=e,i},t.prototype.next=function(e){if(this.closed)throw new Ae;if(!this.isStopped)for(var i=this.observers,n=i.length,s=i.slice(),o=0;o<n;o++)s[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new Ae;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var i=this.observers,n=i.length,s=i.slice(),o=0;o<n;o++)s[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Ae;this.isStopped=!0;for(var e=this.observers,i=e.length,n=e.slice(),s=0;s<i;s++)n[s].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(e){if(this.closed)throw new Ae;return r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){if(this.closed)throw new Ae;return this.hasError?(e.error(this.thrownError),bt.EMPTY):this.isStopped?(e.complete(),bt.EMPTY):(this.observers.push(e),new ro(this,e))},t.prototype.asObservable=function(){var e=new W;return e.source=this,e},t.create=function(e,i){return new es(e,i)},t}(W),es=function(r){j(t,r);function t(e,i){var n=r.call(this)||this;return n.destination=e,n.source=i,n}return t.prototype.next=function(e){var i=this.destination;i&&i.next&&i.next(e)},t.prototype.error=function(e){var i=this.destination;i&&i.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){var i=this.source;return i?this.source.subscribe(e):bt.EMPTY},t}(We);function no(){return function(t){return t.lift(new Rc(t))}}var Rc=function(){function r(t){this.connectable=t}return r.prototype.call=function(t,e){var i=this.connectable;i._refCount++;var n=new Ac(t,i),s=e.subscribe(n);return n.closed||(n.connection=i.connect()),s},r}(),Ac=function(r){j(t,r);function t(e,i){var n=r.call(this,e)||this;return n.connectable=i,n}return t.prototype._unsubscribe=function(){var e=this.connectable;if(!e){this.connection=null;return}this.connectable=null;var i=e._refCount;if(i<=0){this.connection=null;return}if(e._refCount=i-1,i>1){this.connection=null;return}var n=this.connection,s=e._connection;this.connection=null,s&&(!n||s===n)&&s.unsubscribe()},t}(J),Pc=function(r){j(t,r);function t(e,i){var n=r.call(this)||this;return n.source=e,n.subjectFactory=i,n._refCount=0,n._isComplete=!1,n}return t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,e=this._connection=new bt,e.add(this.source.subscribe(new xc(this.getSubject(),this))),e.closed&&(this._connection=null,e=bt.EMPTY)),e},t.prototype.refCount=function(){return no()(this)},t}(W),Ic=function(){var r=Pc.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:r._subscribe},_isComplete:{value:r._isComplete,writable:!0},getSubject:{value:r.getSubject},connect:{value:r.connect},refCount:{value:r.refCount}}}(),xc=function(r){j(t,r);function t(e,i){var n=r.call(this,e)||this;return n.connectable=i,n}return t.prototype._error=function(e){this._unsubscribe(),r.prototype._error.call(this,e)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),r.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var i=e._connection;e._refCount=0,e._subject=null,e._connection=null,i&&i.unsubscribe()}},t}(io),so=function(r){j(t,r);function t(e){var i=r.call(this)||this;return i._value=e,i}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(e){var i=r.prototype._subscribe.call(this,e);return i&&!i.closed&&e.next(this._value),i},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ae;return this._value},t.prototype.next=function(e){r.prototype.next.call(this,this._value=e)},t}(We),Nc=function(r){j(t,r);function t(e,i){return r.call(this)||this}return t.prototype.schedule=function(e,i){return this},t}(bt),oo=function(r){j(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.scheduler=e,n.work=i,n.pending=!1,n}return t.prototype.schedule=function(e,i){if(i===void 0&&(i=0),this.closed)return this;this.state=e;var n=this.id,s=this.scheduler;return n!=null&&(this.id=this.recycleAsyncId(s,n,i)),this.pending=!0,this.delay=i,this.id=this.id||this.requestAsyncId(s,this.id,i),this},t.prototype.requestAsyncId=function(e,i,n){return n===void 0&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,i,n){if(n===void 0&&(n=0),n!==null&&this.delay===n&&this.pending===!1)return i;clearInterval(i)},t.prototype.execute=function(e,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,i);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,i){var n=!1,s=void 0;try{this.work(e)}catch(o){n=!0,s=!!o&&o||new Error(o)}if(n)return this.unsubscribe(),s},t.prototype._unsubscribe=function(){var e=this.id,i=this.scheduler,n=i.actions,s=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,s!==-1&&n.splice(s,1),e!=null&&(this.id=this.recycleAsyncId(i,e,null)),this.delay=null},t}(Nc),Tc=function(r){j(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.scheduler=e,n.work=i,n}return t.prototype.schedule=function(e,i){return i===void 0&&(i=0),i>0?r.prototype.schedule.call(this,e,i):(this.delay=i,this.state=e,this.scheduler.flush(this),this)},t.prototype.execute=function(e,i){return i>0||this.closed?r.prototype.execute.call(this,e,i):this._execute(e,i)},t.prototype.requestAsyncId=function(e,i,n){return n===void 0&&(n=0),n!==null&&n>0||n===null&&this.delay>0?r.prototype.requestAsyncId.call(this,e,i,n):e.flush(this)},t}(oo),rs=function(){function r(t,e){e===void 0&&(e=r.now),this.SchedulerAction=t,this.now=e}return r.prototype.schedule=function(t,e,i){return e===void 0&&(e=0),new this.SchedulerAction(this,t).schedule(i,e)},r.now=function(){return Date.now()},r}(),ao=function(r){j(t,r);function t(e,i){i===void 0&&(i=rs.now);var n=r.call(this,e,function(){return t.delegate&&t.delegate!==n?t.delegate.now():i()})||this;return n.actions=[],n.active=!1,n.scheduled=void 0,n}return t.prototype.schedule=function(e,i,n){return i===void 0&&(i=0),t.delegate&&t.delegate!==this?t.delegate.schedule(e,i,n):r.prototype.schedule.call(this,e,i,n)},t.prototype.flush=function(e){var i=this.actions;if(this.active){i.push(e);return}var n;this.active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=i.shift());if(this.active=!1,n){for(;e=i.shift();)e.unsubscribe();throw n}},t}(rs),Lc=function(r){j(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(ao),Cc=new Lc(Tc),jc=Cc,co=new W(function(r){return r.complete()});function cn(r){return r?$c(r):co}function $c(r){return new W(function(t){return r.schedule(function(){return t.complete()})})}function ur(r){return r&&typeof r.schedule=="function"}var uo=function(r){return function(t){for(var e=0,i=r.length;e<i&&!t.closed;e++)t.next(r[e]);t.complete()}};function un(r,t){return new W(function(e){var i=new bt,n=0;return i.add(t.schedule(function(){if(n===r.length){e.complete();return}e.next(r[n++]),e.closed||i.add(this.schedule())})),i})}function ho(r,t){return t?un(r,t):new W(uo(r))}function gr(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return ur(e)?(r.pop(),un(r,e)):ho(r)}function hn(r,t){return t?new W(function(e){return t.schedule(Mc,0,{error:r,subscriber:e})}):new W(function(e){return e.error(r)})}function Mc(r){var t=r.error,e=r.subscriber;e.error(t)}var Pi=function(){function r(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue=t==="N"}return r.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},r.prototype.do=function(t,e,i){var n=this.kind;switch(n){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}},r.prototype.accept=function(t,e,i){return t&&typeof t.next=="function"?this.observe(t):this.do(t,e,i)},r.prototype.toObservable=function(){var t=this.kind;switch(t){case"N":return gr(this.value);case"E":return hn(this.error);case"C":return cn()}throw new Error("unexpected notification kind value")},r.createNext=function(t){return typeof t<"u"?new r("N",t):r.undefinedValueNotification},r.createError=function(t){return new r("E",void 0,t)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r.undefinedValueNotification=new r("N",void 0),r}(),Bc=function(r){j(t,r);function t(e,i,n){n===void 0&&(n=0);var s=r.call(this,e)||this;return s.scheduler=i,s.delay=n,s}return t.dispatch=function(e){var i=e.notification,n=e.destination;i.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){var i=this.destination;i.add(this.scheduler.schedule(t.dispatch,this.delay,new Vc(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Pi.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Pi.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Pi.createComplete()),this.unsubscribe()},t}(J),Vc=function(){function r(t,e){this.notification=t,this.destination=e}return r}(),Vr=function(r){j(t,r);function t(e,i,n){e===void 0&&(e=Number.POSITIVE_INFINITY),i===void 0&&(i=Number.POSITIVE_INFINITY);var s=r.call(this)||this;return s.scheduler=n,s._events=[],s._infiniteTimeWindow=!1,s._bufferSize=e<1?1:e,s._windowTime=i<1?1:i,i===Number.POSITIVE_INFINITY?(s._infiniteTimeWindow=!0,s.next=s.nextInfiniteTimeWindow):s.next=s.nextTimeWindow,s}return t.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var i=this._events;i.push(e),i.length>this._bufferSize&&i.shift()}r.prototype.next.call(this,e)},t.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new Dc(this._getNow(),e)),this._trimBufferThenGetEvents()),r.prototype.next.call(this,e)},t.prototype._subscribe=function(e){var i=this._infiniteTimeWindow,n=i?this._events:this._trimBufferThenGetEvents(),s=this.scheduler,o=n.length,a;if(this.closed)throw new Ae;if(this.isStopped||this.hasError?a=bt.EMPTY:(this.observers.push(e),a=new ro(this,e)),s&&e.add(e=new Bc(e,s)),i)for(var c=0;c<o&&!e.closed;c++)e.next(n[c]);else for(var c=0;c<o&&!e.closed;c++)e.next(n[c].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),a},t.prototype._getNow=function(){return(this.scheduler||jc).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),i=this._bufferSize,n=this._windowTime,s=this._events,o=s.length,a=0;a<o&&!(e-s[a].time<n);)a++;return o>i&&(a=Math.max(a,o-i)),a>0&&s.splice(0,a),s},t}(We),Dc=function(){function r(t,e){this.time=t,this.value=e}return r}(),kc=new ao(oo),lo=kc;function qt(){}var Fc=function(){function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return r.prototype=Object.create(Error.prototype),r}(),Hc=Fc,Uc=function(){function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return r.prototype=Object.create(Error.prototype),r}(),po=Uc;function Le(r,t){return function(i){if(typeof r!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new Kc(r,t))}}var Kc=function(){function r(t,e){this.project=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new Gc(t,this.project,this.thisArg))},r}(),Gc=function(r){j(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.project=i,s.count=0,s.thisArg=n||s,s}return t.prototype._next=function(e){var i;try{i=this.project.call(this.thisArg,e,this.count++)}catch(n){this.destination.error(n);return}this.destination.next(i)},t}(J),qc=function(r){j(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e,i,n,s,o){this.destination.next(i)},t.prototype.notifyError=function(e,i){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(J),zc=function(r){j(t,r);function t(e,i,n){var s=r.call(this)||this;return s.parent=e,s.outerValue=i,s.outerIndex=n,s.index=0,s}return t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(J),Wc=function(r){return function(t){return r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,ke),t}};function Jc(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ii=Jc(),Yc=function(r){return function(t){var e=r[ii]();do{var i=void 0;try{i=e.next()}catch(n){return t.error(n),t}if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}while(!0);return typeof e.return=="function"&&t.add(function(){e.return&&e.return()}),t}},Xc=function(r){return function(t){var e=r[dr]();if(typeof e.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)}},fo=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function go(r){return!!r&&typeof r.subscribe!="function"&&typeof r.then=="function"}var ln=function(r){if(!!r&&typeof r[dr]=="function")return Xc(r);if(fo(r))return uo(r);if(go(r))return Wc(r);if(!!r&&typeof r[ii]=="function")return Yc(r);var t=eo(r)?"an invalid object":"'"+r+"'",e="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(e)};function Qc(r,t,e,i,n){if(n===void 0&&(n=new zc(r,e,i)),!n.closed)return t instanceof W?t.subscribe(n):ln(t)(n)}var is={};function ns(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=void 0,i=void 0;return ur(r[r.length-1])&&(i=r.pop()),typeof r[r.length-1]=="function"&&(e=r.pop()),r.length===1&&on(r[0])&&(r=r[0]),ho(r,i).lift(new Zc(e))}var Zc=function(){function r(t){this.resultSelector=t}return r.prototype.call=function(t,e){return e.subscribe(new tu(t,this.resultSelector))},r}(),tu=function(r){j(t,r);function t(e,i){var n=r.call(this,e)||this;return n.resultSelector=i,n.active=0,n.values=[],n.observables=[],n}return t.prototype._next=function(e){this.values.push(is),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,i=e.length;if(i===0)this.destination.complete();else{this.active=i,this.toRespond=i;for(var n=0;n<i;n++){var s=e[n];this.add(Qc(this,s,void 0,n))}}},t.prototype.notifyComplete=function(e){(this.active-=1)===0&&this.destination.complete()},t.prototype.notifyNext=function(e,i,n){var s=this.values,o=s[n],a=this.toRespond?o===is?--this.toRespond:this.toRespond:0;s[n]=i,a===0&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},t.prototype._tryResultSelector=function(e){var i;try{i=this.resultSelector.apply(this,e)}catch(n){this.destination.error(n);return}this.destination.next(i)},t}(qc);function eu(r,t){return new W(function(e){var i=new bt;return i.add(t.schedule(function(){var n=r[dr]();i.add(n.subscribe({next:function(s){i.add(t.schedule(function(){return e.next(s)}))},error:function(s){i.add(t.schedule(function(){return e.error(s)}))},complete:function(){i.add(t.schedule(function(){return e.complete()}))}}))})),i})}function ru(r,t){return new W(function(e){var i=new bt;return i.add(t.schedule(function(){return r.then(function(n){i.add(t.schedule(function(){e.next(n),i.add(t.schedule(function(){return e.complete()}))}))},function(n){i.add(t.schedule(function(){return e.error(n)}))})})),i})}function iu(r,t){if(!r)throw new Error("Iterable cannot be null");return new W(function(e){var i=new bt,n;return i.add(function(){n&&typeof n.return=="function"&&n.return()}),i.add(t.schedule(function(){n=r[ii](),i.add(t.schedule(function(){if(!e.closed){var s,o;try{var a=n.next();s=a.value,o=a.done}catch(c){e.error(c);return}o?e.complete():(e.next(s),this.schedule())}}))})),i})}function nu(r){return r&&typeof r[dr]=="function"}function su(r){return r&&typeof r[ii]=="function"}function ou(r,t){if(r!=null){if(nu(r))return eu(r,t);if(go(r))return ru(r,t);if(fo(r))return un(r,t);if(su(r)||typeof r=="string")return iu(r,t)}throw new TypeError((r!==null&&typeof r||r)+" is not observable")}function $e(r,t){return t?ou(r,t):r instanceof W?r:new W(ln(r))}var mr=function(r){j(t,r);function t(e){var i=r.call(this)||this;return i.parent=e,i}return t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(J),yr=function(r){j(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(J);function br(r,t){if(!t.closed){if(r instanceof W)return r.subscribe(t);var e;try{e=ln(r)(t)}catch(i){t.error(i)}return e}}function pn(r,t,e){return e===void 0&&(e=Number.POSITIVE_INFINITY),typeof t=="function"?function(i){return i.pipe(pn(function(n,s){return $e(r(n,s)).pipe(Le(function(o,a){return t(n,o,s,a)}))},e))}:(typeof t=="number"&&(e=t),function(i){return i.lift(new au(r,e))})}var au=function(){function r(t,e){e===void 0&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return r.prototype.call=function(t,e){return e.subscribe(new cu(t,this.project,this.concurrent))},r}(),cu=function(r){j(t,r);function t(e,i,n){n===void 0&&(n=Number.POSITIVE_INFINITY);var s=r.call(this,e)||this;return s.project=i,s.concurrent=n,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var i,n=this.index++;try{i=this.project(e,n)}catch(s){this.destination.error(s);return}this.active++,this._innerSub(i)},t.prototype._innerSub=function(e){var i=new mr(this),n=this.destination;n.add(i);var s=br(e,i);s!==i&&n.add(s)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(yr);function uu(r){return r===void 0&&(r=Number.POSITIVE_INFINITY),pn(an,r)}function hu(){return uu(1)}function Hi(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return hu()(gr.apply(void 0,r))}function mo(r){return new W(function(t){var e;try{e=r()}catch(n){t.error(n);return}var i=e?$e(e):cn();return i.subscribe(t)})}function ss(r){return!on(r)&&r-parseFloat(r)+1>=0}var lu=new W(qt);function Dr(r,t){return function(i){return i.lift(new pu(r,t))}}var pu=function(){function r(t,e){this.predicate=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new fu(t,this.predicate,this.thisArg))},r}(),fu=function(r){j(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.predicate=i,s.thisArg=n,s.count=0,s}return t.prototype._next=function(e){var i;try{i=this.predicate.call(this.thisArg,e,this.count++)}catch(n){this.destination.error(n);return}i&&this.destination.next(e)},t}(J);function du(r,t,e){return r===void 0&&(r=0),new W(function(i){t===void 0&&(t=r,r=0);var n=0,s=r;if(e)return e.schedule(gu,0,{index:n,count:t,start:r,subscriber:i});do{if(n++>=t){i.complete();break}if(i.next(s++),i.closed)break}while(!0)})}function gu(r){var t=r.start,e=r.index,i=r.count,n=r.subscriber;if(e>=i){n.complete();return}n.next(t),!n.closed&&(r.index=e+1,r.start=t+1,this.schedule(r))}function os(r,t,e){r===void 0&&(r=0);var i=-1;return ss(t)?i=Number(t)<1&&1||Number(t):ur(t)&&(e=t),ur(e)||(e=lo),new W(function(n){var s=ss(r)?r:+r-e.now();return e.schedule(mu,s,{index:0,period:i,subscriber:n})})}function mu(r){var t=r.index,e=r.period,i=r.subscriber;if(i.next(t),!i.closed){if(e===-1)return i.complete();r.index=t+1,this.schedule(r,e)}}function fn(r){return function(e){var i=new yu(r),n=e.lift(i);return i.caught=n}}var yu=function(){function r(t){this.selector=t}return r.prototype.call=function(t,e){return e.subscribe(new bu(t,this.selector,this.caught))},r}(),bu=function(r){j(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.selector=i,s.caught=n,s}return t.prototype.error=function(e){if(!this.isStopped){var i=void 0;try{i=this.selector(e,this.caught)}catch(o){r.prototype.error.call(this,o);return}this._unsubscribeAndRecycle();var n=new mr(this);this.add(n);var s=br(i,n);s!==n&&this.add(s)}},t}(yr);function yo(r,t){return pn(r,t,1)}function vu(r){return r===void 0&&(r=null),function(t){return t.lift(new Eu(r))}}var Eu=function(){function r(t){this.defaultValue=t}return r.prototype.call=function(t,e){return e.subscribe(new wu(t,this.defaultValue))},r}(),wu=function(r){j(t,r);function t(e,i){var n=r.call(this,e)||this;return n.defaultValue=i,n.isEmpty=!0,n}return t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(J);function Su(r){return r instanceof Date&&!isNaN(+r)}function bo(r,t){return function(e){return e.lift(new Ou(r,t))}}var Ou=function(){function r(t,e){this.compare=t,this.keySelector=e}return r.prototype.call=function(t,e){return e.subscribe(new _u(t,this.compare,this.keySelector))},r}(),_u=function(r){j(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.keySelector=n,s.hasKey=!1,typeof i=="function"&&(s.compare=i),s}return t.prototype.compare=function(e,i){return e===i},t.prototype._next=function(e){var i;try{var n=this.keySelector;i=n?n(e):e}catch(a){return this.destination.error(a)}var s=!1;if(this.hasKey)try{var o=this.compare;s=o(this.key,i)}catch(a){return this.destination.error(a)}else this.hasKey=!0;s||(this.key=i,this.destination.next(e))},t}(J);function Ru(r,t){return bo(function(e,i){return t?t(e[r],i[r]):e[r]===i[r]})}function Au(r){return r===void 0&&(r=xu),function(t){return t.lift(new Pu(r))}}var Pu=function(){function r(t){this.errorFactory=t}return r.prototype.call=function(t,e){return e.subscribe(new Iu(t,this.errorFactory))},r}(),Iu=function(r){j(t,r);function t(e,i){var n=r.call(this,e)||this;return n.errorFactory=i,n.hasValue=!1,n}return t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(i){e=i}this.destination.error(e)},t}(J);function xu(){return new po}function Nu(r){return function(t){return r===0?cn():t.lift(new Tu(r))}}var Tu=function(){function r(t){if(this.total=t,this.total<0)throw new Hc}return r.prototype.call=function(t,e){return e.subscribe(new Lu(t,this.total))},r}(),Lu=function(r){j(t,r);function t(e,i){var n=r.call(this,e)||this;return n.total=i,n.count=0,n}return t.prototype._next=function(e){var i=this.total,n=++this.count;n<=i&&(this.destination.next(e),n===i&&(this.destination.complete(),this.unsubscribe()))},t}(J);function ie(r,t){var e=arguments.length>=2;return function(i){return i.pipe(r?Dr(function(n,s){return r(n,s,i)}):an,Nu(1),e?vu(t):Au(function(){return new po}))}}function as(r,t){return function(i){var n;if(typeof r=="function"?n=r:n=function(){return r},typeof t=="function")return i.lift(new Cu(n,t));var s=Object.create(i,Ic);return s.source=i,s.subjectFactory=n,s}}var Cu=function(){function r(t,e){this.subjectFactory=t,this.selector=e}return r.prototype.call=function(t,e){var i=this.selector,n=this.subjectFactory(),s=i(n).subscribe(t);return s.add(e.subscribe(n)),s},r}();function cs(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r.length;if(e===0)throw new Error("list of properties cannot be empty.");return function(i){return Le(ju(r,e))(i)}}function ju(r,t){var e=function(i){for(var n=i,s=0;s<t;s++){var o=n!=null?n[r[s]]:void 0;if(o!==void 0)n=o;else return}return n};return e}function $u(r){return r?as(function(){return new We},r):as(new We)}function vo(r){return r===void 0&&(r=-1),function(t){return t.lift(new Mu(r,t))}}var Mu=function(){function r(t,e){this.count=t,this.source=e}return r.prototype.call=function(t,e){return e.subscribe(new Bu(t,this.count,this.source))},r}(),Bu=function(r){j(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.count=i,s.source=n,s}return t.prototype.error=function(e){if(!this.isStopped){var i=this,n=i.source,s=i.count;if(s===0)return r.prototype.error.call(this,e);s>-1&&(this.count=s-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(J);function hr(r,t,e){var i;return r&&typeof r=="object"?i=r:i={bufferSize:r,windowTime:t,refCount:!1,scheduler:e},function(n){return n.lift(Vu(i))}}function Vu(r){var t=r.bufferSize,e=t===void 0?Number.POSITIVE_INFINITY:t,i=r.windowTime,n=i===void 0?Number.POSITIVE_INFINITY:i,s=r.refCount,o=r.scheduler,a,c=0,l,h=!1,p=!1;return function(E){c++;var N;!a||h?(h=!1,a=new Vr(e,n,o),N=a.subscribe(this),l=E.subscribe({next:function(F){a.next(F)},error:function(F){h=!0,a.error(F)},complete:function(){p=!0,l=void 0,a.complete()}}),p&&(l=void 0)):N=a.subscribe(this),this.add(function(){c--,N.unsubscribe(),N=void 0,l&&!p&&s&&c===0&&(l.unsubscribe(),l=void 0,a=void 0)})}}function Du(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return ur(e)?(r.pop(),function(i){return Hi(r,i,e)}):function(i){return Hi(r,i)}}function Ce(r,t){return typeof t=="function"?function(e){return e.pipe(Ce(function(i,n){return $e(r(i,n)).pipe(Le(function(s,o){return t(i,s,n,o)}))}))}:function(e){return e.lift(new ku(r))}}var ku=function(){function r(t){this.project=t}return r.prototype.call=function(t,e){return e.subscribe(new Fu(t,this.project))},r}(),Fu=function(r){j(t,r);function t(e,i){var n=r.call(this,e)||this;return n.project=i,n.index=0,n}return t.prototype._next=function(e){var i,n=this.index++;try{i=this.project(e,n)}catch(s){this.destination.error(s);return}this._innerSub(i)},t.prototype._innerSub=function(e){var i=this.innerSubscription;i&&i.unsubscribe();var n=new mr(this),s=this.destination;s.add(n),this.innerSubscription=br(e,n),this.innerSubscription!==n&&s.add(this.innerSubscription)},t.prototype._complete=function(){var e=this.innerSubscription;(!e||e.closed)&&r.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&r.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(yr);function Hu(r){return function(t){return t.lift(new Uu(r))}}var Uu=function(){function r(t){this.notifier=t}return r.prototype.call=function(t,e){var i=new Ku(t),n=br(this.notifier,new mr(i));return n&&!i.seenValue?(i.add(n),e.subscribe(i)):i},r}(),Ku=function(r){j(t,r);function t(e){var i=r.call(this,e)||this;return i.seenValue=!1,i}return t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(yr);function Gu(r,t){return t===void 0&&(t=!1),function(e){return e.lift(new qu(r,t))}}var qu=function(){function r(t,e){this.predicate=t,this.inclusive=e}return r.prototype.call=function(t,e){return e.subscribe(new zu(t,this.predicate,this.inclusive))},r}(),zu=function(r){j(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.predicate=i,s.inclusive=n,s.index=0,s}return t.prototype._next=function(e){var i=this.destination,n;try{n=this.predicate(e,this.index++)}catch(s){i.error(s);return}this.nextOrComplete(e,n)},t.prototype.nextOrComplete=function(e,i){var n=this.destination;Boolean(i)?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(J);function Ui(r,t,e){return function(n){return n.lift(new Wu(r,t,e))}}var Wu=function(){function r(t,e,i){this.nextOrObserver=t,this.error=e,this.complete=i}return r.prototype.call=function(t,e){return e.subscribe(new Ju(t,this.nextOrObserver,this.error,this.complete))},r}(),Ju=function(r){j(t,r);function t(e,i,n,s){var o=r.call(this,e)||this;return o._tapNext=qt,o._tapError=qt,o._tapComplete=qt,o._tapError=n||qt,o._tapComplete=s||qt,$r(i)?(o._context=o,o._tapNext=i):i&&(o._context=i,o._tapNext=i.next||qt,o._tapError=i.error||qt,o._tapComplete=i.complete||qt),o}return t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(i){this.destination.error(i);return}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(i){this.destination.error(i);return}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){this.destination.error(e);return}return this.destination.complete()},t}(J);function Eo(r,t,e){return e===void 0&&(e=lo),function(i){var n=Su(r),s=n?+r-e.now():Math.abs(r);return i.lift(new Yu(s,n,t,e))}}var Yu=function(){function r(t,e,i,n){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=i,this.scheduler=n}return r.prototype.call=function(t,e){return e.subscribe(new Xu(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},r}(),Xu=function(r){j(t,r);function t(e,i,n,s,o){var a=r.call(this,e)||this;return a.absoluteTimeout=i,a.waitFor=n,a.withObservable=s,a.scheduler=o,a.scheduleTimeout(),a}return t.dispatchTimeout=function(e){var i=e.withObservable;e._unsubscribeAndRecycle(),e.add(br(i,new mr(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),r.prototype._next.call(this,e)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(yr),Qu=function(r,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(s){return function(o){return function(a,c){var l={key:a,value:o[a]},h={key:c,value:o[c]};return s(l,h)}}}(t.cmp),n=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(n.indexOf(o)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=n.push(o)-1,h=Object.keys(o).sort(i&&i(o));for(c="",a=0;a<h.length;a++){var p=h[a],y=s(o[p]);!y||(c&&(c+=","),c+=JSON.stringify(p)+":"+y)}return n.splice(l,1),"{"+c+"}"}}(r)},wo;class Zu extends Error{constructor(t){super(`The map type '${t}' is invalid`),this.mapType=t,this.name="InvalidMapTypeError"}}const So=Symbol.for("taquito-michelson-map-type-symbol"),th=r=>"args"in r&&Array.isArray(r.args)&&r.args.length===2;class us extends Error{constructor(t,e,i){super(`${i} not compliant with underlying michelson type`),this.value=t,this.type=e,this.name="MapTypecheckError"}}class dt{constructor(t){this.valueMap=new Map,this.keyMap=new Map,this[wo]=!0,t&&this.setType(t)}static isMichelsonMap(t){return t&&t[So]===!0}setType(t){if(!th(t))throw new Zu(t.toString());this.keySchema=new gt(t.args[0]),this.valueSchema=new gt(t.args[1])}removeType(){this.keySchema=void 0,this.valueSchema=void 0}static fromLiteral(t,e){const i=new dt(e);return Object.keys(t).forEach(n=>{i.set(n,t[n])}),i}typecheckKey(t){return this.keySchema?this.keySchema.Typecheck(t):!0}typecheckValue(t){return this.valueSchema?this.valueSchema.Typecheck(t):!0}assertTypecheckValue(t){if(!this.typecheckValue(t))throw new us(t,this.valueSchema,"value")}assertTypecheckKey(t){if(!this.typecheckKey(t))throw new us(t,this.keySchema,"key")}serializeDeterministically(t){return Qu(t)}*keys(){for(const[t]of this.entries())yield t}*values(){for(const[,t]of this.entries())yield t}*entries(){for(const t of this.valueMap.keys())yield[this.keyMap.get(t),this.valueMap.get(t)]}get(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.valueMap.get(e)}set(t,e){this.assertTypecheckKey(t),this.assertTypecheckValue(e);const i=this.serializeDeterministically(t);this.keyMap.set(i,t),this.valueMap.set(i,e)}delete(t){this.assertTypecheckKey(t),this.keyMap.delete(this.serializeDeterministically(t)),this.valueMap.delete(this.serializeDeterministically(t))}has(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.keyMap.has(e)&&this.valueMap.has(e)}clear(){this.keyMap.clear(),this.valueMap.clear()}get size(){return this.keyMap.size}forEach(t){for(const[e,i]of this.entries())t(i,e,this)}}wo=So;class H extends Error{constructor(t,e,i){super(),this.value=t,this.token=e,this.name="ValidationError";const n=this.token.annot(),s=n?`[${n}] `:"";this.message=`${s}${i}`}}class tt{constructor(t,e,i){this.val=t,this.idx=e,this.fac=i,this.createToken=this.fac}typeWithoutAnnotations(){const t=i=>{if(typeof i=="object"){if(Array.isArray(i))return i.map(o=>t(o));const n=i;return n.args?{prim:n.prim,args:n.args.map(s=>t(s))}:{prim:n.prim}}return i};return(i=>i.args?{prim:i.prim,args:i.args.map(n=>t(n))}:{prim:i.prim})(this.val)}annot(){return(Array.isArray(this.val.annots)&&this.val.annots.length>0?this.val.annots[0]:String(this.idx)).replace(/(%|:)(_Liq_entry_)?/,"")}hasAnnotations(){return Array.isArray(this.val.annots)&&this.val.annots.length}get tokenVal(){return this.val}ExtractSignature(){return[[this.ExtractSchema()]]}}class z extends tt{compare(t,e){return t===e?0:t<e?-1:1}}class hs extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="BigMapValidationError"}}class St extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}ExtractSchema(){return{big_map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:St.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}isValid(t){return dt.isMichelsonMap(t)?null:new hs(t,this,"Value must be a MichelsonMap")}objLitToMichelsonMap(t){return t instanceof dt?t:typeof t=="object"?Object.keys(t).length===0?new dt:dt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),i=this.isValid(e);if(i)throw i;return Array.from(e.keys()).sort((n,s)=>this.KeySchema.compare(n,s)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(e.get(n))]}))}EncodeObject(t,e){const i=this.objLitToMichelsonMap(t),n=this.isValid(i);if(n)throw n;return e&&e[St.prim]?e[St.prim](i,this.val):Array.from(i.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(i.get(s))]}))}Execute(t,e){if(e&&e[St.prim])return e[St.prim](t,this.val);if(Array.isArray(t)){const i=new dt(this.val);return t.forEach(n=>{i.set(this.KeySchema.ToKey(n.args[0]),this.ValueSchema.Execute(n.args[1]))}),i}else{if("int"in t)return t.int;throw new hs(t,this,`Big map is expecting either an array (Athens) or an object with an int property (Babylon). Got ${JSON.stringify(t)}`)}}findAndReturnTokens(t,e){return St.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}St.prim="big_map";class eh extends Error{constructor(t){super(t),this.message=t,this.name="OrTokenDecodingError"}}class M extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){const e=t[t.length-1],i=this.createToken(this.val.args[0],this.idx);let n=1;i instanceof M&&(n=Object.keys(i.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+n);if(String(i.annot())===String(e)&&!(i instanceof M))return t.pop(),{prim:"Left",args:[i.Encode(t)]};if(String(s.annot())===String(e)&&!(s instanceof M))return t.pop(),{prim:"Right",args:[s.Encode(t)]};if(i instanceof M){const o=i.Encode(t);if(o)return{prim:"Left",args:[o]}}if(s instanceof M){const o=s.Encode(t);if(o)return{prim:"Right",args:[o]}}return null}ExtractSignature(){const t=this.createToken(this.val.args[0],this.idx);let e=1;t instanceof M&&(e=Object.keys(t.ExtractSchema()).length);const i=this.createToken(this.val.args[1],this.idx+e),n=[];if(t instanceof M)n.push(...t.ExtractSignature());else for(const s of t.ExtractSignature())n.push([t.annot(),...s]);if(i instanceof M)n.push(...i.ExtractSignature());else for(const s of i.ExtractSignature())n.push([i.annot(),...s]);return n}EncodeObject(t,e){const i=Object.keys(t)[0],n=this.createToken(this.val.args[0],this.idx);let s=1;n instanceof M&&(s=Object.keys(n.ExtractSchema()).length);const o=this.createToken(this.val.args[1],this.idx+s);if(String(n.annot())===String(i)&&!(n instanceof M))return{prim:"Left",args:[n.EncodeObject(t[i],e)]};if(String(o.annot())===String(i)&&!(o instanceof M))return{prim:"Right",args:[o.EncodeObject(t[i],e)]};if(n instanceof M){const a=n.EncodeObject(t,e);if(a)return{prim:"Left",args:[a]}}if(o instanceof M){const a=o.EncodeObject(t,e);if(a)return{prim:"Right",args:[a]}}return null}Execute(t,e){const i=this.createToken(this.val.args[0],this.idx);let n=1;i instanceof M&&(n=Object.keys(i.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+n);if(t.prim==="Right")return s instanceof M?s.Execute(t.args[0],e):{[s.annot()]:s.Execute(t.args[0],e)};if(t.prim==="Left")return i instanceof M?i.Execute(t.args[0],e):{[i.annot()]:i.Execute(t.args[0],e)};throw new eh(`Was expecting Left or Right prim but got: ${t.prim}`)}traversal(t,e,i){const n=this.createToken(this.val.args[0],this.idx);let s=1,o;n instanceof M&&!n.hasAnnotations()?(o=t(n),s=Object.keys(n.ExtractSchema()).length):o={[n.annot()]:t(n)};const a=this.createToken(this.val.args[1],this.idx+s);let c;return a instanceof M&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},i(o,c)}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}generateSchema(){return{__michelsonType:M.prim,schema:this.traversal(t=>t instanceof M&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof M&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}}findToken(t){const e=this.createToken(this.val.args[0],this.idx);let i=1;e instanceof M&&(i=Object.keys(e.ExtractSchema()).length);const n=this.createToken(this.val.args[1],this.idx+i);if(String(e.annot())===String(t)&&!(e instanceof M)&&e instanceof z)return e;if(String(n.annot())===String(t)&&!(n instanceof M)&&n instanceof z)return n;if(e instanceof M){const s=e.findToken(t);if(s)return s}if(n instanceof M){const s=n.findToken(t);if(s)return s}return null}compare(t,e){const i=Object.keys(t)[0],n=Object.keys(e)[0];if(i===n){const s=this.findToken(i);if(s instanceof z)return s.compare(t[i],e[i])}else{const s=JSON.stringify(this.EncodeObject(t)),o=JSON.stringify(this.EncodeObject(e));return s<o?-1:1}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return M.prim===t&&e.push(this),this.traversal(i=>i.findAndReturnTokens(t,e),i=>i.findAndReturnTokens(t,e),(i,n)=>Object.assign(Object.assign({},i),n)),e}}M.prim="or";class rh extends Error{constructor(t){super(t),this.message=t,this.name="TokenArgumentValidationError"}}class ih extends Error{constructor(t,e){super(`Tokens ${t} and ${e} are not comparable`),this.val1=t,this.val2=e,this.name="TokenComparisonError"}}function Ki(r,t=Y.prim){if(Array.isArray(r))return Ki({prim:t,args:r},t);if(r.args===void 0)throw new rh("Encountered an invalid PairToken with no arguments, a pair must have two or more arguments");return r.args.length>2?[r.args[0],{prim:t,args:r.args.slice(1)}]:[r.args[0],r.args[1]]}class Y extends z{constructor(t,e,i){super(Array.isArray(t)?{prim:Y.prim,args:t}:t.prim?t:{prim:Y.prim,args:t},e,i)}args(){return Ki(this.val)}tokens(){let t=0;return this.args().map(e=>{const i=this.createToken(e,this.idx+t);return i instanceof Y?t+=Object.keys(i.ExtractSchema()).length:t++,i})}Encode(t){return{prim:"Pair",args:this.tokens().map(e=>e.Encode(t))}}ExtractSignature(){const t=this.args(),e=this.createToken(t[0],this.idx);let i=1;e instanceof M&&(i=Object.keys(e.ExtractSchema()).length);const n=this.createToken(t[1],this.idx+i),s=[];for(const o of e.ExtractSignature())for(const a of n.ExtractSignature())s.push([...o,...a]);return s}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}ToKey(t){return this.Execute(t)}EncodeObject(t,e){const[i,n]=this.tokens();let s;i instanceof Y&&!i.hasAnnotations()?s=t:s=t[i.annot()];let o;return n instanceof Y&&!n.hasAnnotations()?o=t:o=t[n.annot()],{prim:"Pair",args:[i.EncodeObject(s,e),n.EncodeObject(o,e)]}}traversal(t,e){const i=this.args(),n=this.createToken(i[0],this.idx);let s=1,o;n instanceof Y&&(s=Object.keys(n.ExtractSchema()).length),n instanceof Y&&!n.hasAnnotations()?o=t(n):o={[n.annot()]:t(n)};const a=this.createToken(i[1],this.idx+s);let c;return a instanceof Y&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},Object.assign(Object.assign({},o),c)}Execute(t,e){const i=Ki(t,"Pair");return this.traversal(n=>n.Execute(i[0],e),n=>n.Execute(i[1],e))}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema())}generateSchema(){return{__michelsonType:Y.prim,schema:this.traversal(t=>t instanceof Y&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof Y&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema())}}compare(t,e){const[i,n]=this.tokens(),s=(o,a)=>o instanceof Y&&!o.hasAnnotations()?a:a[o.annot()];if(i instanceof z&&n instanceof z){const o=i.compare(s(i,t),s(i,e));return o===0?n.compare(s(n,t),s(n,e)):o}throw new ih(t,e)}findAndReturnTokens(t,e){return Y.prim===t&&e.push(this),this.tokens().map(i=>i.findAndReturnTokens(t,e)),e}}Y.prim="pair";class ls extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="NatValidationError"}}class xt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new V(t[Object.keys(t)[0]])}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:new V(e).toFixed()}}isValid(t){const e=new V(t);return e.isNaN()?new ls(t,this,`Value is not a number: ${t}`):e.isNegative()?new ls(t,this,`Value cannot be negative: ${t}`):null}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[xt.prim]?e[xt.prim](t):{int:new V(t).toFixed()}}ExtractSchema(){return xt.prim}generateSchema(){return{__michelsonType:xt.prim,schema:xt.prim}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:xt.prim}}}ToKey({int:t}){return new V(t)}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return xt.prim===t&&e.push(this),e}}xt.prim="nat";class Nt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return Nt.prim}generateSchema(){return{__michelsonType:Nt.prim,schema:Nt.prim}}Encode(t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[Nt.prim]?e[Nt.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Nt.prim}}}findAndReturnTokens(t,e){return Nt.prim===t&&e.push(this),e}}Nt.prim="string";class Ii extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="AddressValidationError"}}class zt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:pa(t)},type:{prim:"bytes"}}}isValid(t){return q(t)!==L.VALID?new Ii(t,this,`Address is not valid: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[zt.prim]?e[zt.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Ii(t,this,`cannot be missing both string and bytes: ${t}`);return Vi(t.bytes)}ExtractSchema(){return zt.prim}generateSchema(){return{__michelsonType:zt.prim,schema:zt.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new Ii({bytes:t,string:e},this,`cannot be missing both string and bytes ${{string:e,bytes:t}}`);return Vi(t)}compare(t,e){const i=o=>o.startsWith("tz"),n=i(t),s=i(e);return n&&!s?-1:s&&!n?1:super.compare(t,e)}findAndReturnTokens(t,e){return zt.prim===t&&e.push(this),e}}zt.prim="address";class nh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="MapValidationError"}}class Ne extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return dt.isMichelsonMap(t)?null:new nh(t,this,"Value must be a MichelsonMap")}Execute(t,e){const i=new dt(this.val);return t.forEach(n=>{i.set(this.KeySchema.ToKey(n.args[0]),this.ValueSchema.Execute(n.args[1],e))}),i}objLitToMichelsonMap(t){return t instanceof dt?t:typeof t=="object"?Object.keys(t).length===0?new dt:dt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),i=this.isValid(e);if(i)throw i;return Array.from(e.keys()).sort((n,s)=>this.KeySchema.compare(n,s)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(e.get(n))]}))}EncodeObject(t,e){const i=this.objLitToMichelsonMap(t),n=this.isValid(i);if(n)throw n;return e&&e[Ne.prim]?e[Ne.prim](i):Array.from(i.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(i.get(s))]}))}ExtractSchema(){return{map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Ne.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}findAndReturnTokens(t,e){return Ne.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}Ne.prim="map";class Tt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return String(t.prim).toLowerCase()==="true"}Encode(t){return{prim:t.pop()?"True":"False"}}EncodeObject(t,e){return e&&e[Tt.prim]?e[Tt.prim](t):{prim:t?"True":"False"}}ExtractSchema(){return Tt.prim}generateSchema(){return{__michelsonType:Tt.prim,schema:Tt.prim}}ToBigMapKey(t){return{key:this.EncodeObject(t),type:{prim:Tt.prim}}}ToKey(t){return this.EncodeObject(t)}compare(t,e){return t&&e||!t&&!e?0:t?1:-1}findAndReturnTokens(t,e){return Tt.prim===t&&e.push(this),e}}Tt.prim="bool";class Sr extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="TxRollupL2AddressValidationError"}}class Wt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:fa(t)},type:{prim:"bytes"}}}isValid(t){if(q(t)!==L.VALID)throw new Sr(t,this,`tx_rollup_l2_address is not valid: ${t}`);return null}Encode(t){const e=t.pop();if(!e)throw new Sr(e,this,`arg missing to encode: this -> "${e}"`);return this.isValid(e),{string:e}}EncodeObject(t,e){return this.isValid(t),e&&e[Wt.prim]?e[Wt.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Sr(t,this,`value cannot be missing string and byte value. must have one ${JSON.stringify(t)}`);return wn(t.bytes)}ExtractSchema(){return Wt.prim}generateSchema(){return{__michelsonType:Wt.prim,schema:Wt.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new Sr(t,this,`value cannot be missing string and byte value. must have one: bytes = ${t}`);return wn(t)}findAndReturnTokens(t,e){return Wt.prim===t&&e.push(this),e}}Wt.prim="tx_rollup_l2_address";class ps extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ContractValidationError"}}class Pt extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return q(t)!==L.VALID?new ps(t,this,"Contract address is not valid"):null}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new ps(t,this,"must contain bytes or string");return Vi(t.bytes)}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Pt.prim]?e[Pt.prim](t):{string:t}}ExtractSchema(){return Pt.prim}generateSchema(){const t=this.createToken(this.val.args[0],0);return{__michelsonType:Pt.prim,schema:{parameter:this.val.args[0]?t.generateSchema():{}}}}findAndReturnTokens(t,e){return Pt.prim===t&&e.push(this),e}}Pt.prim="contract";class sh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ListValidationError"}}class pe extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get valueSchema(){return this.createToken(this.val.args[0],this.idx)}isValid(t){return Array.isArray(t)?null:new sh(t,this,"Value must be an array")}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;const n=this.createToken(this.val.args[0],0);return e.reduce((s,o)=>[...s,n.EncodeObject(o)],[])}Execute(t,e){const i=this.createToken(this.val.args[0],0),n=this.isValid(t);if(n)throw n;return t.reduce((s,o)=>[...s,i.Execute(o,e)],[])}EncodeObject(t,e){const i=this.createToken(this.val.args[0],0),n=this.isValid(t);if(n)throw n;return e&&e[pe.prim]?e[pe.prim](t):t.reduce((s,o)=>[...s,i.EncodeObject(o)],[])}ExtractSchema(){return{[pe.prim]:this.valueSchema.ExtractSchema()}}generateSchema(){return{__michelsonType:pe.prim,schema:this.valueSchema.generateSchema()}}findAndReturnTokens(t,e){return pe.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),e}}pe.prim="list";class oh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="MutezValidationError"}}class Lt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new V(t[Object.keys(t)[0]])}ExtractSchema(){return Lt.prim}generateSchema(){return{__michelsonType:Lt.prim,schema:Lt.prim}}isValid(t){return new V(t).isNaN()?new oh(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:String(e).toString()}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Lt.prim]?e[Lt.prim](t):{int:String(t).toString()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:Lt.prim}}}ToKey({int:t}){return t}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return Lt.prim===t&&e.push(this),e}}Lt.prim="mutez";class ah extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="BytesValidationError"}}class Ct extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:t},type:{prim:Ct.prim}}}isValid(t){return typeof t=="string"&&/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new ah(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:String(e).toString()}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[Ct.prim]?e[Ct.prim](t):{bytes:String(t).toString()}}Execute(t){return t.bytes}ExtractSchema(){return Ct.prim}generateSchema(){return{__michelsonType:Ct.prim,schema:Ct.prim}}ToKey({bytes:t,string:e}){return e||t}findAndReturnTokens(t,e){return Ct.prim===t&&e.push(this),e}}Ct.prim="bytes";class Je extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}subToken(){return this.createToken(this.val.args[0],this.idx)}schema(){return this.createToken(this.val.args[0],0)}annot(){return Array.isArray(this.val.annots)?super.annot():this.createToken(this.val.args[0],this.idx).annot()}Encode(t){const e=t;return e==null?{prim:"None"}:Array.isArray(e)&&(e[e.length-1]===void 0||e[e.length-1]===null)?(e.pop(),{prim:"None"}):{prim:"Some",args:[this.schema().Encode(t)]}}EncodeObject(t,e){const i=t;return i==null?{prim:"None"}:{prim:"Some",args:[this.schema().EncodeObject(i,e)]}}Execute(t,e){return t.prim==="None"?null:this.schema().Execute(t.args[0],e)}ExtractSchema(){return this.schema().ExtractSchema()}generateSchema(){return{__michelsonType:Je.prim,schema:this.schema().generateSchema()}}ExtractSignature(){return[...this.schema().ExtractSignature(),[]]}get KeySchema(){return this.schema()}compare(t,e){if(t){if(!e)return 1}else return-1;return this.KeySchema.compare(t,e)}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return Je.prim===t&&e.push(this),this.subToken().findAndReturnTokens(t,e),e}}Je.prim="option";class jt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){if(t.string&&/^\d+$/.test(t.string))return new Date(Number(t.string)*1e3).toISOString();if(t.string)return new Date(t.string).toISOString();if(t.int)return new Date(Number(t.int)*1e3).toISOString()}Encode(t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[jt.prim]?e[jt.prim](t):{string:t}}ExtractSchema(){return jt.prim}generateSchema(){return{__michelsonType:jt.prim,schema:jt.prim}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:jt.prim}}}findAndReturnTokens(t,e){return jt.prim===t&&e.push(this),e}}jt.prim="timestamp";class ch extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="IntValidationError"}}class pt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new V(t[Object.keys(t)[0]])}ExtractSchema(){return pt.prim}generateSchema(){return{__michelsonType:pt.prim,schema:pt.prim}}isValid(t){return new V(t).isNaN()?new ch(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:new V(e).toFixed()}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[pt.prim]?e[pt.prim](t):{int:new V(t).toFixed()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:pt.prim}}}ToKey({int:t}){return t}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return pt.prim===t&&e.push(this),e}}pt.prim="int";class $t extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){return t.pop(),{prim:"Unit"}}EncodeObject(t,e){return e&&e[$t.prim]?e[$t.prim](t):{prim:"Unit"}}Execute(t){return bs}ExtractSchema(){return $t.prim}generateSchema(){return{__michelsonType:$t.prim,schema:$t.prim}}compare(t,e){return 0}ToKey(t){return bs}ToBigMapKey(t){return{key:{prim:"Unit"},type:{prim:$t.prim}}}findAndReturnTokens(t,e){return $t.prim===t&&e.push(this),e}}$t.prim="unit";const uh=4;class hh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="KeyValidationError"}}class Mt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:da(t.bytes)}isValid(t){return ga(t)!==L.VALID?new hh(t,this,"Key is not valid"):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Mt.prim]?e[Mt.prim](t):{string:t}}ExtractSchema(){return Mt.prim}generateSchema(){return{__michelsonType:Mt.prim,schema:Mt.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Mt.prim}}}compare(t,e){const i=this.getPrefix(t),n=this.getPrefix(e);if(i===ue.EDPK&&n!==ue.EDPK)return-1;if(i===ue.SPPK&&n!==ue.SPPK)return n===ue.EDPK?1:-1;if(i===ue.P2PK){if(n!==ue.P2PK)return 1;const s=this.getP256PublicKeyComparableBytes(t),o=this.getP256PublicKeyComparableBytes(e);return Buffer.compare(s,o)}return super.compare(t,e)}getPrefix(t){return t.substring(0,uh)}getP256PublicKeyComparableBytes(t){return ma(t,ya[ue.P2PK]).slice(1)}findAndReturnTokens(t,e){return Mt.prim===t&&e.push(this),e}}Mt.prim="key";class lh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="KeyHashValidationError"}}class Bt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:Sn(t.bytes)}isValid(t){return Zi(t)!==L.VALID?new lh(t,this,`KeyHash is not valid: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Bt.prim]?e[Bt.prim](t):{string:t}}ExtractSchema(){return Bt.prim}generateSchema(){return{__michelsonType:Bt.prim,schema:Bt.prim}}ToKey({string:t,bytes:e}){return t||Sn(e)}ToBigMapKey(t){return{key:{string:t},type:{prim:Bt.prim}}}findAndReturnTokens(t,e){return Bt.prim===t&&e.push(this),e}}Bt.prim="key_hash";class ph extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SignatureValidationError"}}class Vt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:t.bytes}isValid(t){return ba(t)!==L.VALID?new ph(t,this,"Signature is not valid"):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Vt.prim]?e[Vt.prim](t):{string:t}}ExtractSchema(){return Vt.prim}generateSchema(){return{__michelsonType:Vt.prim,schema:Vt.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Vt.prim}}}findAndReturnTokens(t,e){return Vt.prim===t&&e.push(this),e}}Vt.prim="signature";class fe extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get paramSchema(){return this.createToken(this.val.args[0],this.idx)}get returnSchema(){return this.createToken(this.val.args[1],this.idx+1)}Execute(t){return t.string?t.string:t}Encode(t){return t.pop()}EncodeObject(t,e){return e&&e[fe.prim]?e[fe.prim](t):t}ExtractSchema(){return{[fe.prim]:{parameters:this.paramSchema.ExtractSchema(),returns:this.returnSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:fe.prim,schema:{parameters:this.paramSchema.generateSchema(),returns:this.returnSchema.generateSchema()}}}findAndReturnTokens(t,e){return fe.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),this.createToken(this.val.args[1],this.idx).findAndReturnTokens(t,e),e}}fe.prim="lambda";class Jt extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string}Encode(...t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[Jt.prim]?e[Jt.prim](t):{string:t}}ExtractSchema(){return Jt.prim}generateSchema(){return{__michelsonType:Jt.prim,schema:Jt.prim}}findAndReturnTokens(t,e){return Jt.prim===t&&e.push(this),e}}Jt.prim="operation";class fh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SetValidationError"}}class de extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return Array.isArray(t)?null:new fh(t,this,"Value must be an array")}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return e.sort((n,s)=>this.KeySchema.compare(n,s)).reduce((n,s)=>[...n,this.KeySchema.EncodeObject(s)],[])}Execute(t,e){return t.reduce((i,n)=>[...i,this.KeySchema.Execute(n,e)],[])}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[de.prim]?e[de.prim](t):t.sort((n,s)=>this.KeySchema.compare(n,s)).reduce((n,s)=>[...n,this.KeySchema.EncodeObject(s)],[])}ExtractSchema(){return de.prim}generateSchema(){return{__michelsonType:de.prim,schema:this.KeySchema.generateSchema()}}findAndReturnTokens(t,e){return de.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),e}}de.prim="set";class dh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChainIDValidationError"}}class Dt extends z{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return $s(t)!==L.VALID?new dh(t,this,"ChainID is not valid"):null}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return Dt.prim}generateSchema(){return{__michelsonType:Dt.prim,schema:Dt.prim}}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Dt.prim]?e[Dt.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Dt.prim}}}findAndReturnTokens(t,e){return Dt.prim===t&&e.push(this),e}}Dt.prim="chain_id";class fs extends Error{constructor(){super("Tickets cannot be sent to the blockchain; they are created on-chain"),this.name="TicketEncodeError"}}const gh={prim:"contract"},mh={prim:"int"};class Yt extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new fs}EncodeObject(t,e){if(e&&e[Yt.prim])return e[Yt.prim](t,this.val);throw new fs}Execute(t,e){if(e&&e[Yt.prim])return e[Yt.prim](t,this.val);const i=this.createToken(gh,this.idx),n=this.valueToken,s=this.createToken(mh,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:i.Execute(t.args[0],e),value:n.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:i.Execute(t.args[0],e),value:n.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:Pt.prim,value:this.valueToken.ExtractSchema(),amount:pt.prim}}generateSchema(){return{__michelsonType:Yt.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:Pt.prim,schema:Pt.prim},amount:{__michelsonType:pt.prim,schema:pt.prim}}}}findAndReturnTokens(t,e){return Yt.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}Yt.prim="ticket";class xi extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="NeverTokenError"}}class Xt extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){const e=t.pop();throw new xi(e,this,"Assigning a value to the type never is forbidden.")}EncodeObject(t,e){if(e&&e[Xt.prim])return e[Xt.prim](t);throw new xi(t,this,"Assigning a value to the type never is forbidden.")}Execute(t){throw new xi(t,this,"There is no literal value for the type never.")}ExtractSchema(){return Xt.prim}generateSchema(){return{__michelsonType:Xt.prim,schema:Xt.prim}}findAndReturnTokens(t,e){return Xt.prim===t&&e.push(this),e}}Xt.prim="never";class Ni extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SaplingStateValidationError"}}class kt extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return typeof t=="object"&&Object.keys(t).length===0}Execute(t,e){if(e&&e[kt.prim])return e[kt.prim](t,this.val);if("int"in t)return t.int;throw new Ni(t,this,`Sapling state is expecting an object with an int property. Got ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();if(this.isValid(e))return[];throw new Ni(e,this,`Invalid sapling_state. Received: ${e} while expecting: {}`)}EncodeObject(t,e){if(e&&e[kt.prim])return e[kt.prim](t);if(this.isValid(t))return[];throw new Ni(t,this,`Invalid sapling_state. Received: ${t} while expecting: {}`)}ExtractSchema(){return{[kt.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:kt.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return kt.prim===t&&e.push(this),e}}kt.prim="sapling_state";class ds extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SaplingTransactionValidationError"}}class ge extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){throw new ds(t,this,"There is no literal value for the sapling_transaction type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new ds(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[ge.prim]?e[ge.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[ge.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:ge.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return ge.prim===t&&e.push(this),e}}ge.prim="sapling_transaction";class yh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381frValidationError"}}class Qt extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new yh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();if(typeof e=="number")return{int:e.toString()};{e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}}EncodeObject(t,e){if(e&&e[Qt.prim])return e[Qt.prim](t);if(typeof t=="number")return{int:t.toString()};{t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return{bytes:t}}}Execute(t){return t.bytes}ExtractSchema(){return Qt.prim}generateSchema(){return{__michelsonType:Qt.prim,schema:Qt.prim}}findAndReturnTokens(t,e){return Qt.prim===t&&e.push(this),e}}Qt.prim="bls12_381_fr";class bh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381g1ValidationError"}}class Zt extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new bh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[Zt.prim]?e[Zt.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Zt.prim}generateSchema(){return{__michelsonType:Zt.prim,schema:Zt.prim}}findAndReturnTokens(t,e){return Zt.prim===t&&e.push(this),e}}Zt.prim="bls12_381_g1";class vh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381g2ValidationError"}}class te extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new vh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[te.prim]?e[te.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return te.prim}generateSchema(){return{__michelsonType:te.prim,schema:te.prim}}findAndReturnTokens(t,e){return te.prim===t&&e.push(this),e}}te.prim="bls12_381_g2";class Eh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChestValidationError"}}class ee extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Eh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[ee.prim]?e[ee.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return ee.prim}generateSchema(){return{__michelsonType:ee.prim,schema:ee.prim}}findAndReturnTokens(t,e){return ee.prim===t&&e.push(this),e}}ee.prim="chest";class wh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChestKeyValidationError"}}class re extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new wh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[re.prim]?e[re.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return re.prim}generateSchema(){return{__michelsonType:re.prim,schema:re.prim}}findAndReturnTokens(t,e){return re.prim===t&&e.push(this),e}}re.prim="chest_key";class gs extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="GlobalConstantEncodingError"}}class Sh extends H{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="GlobalConstantDecodingError"}}class Ft extends tt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t,e){if(e&&e[Ft.prim])return e[Ft.prim](t,this.val);throw new Sh(t,this,`Unable to decode a value represented by a globalThis constants. Please provide an expanded script to the Michelson-Encoder or semantics for the decoding. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}Encode(t){throw new gs(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}EncodeObject(t,e){if(e&&e[Ft.prim])return e[Ft.prim](t);throw new gs(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}ExtractSchema(){return Ft.prim}generateSchema(){return{__michelsonType:Ft.prim,schema:{hash:this.val.args[0].string}}}findAndReturnTokens(t,e){return Ft.prim===t&&e.push(this),e}}Ft.prim="constant";const Oh=[Y,xt,Nt,St,zt,Wt,Ne,Tt,M,Pt,pe,Lt,Ct,Je,jt,pt,$t,Mt,Bt,Vt,fe,Jt,de,Dt,Yt,Xt,kt,ge,Qt,Zt,te,ee,re,Ft];class _h extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="Invalid token error"}}function je(r,t){if(Array.isArray(r))return new Y(r,t,je);const e=Oh.find(i=>i.prim===r.prim);if(!e)throw new _h("Malformed data expected a value with a valid prim property",r);return new e(r,t,je)}class Rh extends Error{constructor(t,e){super(`Unable to encode the parameter of the view: ${t}.`),this.smartContractViewName=t,this.originalError=e,this.name="ViewEncodingError"}}class ms extends Error{constructor(t){super(t),this.message=t,this.name="InvalidScriptError"}}class Oo extends Error{constructor(t){super("Invalid RPC response passed as argument(s)"),this.script=t,this.name="InvalidRpcResponseError"}}class ys extends Error{constructor(t,e,i){super(`
      ${t}. Error encountered when trying to encode arguments: 

      [${e}]
    `),this.message=t,this.args=e,this.originalError=i,this.name="ParameterEncodingError"}}class Or extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapSchema"}}class Ah extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapDiff"}}class Ph extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="BigMapEncodingError"}}class Ih extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="StorageEncodingError"}}class xh extends Error{constructor(t){super(t),this.message=t,this.name="MissingArgumentError"}}var _o;const Ro=Symbol.for("taquito-schema-type-symbol");function lr(r,t=Y.prim){var e,i;if(Array.isArray(r))return lr({prim:t,args:r},t);const n=r;return n.prim===t&&n.args&&n.args.length>2?Object.assign(Object.assign({},n),{args:[(e=n.args)===null||e===void 0?void 0:e[0],{prim:t,args:(i=n.args)===null||i===void 0?void 0:i.slice(1)}]}):n}function Ao(r,t){const e=lr(r),i=lr(t);return e.prim===i.prim&&(e.args===void 0&&i.args===void 0||e.args!==void 0&&i.args!==void 0&&e.args.length===i.args.length&&e.args.every((n,s)=>{var o,a;return Ao(n,(a=(o=i.args)===null||o===void 0?void 0:o[s])!==null&&a!==void 0?a:{})}))&&(e.annots===void 0&&i.annots===void 0||e.annots!==void 0&&i.annots!==void 0&&e.annots.length===i.annots.length&&e.annots.every((n,s)=>{var o;return n===((o=i.annots)===null||o===void 0?void 0:o[s])}))}class gt{constructor(t){if(this.val=t,this[_o]=!0,this.root=je(t,0),this.root instanceof St)this.bigMap=this.root;else if(this.isExpressionExtended(t)&&t.prim==="pair"){const e=t.args[0];this.isExpressionExtended(e)&&e.prim==="big_map"&&(this.bigMap=new St(e,0,je))}}static isSchema(t){return t&&t[Ro]===!0}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(i=>{if(Array.isArray(i))this.fromRPCResponse({script:{code:i,storage:t.script.storage}});else{const n=i;return n.prim?n.prim==="storage":!1}});if(!e||!Array.isArray(e.args))throw new Oo(t.script);return new gt(e.args[0])}isExpressionExtended(t){return"prim"in t&&Array.isArray(t.args)}removeTopLevelAnnotation(t){return(this.root instanceof Y||this.root instanceof M)&&this.root.hasAnnotations()&&typeof t=="object"&&Object.keys(t).length===1?t[Object.keys(t)[0]]:t}Execute(t,e){const i=this.root.Execute(t,e);return this.removeTopLevelAnnotation(i)}Typecheck(t){if(this.root instanceof St&&Number.isInteger(Number(t)))return!0;try{return this.root.EncodeObject(t),!0}catch{return!1}}ExecuteOnBigMapDiff(t,e){if(!this.bigMap)throw new Or("Big map schema is undefined");if(!Array.isArray(t))throw new Ah("Big map diff must be an array");const i=t.map(({key:n,value:s})=>({args:[n,s]}));return this.bigMap.Execute(i,e)}ExecuteOnBigMapValue(t,e){if(!this.bigMap)throw new Or("No big map schema");return this.bigMap.ValueSchema.Execute(t,e)}EncodeBigMapKey(t){if(!this.bigMap)throw new Or("Big map schema is undefined");try{return this.bigMap.KeySchema.ToBigMapKey(t)}catch(e){throw new Ph("big map key",e)}}Encode(t,e){try{return this.root.EncodeObject(t,e)}catch(i){throw i instanceof H?i:new Ih("storage object",i)}}ExtractSchema(){return this.removeTopLevelAnnotation(this.root.ExtractSchema())}generateSchema(){return this.removeTopLevelAnnotation(this.root.generateSchema())}ComputeState(t,e){if(!this.bigMap)throw new Or("Big map schema is undefined");const i=t.reduce((n,s)=>Object.assign(Object.assign({},n),this.ExecuteOnBigMapDiff(s.contents[0].metadata.operation_result.big_map_diff)),{});return Object.assign(Object.assign({},this.Execute(e)),{[this.bigMap.annot()]:i})}FindFirstInTopLevelPair(t,e){return this.findValue(this.root.val,t,e)}findValue(t,e,i){if(Ao(i,t))return e;if(Array.isArray(t)||t.prim==="pair"){const n=lr(t),s=lr(e,"Pair");if(n.args===void 0||s.args===void 0)throw new xh("Tokens have no arguments");if(n.args[0])return this.findValue(n.args[0],s.args[0],i)||this.findValue(n.args[1],s.args[1],i)}}findToken(t){const e=[];return this.root.findAndReturnTokens(t,e)}}_o=Ro;class Fe{constructor(t){this.root=je(t,0)}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(i=>i.prim==="parameter");if(!e||!Array.isArray(e.args))throw new Oo(t.script);return new Fe(e.args[0])}get isMultipleEntryPoint(){return this.root instanceof M||this.root instanceof Je&&this.root.subToken()instanceof M}get hasAnnotation(){return this.isMultipleEntryPoint?Object.keys(this.ExtractSchema())[0]!=="0":!0}Execute(t,e){return this.root.Execute(t,e)}Encode(...t){try{return this.root.Encode(t.reverse())}catch(e){throw e instanceof H?e:new ys("Unable to encode parameter",t.toString(),e)}}EncodeObject(t,e){try{return this.root.EncodeObject(t,e)}catch(i){throw i instanceof H?i:new ys("Unable to encode parameter object",t,i)}}ExtractSchema(){return this.root.ExtractSchema()}generateSchema(){return this.root.generateSchema()}ExtractSignatures(){return this.root.ExtractSignature()}}class dn{constructor(t){if(t.length!==4||!("string"in t[0]))throw new ms(`Invalid on-chain view: ${JSON.stringify(t)}`);this.viewName=t[0].string,this.viewArgsType=t[1],this.viewReturnType=t[2],this.instructions=t[3],this.rootArgsType=je(this.viewArgsType,0),this.rootReturnType=je(this.viewReturnType,0)}static fromRPCResponse(t){const e=[],i=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.filter(n=>n.prim==="view");return i&&i.forEach(n=>{if(!n.args||n.args.length!==4)throw new ms(`Invalid on-chain view found in the script: ${JSON.stringify(n)}`);e.push(new dn(n.args))}),e}encodeViewArgs(t){try{return this.rootArgsType.EncodeObject(t)}catch(e){throw new Rh(this.viewName,e)}}decodeViewResult(t,e){return this.rootReturnType.Execute(t,e)}extractArgsSchema(){return this.rootArgsType.ExtractSchema()}extractResultSchema(){return this.rootReturnType.ExtractSchema()}}const bs=Symbol(),ot=Symbol("source_reference");class Pe extends Error{constructor(t,e,i){super(i),this.src=t,this.idx=e,Object.setPrototypeOf(this,Pe.prototype)}}var at;(function(r){r[r.Comment=0]="Comment",r[r.Number=1]="Number",r[r.String=2]="String",r[r.Bytes=3]="Bytes",r[r.Ident=4]="Ident"})(at||(at={}));const Nh=new RegExp("\\s"),Th=new RegExp("[:@%_A-Za-z]"),Lh=new RegExp("[@%_\\.A-Za-z0-9]"),vs=new RegExp("[0-9]"),Ch=new RegExp("[0-9a-fA-F]");function*Ti(r,t=!1){let e=0;for(;e<r.length;){for(;e<r.length&&Nh.test(r[e]);)e++;if(e===r.length)return;const i=r[e],n=e;if(Th.test(i)){for(e++;e<r.length&&Lh.test(r[e]);)e++;yield{t:at.Ident,v:r.slice(n,e),first:n,last:e}}else if(r.length-e>1&&r.substr(e,2)==="0x"){for(e+=2;e<r.length&&Ch.test(r[e]);)e++;if((e-n&1)!==0)throw new Pe(r,e,"Bytes literal length is expected to be power of two");yield{t:at.Bytes,v:r.slice(n,e),first:n,last:e}}else if(vs.test(i)||i==="-"){i==="-"&&e++;const s=e;for(;e<r.length&&vs.test(r[e]);)e++;if(s===e)throw new Pe(r,e,"Number literal is too short");yield{t:at.Number,v:r.slice(n,e),first:n,last:e}}else if(i==='"'){e++;let s=!1;for(;e<r.length&&(s||r[e]!=='"');e++)!s&&r[e]==="\\"?s=!0:s=!1;if(e===r.length)throw new Pe(r,e,"Unterminated string literal");e++,yield{t:at.String,v:r.slice(n,e),first:n,last:e}}else if(i==="#"){for(e++;e<r.length&&r[e]!==`
`;)e++;t&&(yield{t:at.Comment,v:r.slice(n,e),first:n,last:e})}else if(r.length-e>1&&r.substr(e,2)==="/*"){for(e+=2;e<r.length&&!(r.length-e>1&&r.substr(e,2)==="*/");)e++;if(e===r.length)throw new Pe(r,e,"Unterminated C style comment");e+=2,t&&(yield{t:at.Comment,v:r.slice(n,e),first:n,last:e})}else if(i==="("||i===")"||i==="{"||i==="}"||i===";")e++,yield{t:i,v:i,first:n,last:e};else throw new Pe(r,e,`Invalid character at offset ${e}: \`${i}'`)}}const _r=Symbol("ref_contract");var ye;(function(r){r.Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",r.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",r.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",r.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLoren="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANAD="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(ye||(ye={}));const Po=ye.Psithaca2,Es={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:14};function or(r,t){return Es[r]<Es[t]}class mt extends Error{constructor(t,e){super(e),this.prim=t,Object.setPrototypeOf(this,mt.prototype)}}function U(r,t){var e,i;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new mt(r,`macro ${r.prim} expects ${t} arguments, was given ${(i=r.args)===null||i===void 0?void 0:i.length}`)}function nr(r){if(r.annots===void 0)return!0;throw new mt(r,`unexpected annotation on macro ${r.prim}: ${r.annots}`)}function ws(r,t){if("int"in t)return!0;throw new mt(r,`macro ${r.prim} expects int argument`)}function ar(r,t,e,i){let n=0,s=0;const o=[null,null];let a;if(n===t.length)throw new mt(r,`unexpected end: ${r.prim}`);let c=t[n++];switch(c){case"P":{const{r:h,n:p,an:y}=ar(r,t.slice(n),e.slice(s),i);a=h,n+=p,s+=y;break}case"A":s!==e.length&&(o[0]=e[s++]);break;default:throw new mt(r,`${r.prim}: unexpected character: ${c}`)}let l;if(n===t.length)throw new mt(r,`unexpected end: ${r.prim}`);switch(c=t[n++],c){case"P":{const{r:h,n:p,an:y}=ar(r,t.slice(n),e.slice(s),i);l=h.map(([E,N])=>[E+1,N]),n+=p,s+=y;break}case"I":s!==e.length&&(o[1]=e[s++]);break;default:throw new mt(r,`${r.prim}: unexpected character: ${c}`)}return{r:i(a,l,[0,o]),n,an:s}}function kr(r,t,e,i){const n=t[0];switch(n){case"A":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},kr(r,t.slice(1),[],i)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...e]}]:i.a;case"D":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},kr(r,t.slice(1),[],i)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...e]}]:i.d;default:throw new mt(r,`${r.prim}: unexpected character: ${n}`)}}function jh(r,t){let e=r.length;for(;e>0&&r[e-1]===t;)e--;return r.slice(0,e)}function Li(r){const t=[],e=[];if(r!==void 0)for(const i of r)(i.length!==0&&i[0]==="%"?t:e).push(i);return{fields:t,rest:e}}function X({prim:r,annots:t,args:e}){return Object.assign(Object.assign({prim:r},t&&{annots:t}),e&&{args:e})}const $h=/^P[PAI]{3,}R$/,Mh=/^UNP[PAI]{2,}R$/,Bh=/^C[AD]{2,}R$/,Vh=/^SET_C[AD]+R$/,Dh=/^MAP_C[AD]+R$/,kh=/^DI{2,}P$/,Fh=/^DU+P$/;function Hh(r,t){const e=(t==null?void 0:t.protocol)||Po;function i(n){return n!==void 0?[{prim:"RENAME",annots:n}]:[]}switch(r.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(U(r,0))return[{prim:"COMPARE"},X({prim:r.prim.slice(3),annots:r.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(U(r,2))return[{prim:r.prim.slice(2)},X({prim:"IF",annots:r.annots,args:r.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(U(r,2))return[{prim:"COMPARE"},{prim:r.prim.slice(5)},X({prim:"IF",annots:r.annots,args:r.args})];break;case"FAIL":if(U(r,0)&&nr(r))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(U(r,0)&&nr(r))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(U(r,0)&&nr(r))return[{prim:r.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(U(r,0)&&nr(r))return[[{prim:"COMPARE"},{prim:r.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(U(r,0)&&nr(r))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(U(r,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(r.annots)]}];break;case"ASSERT_LEFT":if(U(r,0))return[{prim:"IF_LEFT",args:[i(r.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(U(r,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(r.annots)]}];break;case"IF_SOME":if(U(r,2))return[X({prim:"IF_NONE",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"IF_RIGHT":if(U(r,2))return[X({prim:"IF_LEFT",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"CAR":case"CDR":if(r.args!==void 0){if(U(r,1)&&ws(r,r.args[0])){const n=parseInt(r.args[0].int,10);return X({prim:"GET",args:[{int:r.prim==="CAR"?String(n*2+1):String(n*2)}],annots:r.annots})}}else return r}if($h.test(r.prim)&&U(r,0)){const{fields:n,rest:s}=Li(r.annots),{r:o}=ar(r,r.prim.slice(1),n,(a,c,l)=>[...a||[],...c||[],l]);return o.map(([a,c],l)=>{const h=[...jh(c,null).map(y=>y===null?"%":y),...a===0&&l===o.length-1?s:[]],p=X({prim:"PAIR",annots:h.length!==0?h:void 0});return a===0?p:{prim:"DIP",args:a===1?[[p]]:[{int:String(a)},[p]]}})}if(Mh.test(r.prim))if(or(e,ye.PtEdo2Zk)&&U(r,0)){const{r:n}=ar(r,r.prim.slice(3),r.annots||[],(s,o,a)=>[a,...o||[],...s||[]]);return n.map(([s,o])=>{const a=[{prim:"DUP"},X({prim:"CAR",annots:o[0]!==null?[o[0]]:void 0}),{prim:"DIP",args:[[X({prim:"CDR",annots:o[1]!==null?[o[1]]:void 0})]]}];return s===0?a:{prim:"DIP",args:s===1?[[a]]:[{int:String(s)},[a]]}})}else{if(r.prim==="UNPAIR")return r;if(U(r,0)){const{r:n}=ar(r,r.prim.slice(3),[],(s,o,a)=>[a,...o||[],...s||[]]);return n.map(([s])=>{const o=X({prim:"UNPAIR"});return s===0?o:{prim:"DIP",args:s===1?[[o]]:[{int:String(s)},[o]]}})}}if(Bh.test(r.prim)&&U(r,0)){const n=[...r.prim.slice(1,r.prim.length-1)];return n.map((s,o)=>{const a=o===n.length-1?r.annots:void 0;switch(s){case"A":return X({prim:"CAR",annots:a});case"D":return X({prim:"CDR",annots:a});default:throw new mt(r,`unexpected character: ${s}`)}})}if(Vh.test(r.prim)&&U(r,0)){const{fields:n,rest:s}=Li(r.annots);if(n.length>1)throw new mt(r,`unexpected annotation on macro ${r.prim}: ${n}`);const o=n.length!==0?{a:[{prim:"DUP"},{prim:"CAR",annots:n},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[n[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:n},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",n[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return kr(r,r.prim.slice(5,r.prim.length-1),s,o)}if(Dh.test(r.prim)&&U(r,1)){const{fields:n}=Li(r.annots);if(n.length>1)throw new mt(r,`unexpected annotation on macro ${r.prim}: ${n}`);const s={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[X({prim:"CAR",annots:n.length!==0?["@"+n[0].slice(1)]:void 0}),r.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[n.length!==0?n[0]:"%","%@"]}],d:[{prim:"DUP"},X({prim:"CDR",annots:n.length!==0?["@"+n[0].slice(1)]:void 0}),r.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",n.length!==0?n[0]:"%"]}]};return kr(r,r.prim.slice(5,r.prim.length-1),[],s)}if(kh.test(r.prim)&&U(r,1)){let n=0;for(;r.prim[1+n]==="I";)n++;return X({prim:"DIP",args:[{int:String(n)},r.args[0]]})}if(Fh.test(r.prim)){let n=0;for(;r.prim[1+n]==="U";)n++;if(or(e,ye.PtEdo2Zk)){if(n===1){if(r.args===void 0)return r;U(r,1)&&ws(r,r.args[0])&&(n=parseInt(r.args[0].int,10))}else U(r,0);return n===1?[X({prim:"DUP",annots:r.annots})]:n===2?[{prim:"DIP",args:[[X({prim:"DUP",annots:r.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(n-1)},[X({prim:"DUP",annots:r.annots})]]},{prim:"DIG",args:[{int:String(n)}]}]}else{if(n===1)return r;if(U(r,0))return X({prim:"DUP",args:[{int:String(n)}],annots:r.annots})}}return r}function Uh(r,t){return r.args!==void 0&&r.args.length===1&&"string"in r.args[0]&&r.args[0].string in t?t[r.args[0].string]:r}class Ke extends Error{constructor(t,e){super(e),this.token=t,Object.setPrototypeOf(this,Ke.prototype)}}class It extends Error{constructor(t,e){super(e),this.node=t,Object.setPrototypeOf(this,It.prototype)}}const Ci=new Ke(null,"Unexpected EOF");function Ss(r){return r.t===at.Ident&&(r.v[0]==="@"||r.v[0]==="%"||r.v[0]===":")}const Kh=new RegExp("^-?[0-9]+$"),Gh=new RegExp("^([0-9a-fA-F]{2})*$");class Te{constructor(t){this.opt=t}expand(t){var e,i,n;if(((e=this.opt)===null||e===void 0?void 0:e.expandGlobalConstant)!==void 0&&t.prim==="constant"){const s=Uh(t,this.opt.expandGlobalConstant);return s!==t&&(s[ot]=Object.assign(Object.assign({},t[ot]||{first:0,last:0}),{globalConstant:t})),s}if(((i=this.opt)===null||i===void 0?void 0:i.expandMacros)===void 0||((n=this.opt)===null||n===void 0?void 0:n.expandMacros)){const s=Hh(t,this.opt);return s!==t&&(s[ot]=Object.assign(Object.assign({},t[ot]||{first:0,last:0}),{macro:t})),s}else return t}parseListExpr(t,e){var i;const n={first:e.first,last:e.last},s=e.t==="(";let o;if(s){if(o=t.next(),o.done)throw Ci;n.last=o.value.last}else o={value:e};if(o.value.t!==at.Ident)throw new Ke(o.value,`not an identifier: ${o.value.v}`);const a={prim:o.value.v,[ot]:n};for(;;){const c=t.next();if(c.done){if(s)throw Ci;break}else if(c.value.t===")"){if(!s)throw new Ke(c.value,"unexpected closing bracket");n.last=c.value.last;break}else if(Ss(c.value))a.annots=a.annots||[],a.annots.push(c.value.v),n.last=c.value.last;else{a.args=a.args||[];const l=this.parseExpr(t,c.value);n.last=((i=l[ot])===null||i===void 0?void 0:i.last)||n.last,a.args.push(l)}}return this.expand(a)}parseArgs(t,e){var i;const n={first:e.first,last:e.last},s={prim:e.v,[ot]:n};for(;;){const o=t.next();if(o.done||o.value.t==="}"||o.value.t===";")return[s,o];if(Ss(o.value))n.last=o.value.last,s.annots=s.annots||[],s.annots.push(o.value.v);else{const a=this.parseExpr(t,o.value);n.last=((i=a[ot])===null||i===void 0?void 0:i.last)||n.last,s.args=s.args||[],s.args.push(a)}}}parseSequenceExpr(t,e){var i,n;const s={first:e.first,last:e.last},o=[];o[ot]=s;const a=e.t==="{";let c=e.t==="{"?null:{value:e};for(;;){if(c===null&&(c=t.next(),c.done||(s.last=c.value.last)),c.done){if(a)throw Ci;return o}if(c.value.t==="}"){if(a)return o;throw new Ke(c.value,"unexpected closing bracket")}else if(c.value.t===at.Ident){const[l,h]=this.parseArgs(t,c.value);s.last=((i=l[ot])===null||i===void 0?void 0:i.last)||s.last,o.push(this.expand(l)),c=h}else{const l=this.parseExpr(t,c.value);s.last=((n=l[ot])===null||n===void 0?void 0:n.last)||s.last,o.push(l),c=null}c===null&&(c=t.next(),c.done||(s.last=c.value.last)),!c.done&&c.value.t===";"&&(c=null)}}parseExpr(t,e){switch(e.t){case at.Ident:return this.expand({prim:e.v,[ot]:{first:e.first,last:e.last}});case at.Number:return{int:e.v,[ot]:{first:e.first,last:e.last}};case at.String:return{string:JSON.parse(e.v),[ot]:{first:e.first,last:e.last}};case at.Bytes:return{bytes:e.v.slice(2),[ot]:{first:e.first,last:e.last}};case"{":return this.parseSequenceExpr(t,e);default:return this.parseListExpr(t,e)}}parseSequence(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=Ti(t),i=e.next();return i.done?null:this.parseSequenceExpr(e,i.value)}parseList(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=Ti(t),i=e.next();return i.done?null:this.parseListExpr(e,i.value)}parseMichelineExpression(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=Ti(t),i=e.next();return i.done?null:this.parseExpr(e,i.value)}parseScript(t){return this.parseSequence(t)}parseData(t){return this.parseList(t)}parseJSON(t){if(typeof t!="object")throw new TypeError(`object type was expected, got ${typeof t} instead`);if(Array.isArray(t)){const e=[];for(const i of t){if(i===null||typeof i!="object")throw new It(i,`unexpected sequence element: ${i}`);e.push(this.parseJSON(i))}return e}else if("prim"in t){const e=t;if(typeof e.prim=="string"&&(e.annots===void 0||Array.isArray(e.annots))&&(e.args===void 0||Array.isArray(e.args))){const i={prim:e.prim};if(e.annots!==void 0){for(const n of e.annots)if(typeof n!="string")throw new It(n,`string expected: ${n}`);i.annots=e.annots}if(e.args!==void 0){i.args=[];for(const n of e.args){if(n===null||typeof n!="object")throw new It(n,`unexpected argument: ${n}`);i.args.push(this.parseJSON(n))}}return this.expand(i)}throw new It(t,`malformed prim expression: ${t}`)}else if("string"in t){if(typeof t.string=="string")return{string:t.string};throw new It(t,`malformed string literal: ${t}`)}else if("int"in t){if(typeof t.int=="string"&&Kh.test(t.int))return{int:t.int};throw new It(t,`malformed int literal: ${t}`)}else if("bytes"in t){if(typeof t.bytes=="string"&&Gh.test(t.bytes))return{bytes:t.bytes};throw new It(t,`malformed bytes literal: ${t}`)}else throw new It(t,`unexpected object: ${t}`)}}const qh=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],zh=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class Gi extends Error{constructor(t){super(t),this.message=t,this.name="Base58DecodingError"}}class Wh extends Error{constructor(t){super(t),this.message=t,this.name="InvalidMessageError"}}function Os(r){const t=(r.length+9)%64,e=t===0?0:64-t;if(r.length>268435455)throw new Wh(`SHA-256 -- message length is too big: ${r.length}`);const i=r.length<<3,n=[...r,128,...new Array(e).fill(0),0,0,0,0,i>>24&255,i>>16&255,i>>8&255,i&255];function s(h,p){return h>>>p|h<<32-p}const o=[...qh],a=new Array(64),c=new Array(8);for(let h=0;h<n.length;h+=64){let p=h,y=0;for(;y<16;)a[y]=n[p]<<24|n[p+1]<<16|n[p+2]<<8|n[p+3],p+=4,y++;for(;y<64;){const E=s(a[y-15],7)^s(a[y-15],18)^a[y-15]>>>3,N=s(a[y-2],17)^s(a[y-2],19)^a[y-2]>>>10;a[y]=(N|0)+a[y-7]+E+a[y-16]|0,y++}for(let E=0;E<8;E++)c[E]=o[E];for(let E=0;E<64;E++){const N=s(c[0],2)^s(c[0],13)^s(c[0],22),F=s(c[4],6)^s(c[4],11)^s(c[4],25),A=c[7]+F+(c[4]&c[5]^~c[4]&c[6])+zh[E]+a[E]|0,w=N+(c[0]&c[1]^c[0]&c[2]^c[1]&c[2])|0;c[7]=c[6],c[6]=c[5],c[5]=c[4],c[4]=c[3]+A|0,c[3]=c[2],c[2]=c[1],c[1]=c[0],c[0]=A+w|0}for(let E=0;E<8;E++)o[E]=o[E]+c[E]|0}const l=[];for(const h of o)l.push(h>>24&255),l.push(h>>16&255),l.push(h>>8&255),l.push(h&255);return l}const ji=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57];function _s(r,t){const e=r.charCodeAt(t)-49;if(e>=ji.length||ji[e]===-1)throw new Gi(`Unexpected character at position ${t}: ${r[t]}`);return ji[e]}function Jh(r){const t=[];let e=0;for(;e<r.length&&_s(r,e)===0;)e++;let i=e;for(;e<r.length;){let n=_s(r,e++),s=0;for(;n!==0||s<t.length;){const o=(t[s]||0)*58+n;t[s++]=o%256,n=Math.floor(o/256)}}for(;i-- >0;)t.push(0);return t.reverse()}function Io(r){const t=Jh(r);if(t.length<4)throw new Gi(`Data is too short ${t.length}`);const e=t.slice(0,t.length-4),i=t.slice(t.length-4),n=Os(Os(e));if(i[0]!==n[0]||i[1]!==n[1]||i[2]!==n[2]||i[3]!==n[3])throw new Gi("Invalid checksum");return e}class Yh extends Error{constructor(t){super(t),this.message=t,this.name="InvalidContractError"}}class Xh extends Error{constructor(t){super(t),this.message=t,this.name="InvalidTypeExpressionError"}}class Qh extends Error{constructor(t){super(t),this.message=t,this.name="InvalidDataExpressionError"}}class Zh extends Error{constructor(t){super(`Contract has no entrypoint named: '${t}'`),this.entrypoint=t,this.name="InvalidEntrypointError"}}class tl extends Error{constructor(t){super(t),this.message=t,this.name="LongIntegerError"}}class el extends Error{constructor(t){super(`Unable to parse hex byte: ${t}`),this.hexByte=t,this.name="HexParseError"}}class yt extends Error{constructor(t,e){super(e),this.val=t,Object.setPrototypeOf(this,yt.prototype)}}class R extends yt{constructor(t,e,i){super(t,i),e!==void 0&&(this.data=e),Object.setPrototypeOf(this,R.prototype)}}class xo{constructor(t){if(this.neg=!1,this.buf=[],t!==void 0)if(typeof t=="string")for(let e=0;e<t.length;e++){const i=t.charCodeAt(e);if(e===0&&i===45)this.neg=!0;else{if(i<48||i>57)throw new tl(`unexpected character in integer constant: ${t[e]}`);this.append(i-48)}}else t<0?(this.neg=!0,this.append(-t)):this.append(t)}append(t){let e=0;for(;t!==0||e<this.buf.length;){const i=(this.buf[e]||0)*10+t;this.buf[e++]=i%256,t=Math.floor(i/256)}}cmp(t){if(this.neg!==t.neg)return(t.neg?1:0)-(this.neg?1:0);{let e=0;if(this.buf.length!==t.buf.length)e=this.buf.length<t.buf.length?-1:1;else if(this.buf.length!==0){let i=t.buf.length-1;for(;i>=0&&this.buf[i]===t.buf[i];)i--;e=i<0?0:this.buf[i]<t.buf[i]?-1:1}return this.neg?e===0?0:-e:e}}get sign(){return this.buf.length===0?0:this.neg?-1:1}}function Ge(r){const t=[];for(let e=0;e<r.length;e+=2){const i=parseInt(r.slice(e,e+2),16);if(Number.isNaN(i))return null;t.push(i)}return t}function qi(r){try{return new xo(r),!0}catch{return!1}}function No(r){try{return new xo(r).sign>=0}catch{return!1}}const rl=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function Ye(r,t){if(Array.isArray(r))return{};let e,i,n;if(r.annots!==void 0){for(const s of r.annots)if(s.length!==0){if(!rl.test(s)||!(t!=null&&t.specialVar)&&(s==="@%"||s==="@%%")||!(t!=null&&t.specialFields)&&s==="%@")throw new yt(r,`${r.prim}: unexpected annotation: ${s}`);switch(s[0]){case"%":((t==null?void 0:t.emptyFields)||s.length>1)&&(e=e||[],e.push(s));break;case":":s.length>1&&(i=i||[],i.push(s));break;case"@":((t==null?void 0:t.emptyVar)||s.length>1)&&(n=n||[],n.push(s));break}}}return{f:e,t:i,v:n}}const il={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]],TxRollupL2Address:[20,[6,161,166]]};function ne(r,...t){const e=Io(r);for(const i of t){const[n,s]=il[i];if(e.length===n+s.length){let o=0;for(;o<s.length&&e[o]===s[o];)o++;if(o===s.length)return[i,e.slice(s.length)]}}return null}function ft(r,t){const e=t,i=Array.isArray(e)?e:e.args;return i.length===2?r==="pair"?{prim:"pair",args:i}:{prim:"Pair",args:i}:Object.assign(Object.assign({},Array.isArray(e)?{prim:r}:e),{args:[i[0],{prim:r,args:i.slice(1)}]})}function se(r){return Array.isArray(r)||r.prim==="pair"}function To(r){return Array.isArray(r)||"prim"in r&&r.prim==="Pair"}const nl=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function Lo(r){if("string"in r){if(No(r.string))return new Date(parseInt(r.string,10));if(nl.test(r.string)){const t=new Date(r.string);if(!Number.isNaN(t.valueOf))return t}}else if(qi(r.int))return new Date(parseInt(r.int,10));return null}function sl(r){const t=[];for(let e=0;e<r.length;e+=2){const i=r.slice(e,e+2),n=parseInt(i,16);if(Number.isNaN(n))throw new el(i);t.push(n)}return t}function De(r){return r.map(t=>(t>>4&15).toString(16)+(t&15).toString(16)).join("")}const ol=31,Co={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0},jo=Object.assign({},Co,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),$o={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},er=Object.assign({},$o,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class D extends yt{constructor(t,e){super(t,e),this.val=t,Object.setPrototypeOf(this,D.prototype)}}function Kt(r){return"prim"in r}function al(r){return Array.isArray(r)||"prim"in r}function Mo(r){if(Kt(r))return!0;throw new D(r,"prim expression expected")}function me(r){if(Array.isArray(r))return!0;throw new D(r,"sequence expression expected")}function nt(r){if(al(r))return!0;throw new D(r,"prim or sequence expression expected")}function $i(r){if(r.int[0]==="-")throw new D(r,"natural number expected")}function Lr(r){if("int"in r)return!0;throw new D(r,"int literal expected")}function Bo(r){if("string"in r)return!0;throw new D(r,"string literal expected")}function B(r,t){var e;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new D(r,`${t} arguments expected`)}function _t(r){var t,e;if(Array.isArray(r)){for(const i of r){if(!Array.isArray(i)&&!Kt(i))throw new D(r,"sequence or prim expected");_t(i)}return!0}if(Mo(r)){if(Object.prototype.hasOwnProperty.call(Co,r.prim))return B(r,0),!0;switch(r.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":r.args!==void 0&&B(r,1)&&Lr(r.args[0])&&$i(r.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":B(r,1)&&Lr(r.args[0])&&$i(r.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":B(r,1)&&oe(r.args[0]);break;case"UNPACK":B(r,1)&&gn(r.args[0]);break;case"CONTRACT":B(r,1)&&ni(r.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":B(r,2)&&(me(r.args[0])&&_t(r.args[0]),me(r.args[1])&&_t(r.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":B(r,1)&&_t(r.args[0]);break;case"CREATE_CONTRACT":B(r,1)&&Do(r.args[0]);break;case"DIP":if(((t=r.args)===null||t===void 0?void 0:t.length)===2)Lr(r.args[0])&&$i(r.args[0]),me(r.args[1])&&_t(r.args[1]);else if(((e=r.args)===null||e===void 0?void 0:e.length)===1)me(r.args[0])&&_t(r.args[0]);else throw new D(r,"1 or 2 arguments expected");break;case"PUSH":B(r,2)&&(Xe(r.args[0]),Ie(r.args[1]));break;case"EMPTY_SET":B(r,1)&&ae(r.args[0]);break;case"EMPTY_MAP":B(r,2)&&(ae(r.args[0]),oe(r.args[1]));break;case"EMPTY_BIG_MAP":B(r,2)&&(ae(r.args[0]),si(r.args[1]));break;case"LAMBDA":B(r,3)&&(oe(r.args[0]),oe(r.args[1]),me(r.args[2])&&_t(r.args[2]));break;case"VIEW":B(r,2)&&(Bo(r.args[0])&&Vo(r.args[0]),oe(r.args[1])&&Xe(r.args[1]));break;default:throw new D(r,"instruction expected")}}return!0}function ae(r){if(nt(r)){if(Array.isArray(r)||r.prim==="pair"||r.prim==="or"||r.prim==="option")Me(r,t=>ae(t));else if(!Object.prototype.hasOwnProperty.call($o,r.prim))throw new D(r,`${r.prim}: type is not comparable`)}return!0}function gn(r){if(nt(r)&&Kt(r)){if(!Object.prototype.hasOwnProperty.call(er,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket")throw new D(r,`${r.prim}: type can't be used inside PACK/UNPACK instructions`);Me(r,t=>gn(t))}return!0}function Xe(r){if(nt(r)&&Kt(r)){if(!Object.prototype.hasOwnProperty.call(er,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket"||r.prim==="contract")throw new D(r,`${r.prim}: type can't be pushed`);Me(r,t=>Xe(t))}return!0}function mn(r){if(nt(r)&&Kt(r)){if(!Object.prototype.hasOwnProperty.call(er,r.prim)||r.prim==="operation"||r.prim==="contract")throw new D(r,`${r.prim}: type can't be used as part of a storage`);Me(r,t=>mn(t))}return!0}function ni(r){if(nt(r)&&Kt(r)){if(!Object.prototype.hasOwnProperty.call(er,r.prim)||r.prim==="operation")throw new D(r,`${r.prim}: type can't be used as part of a parameter`);Me(r,t=>ni(t))}return!0}function si(r){if(nt(r)&&Kt(r)){if(!Object.prototype.hasOwnProperty.call(er,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state")throw new D(r,`${r.prim}: type can't be used inside a big_map`);Me(r,t=>si(t))}return!0}const cl=new RegExp("^[a-zA-Z0-9_.%@]*$");function Vo(r){if(r.string.length>ol)throw new D(r,`view name too long: ${r.string}`);if(!cl.test(r.string))throw new D(r,`invalid character(s) in view name: ${r.string}`)}function oe(r){if(nt(r)&&Kt(r)){if(!Object.prototype.hasOwnProperty.call(er,r.prim))throw new D(r,"type expected");Me(r,t=>oe(t))}return!0}function Me(r,t){if(Array.isArray(r)||r.prim==="pair"){const e=Array.isArray(r)?r:r.args;if(e===void 0||e.length<2)throw new D(r,"at least 2 arguments expected");return e.forEach(i=>{nt(i)&&t(i)}),!0}switch(r.prim){case"option":case"list":B(r,1)&&nt(r.args[0])&&t(r.args[0]);break;case"contract":B(r,1)&&ni(r.args[0]);break;case"or":B(r,2)&&nt(r.args[0])&&nt(r.args[1])&&(t(r.args[0]),t(r.args[1]));break;case"lambda":B(r,2)&&(oe(r.args[0]),oe(r.args[1]));break;case"set":B(r,1)&&ae(r.args[0]);break;case"map":B(r,2)&&nt(r.args[0])&&nt(r.args[1])&&(ae(r.args[0]),t(r.args[1]));break;case"big_map":B(r,2)&&nt(r.args[0])&&nt(r.args[1])&&(ae(r.args[0]),si(r.args[1]),t(r.args[1]));break;case"ticket":B(r,1)&&nt(r.args[0])&&ae(r.args[0]);break;case"sapling_state":case"sapling_transaction":B(r,1)&&Lr(r.args[0]);break;default:B(r,0)}return!0}function Ie(r){if("int"in r||"string"in r||"bytes"in r)return!0;if(Array.isArray(r)){let t=0;for(const e of r)Kt(e)&&e.prim==="Elt"?(B(e,2)&&(Ie(e.args[0]),Ie(e.args[1])),t++):Ie(e);if(t!==0&&t!==r.length)throw new D(r,"data entries and map elements can't be intermixed");return!0}if(Kt(r))switch(r.prim){case"Unit":case"True":case"False":case"None":B(r,0);break;case"Pair":if(r.args===void 0||r.args.length<2)throw new D(r,"at least 2 arguments expected");for(const t of r.args)Ie(t);break;case"Left":case"Right":case"Some":B(r,1)&&Ie(r.args[0]);break;default:if(Object.prototype.hasOwnProperty.call(jo,r.prim))_t(r);else throw new D(r,"data entry or instruction expected")}else throw new D(r,"data entry expected");return!0}function Do(r){if(me(r)){const t={},e={};for(const i of r)if(Mo(i)){if(i.prim!=="view"){if(i.prim in t)throw new D(r,`duplicate contract section: ${i.prim}`);t[i.prim]=!0}switch(i.prim){case"code":B(i,1)&&me(i.args[0])&&_t(i.args[0]);break;case"parameter":if(B(i,1)&&ni(i.args[0]),i.annots)throw new D(i,"Annotation must be part of the parameter type");break;case"storage":B(i,1)&&mn(i.args[0]);break;case"view":if(B(i,4)){if(Bo(i.args[0])){const n=i.args[0];if(n.string in e)throw new D(r,`duplicate view name: ${n.string}`);e[n.string]=!0,Vo(n)}Xe(i.args[1]),Xe(i.args[2]),me(i.args[3])&&_t(i.args[3])}break;default:throw new D(r,`unexpected contract section: ${i.prim}`)}}}return!0}function ko(r){return Object.prototype.hasOwnProperty.call(jo,r.prim)}function zi(r){if(!Array.isArray(r))return!1;for(const t of r)if("prim"in t){if(ko(t))throw new yt(r,`Instruction outside of a lambda: ${JSON.stringify(r)}`);if(t.prim==="Elt")throw new yt(r,`Elt item outside of a map literal: ${JSON.stringify(r)}`)}return!0}function ul(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}const hl=["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ"],ll=Object.assign({},...hl.map((r,t)=>({[r]:t})));var le;(function(r){r[r.Int=0]="Int",r[r.String=1]="String",r[r.Sequence=2]="Sequence",r[r.Prim0=3]="Prim0",r[r.Prim0Annot=4]="Prim0Annot",r[r.Prim1=5]="Prim1",r[r.Prim1Annot=6]="Prim1Annot",r[r.Prim2=7]="Prim2",r[r.Prim2Annot=8]="Prim2Annot",r[r.Prim=9]="Prim",r[r.Bytes=10]="Bytes"})(le||(le={}));class qe{constructor(){this.buffer=[]}get length(){return this.buffer.length}writeBytes(t){this.buffer.push(...t.map(e=>e&255))}writeUint8(t){const e=t|0;this.buffer.push(e&255)}writeUint16(t){const e=t|0;this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeUint32(t){const e=t|0;this.buffer.push(e>>24&255),this.buffer.push(e>>16&255),this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeInt8(t){this.writeUint8(t)}writeInt16(t){this.writeUint16(t)}writeInt32(t){this.writeUint32(t)}}const he=new Error("bounds out of range");class Qe{constructor(t,e=0,i=t.length){this.buffer=t,this.idx=e,this.cap=i}get length(){return this.cap-this.idx}readBytes(t){if(this.cap-this.idx<t)throw he;const e=this.buffer.slice(this.idx,this.idx+t);return this.idx+=t,e}reader(t){if(this.cap-this.idx<t)throw he;const e=new Qe(this.buffer,this.idx,this.idx+t);return this.idx+=t,e}copy(){return new Qe(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw he;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw he;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)>>>0}readUint32(){if(this.cap-this.idx<4)throw he;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],i=this.buffer[this.idx++],n=this.buffer[this.idx++];return(t<<24|e<<16|i<<8|n)>>>0}readInt8(){if(this.cap-this.idx<1)throw he;return this.buffer[this.idx++]<<24>>24}readInt16(){if(this.cap-this.idx<2)throw he;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)<<16>>16}readInt32(){if(this.cap-this.idx<4)throw he;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],i=this.buffer[this.idx++],n=this.buffer[this.idx++];return t<<24|e<<16|i<<8|n}}var Ze;(function(r){r[r.Implicit=0]="Implicit",r[r.Originated=1]="Originated"})(Ze||(Ze={}));var be;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(be||(be={}));function Fo(r){let t;const e=r.readUint8();switch(e){case be.ED25519:t="ED25519PublicKeyHash";break;case be.SECP256K1:t="SECP256K1PublicKeyHash";break;case be.P256:t="P256PublicKeyHash";break;default:throw new Error(`unknown public key hash tag: ${e}`)}return{type:t,hash:r.readBytes(20)}}function pl(r){let t;const e=r.readUint8();switch(e){case Ze.Implicit:t=Fo(r);break;case Ze.Originated:t={type:"ContractHash",hash:r.readBytes(20)},r.readBytes(1);break;default:throw new Error(`unknown address tag: ${e}`)}if(r.length!==0){const i=new TextDecoder;t.entryPoint=i.decode(new Uint8Array(r.readBytes(r.length)))}return t}function Ho(r,t){let e;switch(r.type){case"ED25519PublicKeyHash":e=be.ED25519;break;case"SECP256K1PublicKeyHash":e=be.SECP256K1;break;case"P256PublicKeyHash":e=be.P256;break;default:throw new Error(`unexpected address type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.hash))}function fl(r,t){if(r.type==="ContractHash"?(t.writeUint8(Ze.Originated),t.writeBytes(Array.from(r.hash)),t.writeUint8(0)):(t.writeUint8(Ze.Implicit),Ho(r,t)),r.entryPoint!==void 0&&r.entryPoint!==""&&r.entryPoint!=="default"){const i=new TextEncoder().encode(r.entryPoint);t.writeBytes(Array.from(i))}}var ve;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(ve||(ve={}));function dl(r){let t,e;const i=r.readUint8();switch(i){case ve.ED25519:e="ED25519PublicKey",t=32;break;case ve.SECP256K1:e="SECP256K1PublicKey",t=33;break;case ve.P256:e="P256PublicKey",t=33;break;default:throw new Error(`unknown public key tag: ${i}`)}return{type:e,publicKey:r.readBytes(t)}}function gl(r,t){let e;switch(r.type){case"ED25519PublicKey":e=ve.ED25519;break;case"SECP256K1PublicKey":e=ve.SECP256K1;break;case"P256PublicKey":e=ve.P256;break;default:throw new Error(`unexpected public key type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.publicKey))}function Cr(r,t,e){var i,n;const[s,o]=e(r);if(Array.isArray(s)){const l=new qe;for(const h of s){const p=o.next();if(p.done)throw new Error("REPORT ME: iterator is done");Cr(h,l,p.value)}t.writeUint8(le.Sequence),t.writeUint32(l.length),t.writeBytes(l.buffer);return}if("string"in s){const h=new TextEncoder().encode(s.string);t.writeUint8(le.String),t.writeUint32(h.length),t.writeBytes(Array.from(h));return}if("int"in s){t.writeUint8(le.Int);let l=BigInt(s.int);const h=l<0;h&&(l=-l);let p=0;do{const y=BigInt(p===0?6:7);let E=l&(BigInt(1)<<y)-BigInt(1);l>>=y,l&&(E|=BigInt(128)),p===0&&h&&(E|=BigInt(64)),t.writeUint8(Number(E)),p++}while(l);return}if("bytes"in s){const l=sl(s.bytes);t.writeUint8(le.Bytes),t.writeUint32(l.length),t.writeBytes(l);return}const a=ll[s.prim];if(a===void 0)throw new TypeError(`Can't encode primary: ${s.prim}`);const c=(((i=s.args)===null||i===void 0?void 0:i.length)||0)<3?le.Prim0+(((n=s.args)===null||n===void 0?void 0:n.length)||0)*2+(s.annots===void 0||s.annots.length===0?0:1):le.Prim;if(t.writeUint8(c),t.writeUint8(a),s.args!==void 0)if(s.args.length<3)for(const l of s.args){const h=o.next();if(h.done)throw new Error("REPORT ME: iterator is done");Cr(l,t,h.value)}else{const l=new qe;for(const h of s.args){const p=o.next();if(p.done)throw new Error("REPORT ME: iterator is done");Cr(h,l,p.value)}t.writeUint32(l.length),t.writeBytes(l.buffer)}if(s.annots!==void 0&&s.annots.length!==0){const h=new TextEncoder().encode(s.annots.join(" "));t.writeUint32(h.length),t.writeBytes(Array.from(h))}else s.args!==void 0&&s.args.length>=3&&t.writeUint32(0)}const ml=r=>"prim"in r&&(r.prim==="Left"||r.prim==="Right"),yl=r=>"prim"in r&&(r.prim==="Some"||r.prim==="None"),xe=r=>{if(se(r))return t=>{if(!To(t))throw new R(r,t,`pair expected: ${JSON.stringify(t)}`);zi(t);const e=ft("pair",r);return[ft("Pair",t),function*(){for(const n of e.args)yield xe(n)}()]};switch(r.prim){case"or":return t=>{if(!ml(t))throw new R(r,t,`or expected: ${JSON.stringify(t)}`);return[t,function*(){yield xe(r.args[t.prim==="Left"?0:1])}()]};case"option":return t=>{if(!yl(t))throw new R(r,t,`option expected: ${JSON.stringify(t)}`);return[t,function*(){t.prim==="Some"&&(yield xe(r.args[0]))}()]};case"list":case"set":return t=>{if(!Array.isArray(t))throw new R(r,t,`${r.prim} expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield xe(r.args[0])}()]};case"map":return t=>{if(!Array.isArray(t))throw new R(r,t,`map expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield i=>{if(!("prim"in i)||i.prim!=="Elt")throw new R(r,i,`map element expected: ${JSON.stringify(i)}`);return[i,function*(){for(const n of r.args)yield xe(n)}()]}}()]};case"chain_id":return t=>{if(!("bytes"in t)&&!("string"in t))throw new R(r,t,`chain id expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=ne(t.string,"ChainID");if(i===null)throw new R(r,t,`chain id base58 expected: ${t.string}`);e={bytes:De(i[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"signature":return t=>{if(!("bytes"in t)&&!("string"in t))throw new R(r,t,`signature expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=ne(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(i===null)throw new R(r,t,`signature base58 expected: ${t.string}`);e={bytes:De(i[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"key_hash":return t=>{if(!("bytes"in t)&&!("string"in t))throw new R(r,t,`key hash expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=ne(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(i===null)throw new R(r,t,`key hash base58 expected: ${t.string}`);const n=new qe;Ho({type:i[0],hash:i[1]},n),e={bytes:De(n.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"key":return t=>{if(!("bytes"in t)&&!("string"in t))throw new R(r,t,`public key expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=ne(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(i===null)throw new R(r,t,`public key base58 expected: ${t.string}`);const n=new qe;gl({type:i[0],publicKey:i[1]},n),e={bytes:De(n.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"address":return t=>{if(!("bytes"in t)&&!("string"in t))throw new R(r,t,`address expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=t.string.split("%"),n=ne(i[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(n===null)throw new R(r,t,`address base58 expected: ${t.string}`);const s=new qe;fl({type:n[0],hash:n[1],entryPoint:i.length>1?i[1]:void 0},s),e={bytes:De(s.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"timestamp":return t=>{if(!("string"in t)&&!("int"in t))throw new R(r,t,`timestamp expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=Lo(t);if(i===null)throw new R(r,t,`can't parse date: ${t.string}`);e={int:String(Math.floor(i.getTime()/1e3))}}else e=t;return[e,[][Symbol.iterator]()]};default:return Fr}},bl=r=>"prim"in r&&r.prim==="PUSH",Fr=r=>bl(r)?(_t(r),[r,function*(){yield Fr,yield xe(r.args[0])}()]):[r,function*(){for(;;)yield Fr}()];function vl(r,t){const e=new qe;return e.writeUint8(5),Cr(r,e,t!==void 0?xe(t):Fr),e.buffer}function El(r,t){return{bytes:De(vl(r,t))}}function wl(r){const t=Ge(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Qe(new Uint8Array(t));return pl(e)}function Sl(r){const t=Ge(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Qe(new Uint8Array(t));return Fo(e)}function Ol(r){const t=Ge(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Qe(new Uint8Array(t));return dl(e)}class x extends yt{constructor(t,e,i){super(t,i),this.stackState=e,Object.setPrototypeOf(this,x.prototype)}}function k(r){return Array.isArray(r)?"pair":r.prim}function Hr(r){return"prim"in r?r.args:r}function Rt(r,t,e=!1){if(k(r)!==k(t))throw new R(r,void 0,`types mismatch: ${k(r)} != ${k(t)}`);const i=[Ye(r),Ye(t)];if(i[0].t&&i[1].t&&i[0].t[0]!==i[1].t[0])throw new R(r,void 0,`${k(r)}: type names mismatch: ${i[0].t[0]} != ${i[1].t[0]}`);if(e&&i[0].f&&i[1].f&&i[0].f[0]!==i[1].f[0])throw new R(r,void 0,`${k(r)}: field names mismatch: ${i[0].f[0]} != ${i[1].f}`);if(se(r)){const n=ft("pair",r),s=ft("pair",t);Rt(n.args[0],s.args[0],!0),Rt(n.args[1],s.args[1],!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":case"ticket":Rt(r.args[0],t.args[0]);break;case"or":Rt(r.args[0],t.args[0],!0),Rt(r.args[1],t.args[1],!0);break;case"lambda":case"map":case"big_map":Rt(r.args[0],t.args[0]),Rt(r.args[1],t.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(r.args[0].int,10)!==parseInt(t.args[0].int,10))throw new R(r,void 0,`${k(r)}: type argument mismatch: ${r.args[0].int} != ${t.args[0].int}`)}}function Uo(r,t){if(r.length!==t.length)throw new R(r,void 0,`stack length mismatch: ${r.length} != ${t.length}`);for(let e=0;e<r.length;e++)Rt(r[e],t[e])}function K(r,t=!1){var e,i,n;if(!Array.isArray(r)){const s=Ye(r);if((((e=s.t)===null||e===void 0?void 0:e.length)||0)>1)throw new R(r,void 0,`${r.prim}: at most one type annotation allowed: ${r.annots}`);if(t){if((((i=s.f)===null||i===void 0?void 0:i.length)||0)>1)throw new R(r,void 0,`${r.prim}: at most one field annotation allowed: ${r.annots}`)}else if((((n=s.f)===null||n===void 0?void 0:n.length)||0)>0)throw new R(r,void 0,`${r.prim}: field annotations aren't allowed: ${r.annots}`)}if(se(r)){const s=Hr(r);for(const o of s)K(o,!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":K(r.args[0]);break;case"or":for(const s of r.args)K(s,!0);break;case"lambda":case"map":case"big_map":K(r.args[0]),K(r.args[1])}}function Ko(r){if(!Array.isArray(r))return!1;for(const t of r)if(!(Array.isArray(t)&&Ko(t)||"prim"in t&&ko(t)))return!1;return!0}function Ot(r,t,e){if(se(t)){if(To(r)){zi(r);const i=ft("Pair",r),n=ft("pair",t);Ot(i.args[0],n.args[0],e),Ot(i.args[1],n.args[1],e);return}throw new R(t,r,`pair expected: ${JSON.stringify(r)}`)}switch(t.prim){case"int":if("int"in r&&qi(r.int))return;throw new R(t,r,`integer value expected: ${JSON.stringify(r)}`);case"nat":case"mutez":if("int"in r&&No(r.int))return;throw new R(t,r,`natural value expected: ${JSON.stringify(r)}`);case"string":if("string"in r)return;throw new R(t,r,`string value expected: ${JSON.stringify(r)}`);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in r&&Ge(r.bytes)!==null)return;throw new R(t,r,`bytes value expected: ${JSON.stringify(r)}`);case"bool":if("prim"in r&&(r.prim==="True"||r.prim==="False"))return;throw new R(t,r,`boolean value expected: ${JSON.stringify(r)}`);case"key_hash":if("string"in r&&ne(r.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash")!==null)return;if("bytes"in r)try{Sl(r);return}catch{}throw new R(t,r,`key hash expected: ${JSON.stringify(r)}`);case"timestamp":if(("string"in r||"int"in r)&&Lo(r)!==null)return;throw new R(t,r,`timestamp expected: ${JSON.stringify(r)}`);case"address":if("string"in r){let i=r.string;const n=r.string.indexOf("%");if(n>=0&&(i=r.string.slice(0,n)),ne(i,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","TxRollupL2Address","RollupAddress")!==null)return}else if("bytes"in r)try{wl(r);return}catch{}throw new R(t,r,`address expected: ${JSON.stringify(r)}`);case"key":if("string"in r&&ne(r.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey")!==null)return;if("bytes"in r)try{Ol(r);return}catch{}throw new R(t,r,`public key expected: ${JSON.stringify(r)}`);case"unit":if("prim"in r&&r.prim==="Unit")return;throw new R(t,r,`unit value expected: ${JSON.stringify(r)}`);case"signature":if("bytes"in r||"string"in r&&ne(r.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature")!==null)return;throw new R(t,r,`signature expected: ${JSON.stringify(r)}`);case"chain_id":if(("bytes"in r||"string"in r)&&("string"in r?Io(r.string):Ge(r.bytes))!==null)return;throw new R(t,r,`chain id expected: ${JSON.stringify(r)}`);case"option":if("prim"in r){if(r.prim==="None")return;if(r.prim==="Some"){Ot(r.args[0],t.args[0],e);return}}throw new R(t,r,`option expected: ${JSON.stringify(r)}`);case"list":case"set":if(zi(r)){for(const i of r)Ot(i,t.args[0],e);return}throw new R(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"or":if("prim"in r){if(r.prim==="Left"){Ot(r.args[0],t.args[0],e);return}else if(r.prim==="Right"){Ot(r.args[0],t.args[1],e);return}}throw new R(t,r,`union (or) expected: ${JSON.stringify(r)}`);case"lambda":if(Ko(r)){const i=Q(r,[t.args[0]],e);if("failed"in i)throw new R(t,r,`function is failed with error type: ${i.failed}`);if(i.length!==1)throw new R(t,r,"function must return a value");Rt(t.args[1],i[0]);return}throw new R(t,r,`function expected: ${JSON.stringify(r)}`);case"map":case"big_map":if(Array.isArray(r)){for(const i of r){if(!("prim"in i)||i.prim!=="Elt")throw new R(t,r,`map elements expected: ${JSON.stringify(r)}`);Ot(i.args[0],t.args[0],e),Ot(i.args[1],t.args[1],e)}return}throw new R(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"bls12_381_fr":if("int"in r&&qi(r.int)||"bytes"in r&&Ge(r.bytes)!==null)return;throw new R(t,r,`BLS12-381 element expected: ${JSON.stringify(r)}`);case"sapling_state":if(Array.isArray(r))return;throw new R(t,r,`sapling state expected: ${JSON.stringify(r)}`);case"ticket":Ot(r,{prim:"pair",args:[{prim:"address"},t.args[0],{prim:"nat"}]},e);return;default:throw new R(t,r,`type ${k(t)} don't have Michelson literal representation`)}}function _l(r,t,e){let i=t,n=t,s=0;for(const o of r){const a=Q(o,n,e);if(i=a,"failed"in a)break;n=a,s++}if("failed"in i&&i.level==0&&(!("prim"in i.failed)||i.failed.prim!=="never")&&s!==r.length-1)throw new x(r,i,"FAIL must appear in a tail position");if((e==null?void 0:e.traceCallback)!==void 0){const o={op:r,in:t,out:i};e.traceCallback(o)}return"failed"in i?{failed:i.failed,level:i.level+1}:i}function Q(r,t,e){const i=(e==null?void 0:e.protocol)||Po;if(Array.isArray(r))return _l(r,t,e);const n=r;function s(f,...O){if(t.length<O.length+f)throw new x(n,t,`${n.prim}: stack must have at least ${O.length} element(s)`);let _=f;for(const $ of O){if($!==null&&$.length!==0){let C=0;for(;C<$.length&&$[C]!==k(t[_]);)C++;if(C===$.length)throw new x(n,t,`${n.prim}: stack type mismatch: [${_}] expected to be ${$}, got ${k(t[_])} instead`)}_++}return t.slice(f,O.length+f)}function o(f){return(...O)=>{try{return f(...O)}catch(_){throw _ instanceof yt?new x(n,t,_.message):_}}}function a(f){return O=>{try{return f(O)}catch(_){throw _ instanceof yt?new x(n,t,_.message):_}}}const c=o(Ye),l=o(Uo),h=o(Rt),p=a(ae),y=a(gn),E=a(mn),N=a(Xe),F=a(si);function A(f,O){const _=c(n,Object.assign(Object.assign({},O),{emptyFields:f.f!==void 0&&f.f>1,emptyVar:f.v!==void 0&&f.v>1})),$=(C,et,u)=>{if(C&&C.length>(et||0))throw new x(n,t,`${n.prim}: at most ${et||0} ${u} annotations allowed`)};return $(_.f,f.f,"field"),$(_.t,f.t,"type"),$(_.v,f.v,"variable"),_}function w(f,O){const _=f,$=Array.isArray(_)?{prim:"pair",args:_}:_,C=c($),et=O.v!==void 0||O.t!==void 0||O.f!==void 0?[...(O.v===null?C.v:O.v)||[],...(O.t===null?C.t:O.t)||[],...(O.f===null?C.f:O.f)||[]]:void 0,u=ul($,["annots"]);return Object.assign(Object.assign({},u),et&&et.length!==0&&{annots:et})}function m(f,O){const _=A({v:1});return w(f,{v:_.v!==void 0?_.v:O!==void 0?[O]:null,t:null})}function G(f,O,_,$,C){var et,u,g,b;const S=(et=c(O).f)===null||et===void 0?void 0:et[0],ht=(u=_.f)===null||u===void 0?void 0:u[$];if(ht!==void 0&&ht!=="%"&&S!==void 0&&ht!==S)throw new x(n,t,`${n.prim}: field names doesn't match: ${ht} !== ${S}`);const st=(g=_.v)===null||g===void 0?void 0:g[$],vt=(b=c(f).v)===null||b===void 0?void 0:b[0];return w(O,{t:null,v:st?st==="@%"?S?["@"+S.slice(1)]:void 0:st==="@%%"?vt?["@"+vt.slice(1)+"."+(S?S.slice(1):C)]:S?["@"+S.slice(1)]:void 0:[st]:null})}function P(f,O,_=O){const $=ft("pair",f);if(_===1)return[$.args[0]];if(_===2)return $.args;const C=$.args[1];if(se(C))return[$.args[0],...P(C,O,_-1)];throw new x(n,t,`${n.prim}: at least ${O} fields are expected`)}function Er(f,O,_=O){if(_===0)return f;const $=ft("pair",f);if(_===1)return $.args[0];const C=$.args[1];if(se(C))return Er(C,O,_-2);if(_===2)return C;throw new x(n,t,`${n.prim}: at least ${O+1} fields are expected`)}function wr(f,O,_,$=_){if($===0)return O;const C=ft("pair",f);if($===1)return Object.assign(Object.assign({},C),{args:[O,C.args[1]]});const et=C.args[1];if(se(et))return Object.assign(Object.assign({},C),{args:[C.args[0],wr(et,O,_,$-2)]});if($===2)return Object.assign(Object.assign({},C),{args:[C.args[0],O]});throw new x(n,t,`${n.prim}: at least ${_+1} fields are expected`)}const ut=(f,O)=>["@"+(f.v?f.v[0].slice(1)+".":"")+O];function _e(f,O){return"failed"in f||"failed"in O?"failed"in f?O:f:(l(f,O),f)}const ir=(f=>{var O,_,$,C,et;switch(f.prim){case"DUP":{const u=f.args?parseInt(f.args[0].int,10):1;if(u===0)throw new x(f,t,"DUP 0 is forbidden");const g=s(u-1,null)[0];if(k(g)==="ticket")throw new x(f,t,"ticket can't be DUPed");return[g,...t]}case"SWAP":{const u=s(0,null,null);return A({}),[u[1],u[0],...t.slice(2)]}case"SOME":return[w({prim:"option",args:[s(0,null)[0]]},A({t:1,v:1})),...t.slice(1)];case"UNIT":return[w({prim:"unit"},A({v:1,t:1})),...t];case"PAIR":{const u=f.args?parseInt(f.args[0].int,10):2;if(u<2)throw new x(f,t,`PAIR ${u} is forbidden`);const g=s(0,...new Array(u).fill(null)),b=A({f:u,t:1,v:1},{specialFields:!0}),S=st=>{const vt=st.lastIndexOf(".");return st.slice(vt>0?vt+1:1)},ht=g.map((st,vt)=>{var ci;const En=c(st),ua=b.f&&b.f.length>vt&&b.f[vt]!=="%"?b.f[vt]==="%@"?En.v?["%"+S(((ci=En.v)===null||ci===void 0?void 0:ci[0])||"")]:void 0:[b.f[vt]]:void 0;return w(st,{v:null,t:null,f:ua})});return[w({prim:"pair",args:ht},{t:b.t,v:b.v}),...t.slice(u)]}case"UNPAIR":{const u=f.args?parseInt(f.args[0].int,10):2;if(u<2)throw new x(f,t,`UNPAIR ${u} is forbidden`);const g=s(0,["pair"])[0],b=A({f:2,v:2},{specialVar:!0});return[...P(g,u).map((ht,st)=>G(g,ht,b,st,st===0?"car":"cdr")),...t.slice(1)]}case"CAR":case"CDR":{const u=ft("pair",s(0,["pair"])[0]),g=u.args[f.prim==="CAR"?0:1],b=A({f:1,v:1},{specialVar:!0});return[G(u,g,b,0,f.prim.toLocaleLowerCase()),...t.slice(1)]}case"CONS":{const u=s(0,null,["list"]);return h(u[0],u[1].args[0]),[m({prim:"list",args:[u[1].args[0]]}),...t.slice(2)]}case"SIZE":return s(0,["string","list","set","map","bytes"]),[m({prim:"nat"}),...t.slice(1)];case"MEM":{const u=s(0,null,["set","map","big_map"]);return p(u[0]),h(u[0],u[1].args[0]),[m({prim:"bool"}),...t.slice(2)]}case"GET":if(f.args){const u=parseInt(f.args[0].int,10),g=s(0,["pair"])[0];return[m(Er(g,u)),...t.slice(1)]}else{const u=s(0,null,["map","big_map"]);return p(u[0]),h(u[0],u[1].args[0]),[m({prim:"option",args:[u[1].args[1]]}),...t.slice(2)]}case"UPDATE":if(f.args){const u=parseInt(f.args[0].int,10),g=s(0,null,["pair"]);return[m(wr(g[1],g[0],u)),...t.slice(2)]}else{const u=s(0,null,["bool","option"]);if(p(u[0]),u[1].prim==="bool"){const b=s(2,["set"]);return h(u[0],b[0].args[0]),[m({prim:"set",args:[w(u[0],{t:null})]}),...t.slice(3)]}const g=s(2,["map","big_map"]);return h(u[0],g[0].args[0]),g[0].prim==="map"?[m({prim:"map",args:[w(u[0],{t:null}),w(u[1].args[0],{t:null})]}),...t.slice(3)]:(F(u[1].args[0]),[m({prim:"big_map",args:[w(u[0],{t:null}),w(u[1].args[0],{t:null})]}),...t.slice(3)])}case"GET_AND_UPDATE":{const u=A({v:2}),g=s(0,null,["option"],["map","big_map"]);p(g[0]),h(g[0],g[2].args[0]),h(g[1].args[0],g[2].args[1]);const b=(O=u.v)===null||O===void 0?void 0:O.map(S=>S!=="@"?[S]:void 0);return g[2].prim==="map"?[w({prim:"option",args:[g[2].args[1]]},{v:b==null?void 0:b[0]}),w({prim:"map",args:[w(g[0],{t:null}),w(g[1].args[0],{t:null})]},{v:b==null?void 0:b[1]}),...t.slice(3)]:(F(g[1].args[0]),[w({prim:"option",args:[g[2].args[1]]},{v:b==null?void 0:b[0]}),w({prim:"big_map",args:[w(g[0],{t:null}),w(g[1].args[0],{t:null})]},{v:b==null?void 0:b[1]}),...t.slice(3)])}case"EXEC":{const u=s(0,null,["lambda"]);return h(u[0],u[1].args[0]),[m(u[1].args[1]),...t.slice(2)]}case"APPLY":{const u=s(0,null,["lambda"]);if(E(u[0]),N(u[0]),!se(u[1].args[0]))throw new x(f,t,`${f.prim}: function's argument must be a pair: ${k(u[1].args[0])}`);const g=u[1].args[0];return h(u[0],Hr(g)[0]),[m({prim:"lambda",args:[Hr(g)[1],u[1].args[1]]}),...t.slice(2)]}case"FAILWITH":{const u=s(0,null)[0];return or(i,ye.PtEdo2Zk)||y(u),{failed:u,level:0}}case"NEVER":return s(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[m(s(0,null)[0]),...t.slice(1)];case"CONCAT":{const u=s(0,["string","list","bytes"]);if(u[0].prim==="list"){if(k(u[0].args[0])!=="string"&&k(u[0].args[0])!=="bytes")throw new x(f,t,`${f.prim}: can't concatenate list of ${k(u[0].args[0])}'s`);return[m(u[0].args[0]),...t.slice(1)]}const g=s(1,["string","bytes"]);if(u[0].prim!==g[0].prim)throw new x(f,t,`${f.prim}: can't concatenate ${u[0].prim} with ${g[0].prim}`);return[m(g[0]),...t.slice(2)]}case"SLICE":return[m({prim:"option",args:[s(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...t.slice(3)];case"PACK":{const u=s(0,null)[0];return y(u),[m({prim:"bytes"},"@packed"),...t.slice(1)]}case"ADD":{const u=s(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(u[0].prim==="nat"&&u[1].prim==="int"||u[0].prim==="int"&&u[1].prim==="nat")return[m({prim:"int"}),...t.slice(2)];if(u[0].prim==="int"&&u[1].prim==="timestamp"||u[0].prim==="timestamp"&&u[1].prim==="int")return[m({prim:"timestamp"}),...t.slice(2)];if((u[0].prim==="int"||u[0].prim==="nat"||u[0].prim==="mutez"||u[0].prim==="bls12_381_g1"||u[0].prim==="bls12_381_g2"||u[0].prim==="bls12_381_fr")&&u[0].prim===u[1].prim)return[m(u[0]),...t.slice(2)];throw new x(f,t,`${f.prim}: can't add ${u[0].prim} to ${u[1].prim}`)}case"SUB":{const u=or(i,ye.PsiThaCa)?s(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):s(0,["nat","int","timestamp"],["nat","int","timestamp"]);if((u[0].prim==="nat"||u[0].prim==="int")&&(u[1].prim==="nat"||u[1].prim==="int")||u[0].prim==="timestamp"&&u[1].prim==="timestamp")return[m({prim:"int"}),...t.slice(2)];if(u[0].prim==="timestamp"&&u[1].prim==="int")return[m({prim:"timestamp"}),...t.slice(2)];if(u[0].prim==="mutez"&&u[1].prim==="mutez")return[m({prim:"mutez"}),...t.slice(2)];throw new x(f,t,`${f.prim}: can't subtract ${u[0].prim} from ${u[1].prim}`)}case"SUB_MUTEZ":return s(0,["mutez"],["mutez"]),[m({prim:"option",args:[{prim:"mutez"}]}),...t.slice(2)];case"MUL":{const u=s(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(u[0].prim==="nat"&&u[1].prim==="int"||u[0].prim==="int"&&u[1].prim==="nat")return[m({prim:"int"}),...t.slice(2)];if(u[0].prim==="nat"&&u[1].prim==="mutez"||u[0].prim==="mutez"&&u[1].prim==="nat")return[m({prim:"mutez"}),...t.slice(2)];if((u[0].prim==="bls12_381_g1"||u[0].prim==="bls12_381_g2"||u[0].prim==="bls12_381_fr")&&u[1].prim==="bls12_381_fr"||(u[0].prim==="nat"||u[0].prim==="int")&&u[0].prim===u[1].prim)return[m(u[0]),...t.slice(2)];if((u[0].prim==="nat"||u[0].prim==="int")&&u[1].prim==="bls12_381_fr"||(u[1].prim==="nat"||u[1].prim==="int")&&u[0].prim==="bls12_381_fr")return[m({prim:"bls12_381_fr"}),...t.slice(2)];throw new x(f,t,`${f.prim}: can't multiply ${u[0].prim} by ${u[1].prim}`)}case"EDIV":{const u=(b,S)=>({prim:"option",args:[{prim:"pair",args:[{prim:b},{prim:S}]}]}),g=s(0,["nat","int","mutez"],["nat","int","mutez"]);if(g[0].prim==="nat"&&g[1].prim==="nat")return[m(u("nat","nat")),...t.slice(2)];if((g[0].prim==="nat"||g[0].prim==="int")&&(g[1].prim==="nat"||g[1].prim==="int"))return[m(u("int","nat")),...t.slice(2)];if(g[0].prim==="mutez"&&g[1].prim==="nat")return[m(u("mutez","mutez")),...t.slice(2)];if(g[0].prim==="mutez"&&g[1].prim==="mutez")return[m(u("nat","mutez")),...t.slice(2)];throw new x(f,t,`${f.prim}: can't euclideally divide ${g[0].prim} by ${g[1].prim}`)}case"ABS":return s(0,["int"]),[m({prim:"nat"}),...t.slice(1)];case"ISNAT":return s(0,["int"]),[m({prim:"option",args:[{prim:"nat"}]}),...t.slice(1)];case"INT":return s(0,["nat","bls12_381_fr"]),[m({prim:"int"}),...t.slice(1)];case"NEG":{const u=s(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];return u.prim==="nat"||u.prim==="int"?[m({prim:"int"}),...t.slice(1)]:[m(u),...t.slice(1)]}case"LSL":case"LSR":return s(0,["nat"],["nat"]),[m({prim:"nat"}),...t.slice(2)];case"OR":case"XOR":{const u=s(0,["nat","bool"],["nat","bool"]);if(u[0].prim!==u[1].prim)throw new x(f,t,`${f.prim}: both arguments must be of the same type: ${u[0].prim}, ${u[1].prim}`);return[m(u[1]),...t.slice(2)]}case"AND":{const u=s(0,["nat","bool","int"],["nat","bool"]);if((u[0].prim!=="int"||u[1].prim!=="nat")&&u[0].prim!==u[1].prim)throw new x(f,t,`${f.prim}: both arguments must be of the same type: ${u[0].prim}, ${u[1].prim}`);return[m(u[1]),...t.slice(2)]}case"NOT":return s(0,["nat","bool","int"])[0].prim==="bool"?[m({prim:"bool"}),...t.slice(1)]:[m({prim:"int"}),...t.slice(1)];case"COMPARE":{const u=s(0,null,null);return p(u[0]),p(u[1]),[m({prim:"int"}),...t.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return s(0,["int"]),[m({prim:"bool"}),...t.slice(1)];case"SELF":{if((e==null?void 0:e.contract)===void 0)throw new x(f,t,`${f.prim}: contract required`);const u=A({f:1,v:1}),g=Wi(e.contract,(_=u.f)===null||_===void 0?void 0:_[0]);if(g===null)throw new x(f,t,`${f.prim}: contract has no entrypoint ${g}`);return[w({prim:"contract",args:[g]},{v:u.v?u.v:["@self"]}),...t]}case"TRANSFER_TOKENS":{const u=s(0,null,["mutez"],["contract"]);return h(u[0],u[2].args[0]),[m({prim:"operation"}),...t.slice(3)]}case"SET_DELEGATE":{const u=s(0,["option"])[0];if(k(u.args[0])!=="key_hash")throw new x(f,t,`${f.prim}: key hash expected: ${k(u.args[0])}`);return[m({prim:"operation"}),...t.slice(1)]}case"IMPLICIT_ACCOUNT":return s(0,["key_hash"]),[m({prim:"contract",args:[{prim:"unit"}]}),...t.slice(1)];case"NOW":return[m({prim:"timestamp"},"@now"),...t];case"AMOUNT":return[m({prim:"mutez"},"@amount"),...t];case"BALANCE":return[m({prim:"mutez"},"@balance"),...t];case"CHECK_SIGNATURE":return s(0,["key"],["signature"],["bytes"]),[m({prim:"bool"}),...t.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return s(0,["bytes"]),[m({prim:"bytes"}),...t.slice(1)];case"HASH_KEY":return s(0,["key"]),[m({prim:"key_hash"}),...t.slice(1)];case"SOURCE":return[m({prim:"address"},"@source"),...t];case"SENDER":return[m({prim:"address"},"@sender"),...t];case"ADDRESS":{const u=s(0,["contract"])[0],g=A({v:1});return[w({prim:"address",[_r]:u},{v:g.v?g.v:ut(c(u),"address")}),...t.slice(1)]}case"SELF_ADDRESS":{const u={prim:"address"};return(e==null?void 0:e.contract)!==void 0&&(u[_r]={prim:"contract",args:[Ht(e.contract,"parameter").args[0]]}),[m(u,"@address"),...t]}case"CHAIN_ID":return[m({prim:"chain_id"}),...t];case"DROP":{A({});const u=f.args!==void 0?parseInt(f.args[0].int,10):1;return s(u-1,null),t.slice(u)}case"DIG":{A({});const u=parseInt(f.args[0].int,10);return[s(u,null)[0],...t.slice(0,u),...t.slice(u+1)]}case"DUG":{A({});const u=parseInt(f.args[0].int,10);return[...t.slice(1,u+1),s(0,null)[0],...t.slice(u+1)]}case"NONE":return K(f.args[0]),[w({prim:"option",args:[f.args[0]]},A({t:1,v:1})),...t];case"LEFT":case"RIGHT":{const u=s(0,null)[0],g=A({f:2,t:1,v:1},{specialFields:!0}),b=c(u),S=[w(u,{t:null,v:null,f:g.f&&g.f.length>0&&g.f[0]!=="%"?g.f[0]==="%@"?b.v?["%"+b.v[0].slice(1)]:void 0:g.f:void 0}),w(f.args[0],{t:null,f:g.f&&g.f.length>1&&g.f[1]!=="%"?g.f:void 0})];return[w({prim:"or",args:f.prim==="LEFT"?S:[S[1],S[0]]},{t:g.t,v:g.v}),...t.slice(1)]}case"NIL":return K(f.args[0]),[w({prim:"list",args:[f.args[0]]},A({t:1,v:1})),...t];case"UNPACK":return s(0,["bytes"]),K(f.args[0]),[m({prim:"option",args:[f.args[0]]},"@unpacked"),...t.slice(1)];case"CONTRACT":{const u=s(0,["address"])[0];K(f.args[0]);const g=A({v:1,f:1}),b=u[_r];if(b!==void 0){const S=Wi(b,($=g.f)===null||$===void 0?void 0:$[0]);if(S===null)throw new x(f,t,`${f.prim}: contract has no entrypoint ${S}`);h(S,f.args[0])}return[w({prim:"option",args:[{prim:"contract",args:[f.args[0]]}]},{v:g.v?g.v:ut(c(u),"contract")}),...t.slice(1)]}case"CAST":{A({});const u=s(0,null)[0];return K(f.args[0]),h(f.args[0],u),[f.args[0],...t.slice(1)]}case"IF_NONE":{A({});const u=s(0,["option"])[0],g=t.slice(1),b=Q(f.args[0],g,e),S=Q(f.args[1],[w(u.args[0],{t:null,v:ut(c(u),"some")}),...g],e);return _e(b,S)}case"IF_LEFT":{A({});const u=s(0,["or"])[0],g=c(u),b=c(u.args[0]),S=c(u.args[1]),ht=t.slice(1),st=Q(f.args[0],[w(u.args[0],{t:null,v:ut(g,b.f?b.f[0].slice(1):"left")}),...ht],e),vt=Q(f.args[1],[w(u.args[1],{t:null,v:ut(g,S.f?S.f[0].slice(1):"right")}),...ht],e);return _e(st,vt)}case"IF_CONS":{A({});const u=s(0,["list"])[0],g=c(u),b=t.slice(1),S=Q(f.args[0],[w(u.args[0],{t:null,v:ut(g,"hd")}),w(u,{t:null,v:ut(g,"tl")}),...b],e),ht=Q(f.args[1],b,e);return _e(S,ht)}case"IF":{A({}),s(0,["bool"]);const u=t.slice(1),g=Q(f.args[0],u,e),b=Q(f.args[1],u,e);return _e(g,b)}case"MAP":{const u=s(0,["list","map","option"])[0],g=t.slice(1),b=u.prim==="map"?{prim:"pair",args:u.args}:u.args[0],S=Q(f.args[0],[w(b,{t:null,v:ut(c(u),"elt")}),...g],e);if("failed"in S){if(!("prim"in S.failed)||S.failed.prim!=="never")throw new x(f,t,`${f.prim}: FAIL is not allowed in MAP`);return{failed:S.failed,level:S.level+1}}if(S.length<1)throw new x(f,t,`${f.prim}: function must return a value`);return l(S.slice(1),g),u.prim==="list"?[m({prim:"list",args:[S[0]]}),...g]:u.prim==="map"?[m({prim:"map",args:[u.args[0],S[0]]}),...g]:[m({prim:"option",args:[S[0]]}),...g]}case"ITER":{A({});const u=s(0,["set","list","map"])[0],g=t.slice(1),b=u.prim==="map"?{prim:"pair",args:u.args}:u.args[0],S=Q(f.args[0],[w(b,{t:null,v:ut(c(u),"elt")}),...g],e);return"failed"in S?{failed:S.failed,level:S.level+1}:(l(S,g),g)}case"LOOP":{A({}),s(0,["bool"]);const u=t.slice(1),g=Q(f.args[0],u,e);return"failed"in g?{failed:g.failed,level:g.level+1}:(l(g,[{prim:"bool"},...u]),u)}case"LOOP_LEFT":{A({});const u=s(0,["or"])[0],g=t.slice(1),b=Q(f.args[0],[w(u.args[0],{t:null,v:ut(c(u),"left")}),...g],e);return"failed"in b?{failed:b.failed,level:b.level+1}:(l(b,[u,...g]),[w(u.args[1],{t:null,v:A({v:1}).v}),...g])}case"DIP":{A({});const u=f.args.length===2?parseInt(f.args[0].int,10):1;s(u-1,null);const g=t.slice(0,u),b=t.slice(u),S=f.args.length===2?Q(f.args[1],b,e):Q(f.args[0],b,e);return"failed"in S?{failed:S.failed,level:S.level+1}:[...g,...S]}case"CREATE_CONTRACT":{const u=A({v:2}),g=s(0,["option"],["mutez"],null);if(k(g[0].args[0])!=="key_hash")throw new x(f,t,`${f.prim}: key hash expected: ${k(g[0].args[0])}`);E(g[2])&&(qo(f.args[0]),Rt(Ht(f.args[0],"storage").args[0],g[2]));const b=(C=u.v)===null||C===void 0?void 0:C.map(S=>S!=="@"?[S]:void 0);return[w({prim:"operation"},{v:b==null?void 0:b[0]}),w({prim:"address",[_r]:{prim:"contract",args:[Ht(f.args[0],"parameter").args[0]]}},{v:b==null?void 0:b[1]}),...t.slice(3)]}case"PUSH":return K(f.args[0]),Ot(f.args[1],f.args[0],Object.assign(Object.assign({},e),{contract:void 0})),[m(f.args[0]),...t];case"EMPTY_SET":return K(f.args[0]),p(f.args[0]),[w({prim:"set",args:f.args},A({t:1,v:1})),...t];case"EMPTY_MAP":return K(f.args[0]),p(f.args[0]),K(f.args[1]),[w({prim:"map",args:f.args},A({t:1,v:1})),...t];case"EMPTY_BIG_MAP":return K(f.args[0]),p(f.args[0]),K(f.args[1]),F(f.args[0]),[w({prim:"big_map",args:f.args},A({t:1,v:1})),...t];case"LAMBDA":{K(f.args[0]),K(f.args[1]);const u=Q(f.args[2],[f.args[0]],Object.assign(Object.assign({},e),{contract:void 0}));if("failed"in u)return{failed:u.failed,level:u.level+1};if(u.length!==1)throw new x(f,t,`${f.prim}: function must return a value`);return h(f.args[1],u[0]),[m({prim:"lambda",args:[f.args[0],f.args[1]]}),...t]}case"LEVEL":return[m({prim:"nat"},"@level"),...t];case"TOTAL_VOTING_POWER":return[m({prim:"nat"}),...t];case"VOTING_POWER":return s(0,["key_hash"]),[m({prim:"nat"}),...t.slice(1)];case"TICKET":{const u=s(0,null,["nat"])[0];return p(u),[w({prim:"ticket",args:[u]},A({t:1,v:1})),...t.slice(2)]}case"JOIN_TICKETS":{const u=ft("pair",s(0,["pair"])[0]);if(k(u.args[0])!=="ticket")throw new x(f,t,`${f.prim}: ticket expected: ${k(u.args[0])}`);return h(u.args[0],u.args[1]),[m({prim:"option",args:[w(u.args[0],{t:null})]}),...t.slice(1)]}case"SPLIT_TICKET":{const u=s(0,["ticket"],["pair"]),g=ft("pair",u[1]);if(k(g.args[0])!=="nat")throw new x(f,t,`${f.prim}: nat expected: ${k(g.args[0])}`);return h(g.args[0],g.args[1]),[m({prim:"option",args:[{prim:"pair",args:[w(u[0],{t:null}),w(u[0],{t:null})]}]}),...t.slice(2)]}case"READ_TICKET":{const u=A({v:2}),g=s(0,["ticket"])[0],b=(et=u.v)===null||et===void 0?void 0:et.map(S=>S!=="@"?[S]:void 0);return[w({prim:"pair",args:[{prim:"address"},w(g.args[0],{t:null}),{prim:"nat"}]},{v:b==null?void 0:b[0]}),w(g,{v:b==null?void 0:b[1],t:null}),...t.slice(1)]}case"PAIRING_CHECK":{const u=s(0,["list"])[0].args[0];if(!se(u))throw new x(f,t,`${f.prim}: pair expected: ${k(u)}`);const g=ft("pair",u);if(k(g.args[0])!=="bls12_381_g1")throw new x(f,t,`${f.prim}: bls12_381_g1 expected: ${k(g.args[0])}`);if(k(g.args[1])!=="bls12_381_g2")throw new x(f,t,`${f.prim}: bls12_381_g2 expected: ${k(g.args[1])}`);return[m({prim:"bool"}),...t.slice(1)]}case"SAPLING_EMPTY_STATE":return[w({prim:"sapling_state",args:[f.args[0]]},A({v:1,t:1})),...t];case"SAPLING_VERIFY_UPDATE":{const u=s(0,["sapling_transaction"],["sapling_state"]);if(parseInt(u[0].args[0].int,10)!==parseInt(u[1].args[0].int,10))throw new x(f,t,`${f.prim}: sapling memo size mismatch: ${u[0].args[0].int} != ${u[1].args[0].int}`);return or(i,ye.PtJakarta)?[m({prim:"option",args:[{prim:"pair",args:[{prim:"int"},w(u[1],{t:null})]}]}),...t.slice(2)]:[m({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},w(u[1],{t:null})]}]}]}),...t.slice(2)]}case"OPEN_CHEST":return s(0,["chest_key"],["chest"],["nat"]),[m({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...t.slice(3)];case"VIEW":{const u=s(0,null,["address"]);return N(u[0]),[m({prim:"option",args:[f.args[1]]}),...t.slice(2)]}case"MIN_BLOCK_TIME":return[m({prim:"nat"}),...t];default:throw new yt(f,`unexpected instruction: ${f.prim}`)}})(n);if((e==null?void 0:e.traceCallback)!==void 0){const f={op:n,in:t,out:ir};e.traceCallback(f)}return ir}function Ht(r,t){for(const e of r)if(e.prim===t)return e;throw new yt(r,`missing contract section: ${t}`)}function Rl(r){const t={};for(const e of r)e.prim==="view"&&(t[e.args[0].string]=e);return t}function Go(r){if(Array.isArray(r)){for(const t of r)if("prim"in t&&(t.prim==="parameter"||t.prim==="storage"||t.prim==="code"))return!0}return!1}function Wi(r,t){t=t||"%default";const e=Ur(r).find(i=>i[0]===t);return e!==void 0?e[1]:t==="%default"?Go(r)?Ht(r,"parameter").args[0]:r:null}function Al(r){return Array.isArray(r)||r.prim==="or"}function Ur(r){if(Go(r)){const t=Ht(r,"parameter"),e=Ur(t.args[0]),i=Ye(t);return i.f?[[i.f[0],t.args[0]],...e]:e}if(Al(r)){const t=Hr(r),e=i=>{const n=Ye(t[i]);if(k(t[i])==="or"){const s=Ur(t[i]);return n.f?[[n.f[0],t[i]],...s]:s}return n.f?[[n.f[0],t[i]]]:[]};return[...e(0),...e(1)]}return[]}function qo(r,t){const e=(c,l,h,p)=>{K(c,!0),K(l);const y={prim:"pair",args:[Object.assign(Object.assign({},c),{annots:["@parameter"]}),Object.assign(Object.assign({},l),{annots:["@storage"]})]},E=Q(p,[y],Object.assign(Object.assign({},t),{contract:r}));if("failed"in E)return E;try{Uo(E,[h])}catch(N){throw N instanceof yt?new x(p,E,N.message):N}return E},i=Ht(r,"parameter").args[0],n=Ht(r,"storage").args[0],s=Ht(r,"code").args[0],a=e(i,n,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},n]},s);for(const c of Object.values(Rl(r)))e(c.args[1],n,c.args[2],c.args[3]);return a}function zo(r,t,e){K(t),Ot(r,t,e||null)}function Pl(r,t,e){for(const i of t)K(i);if((e==null?void 0:e.contract)!==void 0)for(const i of["parameter","storage"]){const n=Ht(e.contract,i).args[0];K(n)}return Q(r,t,e||null)}function Il(r,t,e){try{return zo(r,t,e),!0}catch{return!1}}class yn{constructor(t,e){this.contract=t,this.ctx=Object.assign({contract:t},e),this.output=qo(t,this.ctx)}static parse(t,e){const i=new Te(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new Yh("empty contract");if(Do(n))return new yn(n,e)}static parseTypeExpression(t,e){const i=new Te(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new Xh("empty type expression");if(oe(n)&&K(n))return n;throw void 0}static parseDataExpression(t,e){const i=new Te(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new Qh("empty data expression");if(Ie(n))return n;throw void 0}section(t){return Ht(this.contract,t)}entryPoints(){return Ur(this.contract)}entryPoint(t){return Wi(this.contract,t)}assertDataValid(t,e){zo(t,e,this.ctx)}isDataValid(t,e){return Il(t,e,this.ctx)}assertParameterValid(t,e){const i=this.entryPoint(t||void 0);if(i===null)throw new Zh(t==null?void 0:t.toString());this.assertDataValid(e,i)}isParameterValid(t,e){try{return this.assertParameterValid(t,e),!0}catch{return!1}}functionType(t,e){return Pl(t,e,this.ctx)}}new yn([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}]);function Re(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function d(r,t,e,i){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{l(i.next(h))}catch(p){o(p)}}function c(h){try{l(i.throw(h))}catch(p){o(p)}}function l(h){h.done?s(h.value):n(h.value).then(a,c)}l((i=i.apply(r,t||[])).next())})}class xl{constructor(t){this.context=t}inject(t){return this.context.rpc.injectOperation(t)}}class Rr extends Error{constructor(){super("No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance."),this.name="UnconfiguredSignerError"}}class Ji{publicKey(){return d(this,void 0,void 0,function*(){throw new Rr})}publicKeyHash(){return d(this,void 0,void 0,function*(){throw new Rr})}secretKey(){return d(this,void 0,void 0,function*(){throw new Rr})}sign(t,e){return d(this,void 0,void 0,function*(){throw new Rr})}}function Wo(r){return new W(t=>(r.on("data",e=>{t.next(e)}),r.on("error",e=>{t.error(e)}),r.on("close",()=>{t.complete()}),()=>{r.close()}))}var Ee;(function(r){r[r.DELEGATION=10600]="DELEGATION",r[r.ORIGINATION=10600]="ORIGINATION",r[r.TRANSFER=10600]="TRANSFER",r[r.REVEAL=1100]="REVEAL"})(Ee||(Ee={}));var we;(function(r){r[r.DELEGATION=1257]="DELEGATION",r[r.ORIGINATION=1e4]="ORIGINATION",r[r.TRANSFER=1e4]="TRANSFER",r[r.REVEAL=374]="REVEAL"})(we||(we={}));var Se;(function(r){r[r.DELEGATION=0]="DELEGATION",r[r.ORIGINATION=257]="ORIGINATION",r[r.TRANSFER=257]="TRANSFER",r[r.REVEAL=0]="REVEAL"})(Se||(Se={}));var it;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(it||(it={}));it.Pt24m4xi,it.PsBABY5H,it.PsBabyM1,it.PsCARTHA,it.PsDELPH1,it.PtEdo2Zk,it.PsFLorena,it.PtGRANADs,it.PtHangz2,it.PsiThaCa,it.Psithaca2,it.PtJakart2,it.ProtoALpha;var Rs;(function(r){r.MAINNET="NetXdQprcVkpaWU",r.CARTHAGENET="NetXjD3HPJJjmcd",r.DELPHINET="NetXm8tYqnMWky1",r.EDONET="NetXSgo1ZT2DRUG",r.FLORENCENET="NetXxkAx4woPLyu",r.GRANADANET="NetXz969SFaFn8k",r.HANGZHOUNET="NetXZSsxBpMQeAT",r.ITHACANET="NetXbhmtAbMukLc",r.ITHACANET2="NetXnHfVqm9iesp",r.JAKARTANET2="NetXLH1uAxK7CCh"})(Rs||(Rs={}));const Nl=6,Tl=3;function As(r){switch(r){case"tz":return Nl;case"mtz":return Tl;case"mutez":default:return 0}}function bn(r="mutez",t="mutez",e){const i=new V(e);return i.isNaN()?e:i.multipliedBy(Math.pow(10,As(r))).dividedBy(Math.pow(10,As(t)))}class Jo extends Error{constructor(t,e,i){super(`${t} Received ${i.length} arguments while expecting one of the following signatures (${JSON.stringify(e)})`),this.smartContractMethodName=t,this.sigs=e,this.args=i,this.name="Invalid parameters error"}}class Ll extends Error{constructor(t){super(`Since Babylon delegation source can no longer be a contract address ${t}. Please use the smart contract abstraction to set your delegate.`),this.source=t,this.name="Invalid delegation source error"}}class Kr extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidCodeParameter"}}class Yo extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidInitParameter"}}class Cl extends Error{constructor(t,e,i,n){super(`Unable to encode the parameter of the view: ${t}. Received ${i} as parameter while expecting one of the following signatures (${JSON.stringify(e)})`),this.smartContractViewName=t,this.sigs=e,this.args=i,this.originalError=n,this.name="Invalid view parameters error",this.cause=n}}class Ps extends Error{constructor(t,e,i,n){super(t),this.message=t,this.viewName=e,this.failWith=i,this.originalError=n,this.name="ViewSimulationError"}}const jl=r=>{if($l(r.body)){const t=JSON.parse(r.body);if(Array.isArray(t)&&"with"in t[t.length-1])return t[t.length-1].with}},$l=r=>{try{JSON.parse(r)}catch{return!1}return!0};class Is extends Error{constructor(t){super(`${t} Please configure the context of the view execution in the executeView method.`),this.info=t,this.name="InvalidViewSimulationContext"}}class Ml extends Error{constructor(t){super(t),this.message=t,this.name="RevealOperationError"}}class Bl extends Error{constructor(t){super(t),this.message=t,this.name="OriginationParameterError"}}const Gr=({code:r,init:t,balance:e="0",delegate:i,storage:n,fee:s=we.ORIGINATION,gasLimit:o=Ee.ORIGINATION,storageLimit:a=Se.ORIGINATION,mutez:c=!1})=>d(void 0,void 0,void 0,function*(){if(n!==void 0&&t!==void 0)throw new Bl("Storage and Init cannot be set a the same time. Please either use storage or init but not both.");if(!Array.isArray(r))throw new Kr("Wrong code parameter type, expected an array",r);let l;if(n!==void 0){const y=r.find(N=>"prim"in N&&N.prim==="storage");if((y==null?void 0:y.args)===void 0)throw new Kr("The storage section is missing from the script",r);l=new gt(y.args[0]).Encode(n)}else if(t!==void 0&&typeof t=="object")l=t;else throw new Yo("Wrong init parameter type, expected JSON Michelson",t);const h={code:r,storage:l},p={kind:v.ORIGINATION,fee:s,gas_limit:o,storage_limit:a,balance:c?e.toString():bn("tz","mutez",e).toString(),script:h};return i&&(p.delegate=i),p}),qr=({to:r,amount:t,parameter:e,fee:i=we.TRANSFER,gasLimit:n=Ee.TRANSFER,storageLimit:s=Se.TRANSFER,mutez:o=!1})=>d(void 0,void 0,void 0,function*(){return{kind:v.TRANSACTION,fee:i,gas_limit:n,storage_limit:s,amount:o?t.toString():bn("tz","mutez",t).toString(),destination:r,parameters:e}}),zr=({delegate:r,source:t,fee:e=we.DELEGATION,gasLimit:i=Ee.DELEGATION,storageLimit:n=Se.DELEGATION})=>d(void 0,void 0,void 0,function*(){return{kind:v.DELEGATION,source:t,fee:e,gas_limit:i,storage_limit:n,delegate:r}}),Xo=({fee:r=we.DELEGATION,gasLimit:t=Ee.DELEGATION,storageLimit:e=Se.DELEGATION},i)=>d(void 0,void 0,void 0,function*(){return{kind:v.DELEGATION,fee:r,gas_limit:t,storage_limit:e,delegate:i}}),pr=({fee:r=we.REVEAL,gasLimit:t=Ee.REVEAL,storageLimit:e=Se.REVEAL},i,n)=>d(void 0,void 0,void 0,function*(){return{kind:v.REVEAL,fee:r,public_key:n,source:i,gas_limit:t,storage_limit:e}}),Wr=({value:r,source:t,fee:e,gasLimit:i,storageLimit:n})=>d(void 0,void 0,void 0,function*(){return{kind:v.REGISTER_GLOBAL_CONSTANT,value:r,fee:e,gas_limit:i,storage_limit:n,source:t}}),Jr=({source:r,fee:t,gasLimit:e,storageLimit:i})=>d(void 0,void 0,void 0,function*(){return{kind:v.TX_ROLLUP_ORIGINATION,fee:t,gas_limit:e,storage_limit:i,source:r,tx_rollup_origination:{}}}),Yr=({content:r,rollup:t,source:e,fee:i,gasLimit:n,storageLimit:s})=>d(void 0,void 0,void 0,function*(){return{kind:v.TX_ROLLUP_SUBMIT_BATCH,fee:i,gas_limit:n,storage_limit:s,source:e,content:r,rollup:t}}),Mi=(r,t)=>Object.assign(Object.assign({},r),{kind:t}),xs=(r,t)=>{if(Array.isArray(r)){const e=r.find(i=>i.kind===t);if(e&&Vl(e,t))return e}},Vl=(r,t)=>r.kind===t,Qo=r=>["transaction","delegation","origination","reveal","register_global_constant","tx_rollup_origination","tx_rollup_submit_batch"].indexOf(r.kind)!==-1,Yi=r=>["transaction","delegation","origination","register_global_constant","tx_rollup_origination","tx_rollup_submit_batch"].indexOf(r.kind)!==-1,vn=r=>"metadata"in r,rr=r=>vn(r)&&"operation_result"in r.metadata,Dl=r=>vn(r)&&"internal_operation_results"in r.metadata,kl=r=>"with"in r;class Zo extends Error{constructor(t,e){super(),this.errors=t,this.errorDetails=e,this.name="TezosOperationError";const i=t[t.length-1];this.id=i.id,this.kind=i.kind,this.message=`(${this.kind}) ${this.id}`,kl(i)&&(i.with.string?this.message=i.with.string:i.with.int?this.message=i.with.int:this.message=JSON.stringify(i.with))}}class Fl extends Error{constructor(t){super("Preapply returned an unexpected result"),this.result=t,this.name="TezosPreapplyFailureError"}}const Ut=r=>{const t=Array.isArray(r)?r:[r],e=[];for(let i=0;i<t.length;i++)for(let n=0;n<t[i].contents.length;n++){const s=t[i].contents[n];rr(s)&&(e.push(Object.assign({fee:s.fee},s.metadata.operation_result)),Array.isArray(s.metadata.internal_operation_results)&&s.metadata.internal_operation_results.forEach(o=>e.push(o.result)))}return e},tr=(r,t="failed")=>{const e=Array.isArray(r)?r:[r];let i=[];for(let n=0;n<e.length;n++)for(let s=0;s<e[n].contents.length;s++){const o=e[n].contents[s];if(vn(o)&&(rr(o)&&o.metadata.operation_result.status===t&&(i=i.concat(o.metadata.operation_result.errors||[])),Dl(o)&&Array.isArray(o.metadata.internal_operation_results)))for(const a of o.metadata.internal_operation_results)"result"in a&&a.result.status===t&&(i=i.concat(a.result.errors||[]))}return i};class Hl extends Error{constructor(t){super(t),this.message=t,this.name="OriginationOperationError"}}class ta extends Error{constructor(t){super(t),this.message=t,this.name="InvalidConfirmationCountError"}}class Ul extends Error{constructor(t){super(t),this.message=t,this.name="ConfirmationUndefinedError"}}class Kl extends Error{constructor(t){super(t),this.message=t,this.name="InvalidFilterExpressionError"}}class ce{constructor(t,e,i,n){if(this.hash=t,this.raw=e,this.results=i,this.context=n,this._pollingConfig$=new Vr(1),this.currentHead$=this._pollingConfig$.pipe(Ce(s=>mo(()=>Wo(this.context.stream.subscribeBlock("head"))).pipe(Eo(s.timeout*1e3,hn(new Error("Confirmation polling timed out"))))),hr({refCount:!0})),this.confirmed$=this.currentHead$.pipe(Le(s=>{for(let o=3;o>=0;o--)s.operations[o].forEach(a=>{a.hash===this.hash&&(this._foundAt=s.header.level)});if(s.header.level-this._foundAt>=0)return this._foundAt}),Dr(s=>s!==void 0),ie(),hr()),this._foundAt=Number.POSITIVE_INFINITY,Bs(this.hash)!==L.VALID)throw new Vs(this.hash);this.confirmed$.pipe(ie(),fn(()=>gr(co))).subscribe()}get includedInBlock(){return this._foundAt}get revealOperation(){return Array.isArray(this.results)&&this.results.find(t=>t.kind==="reveal")}get revealStatus(){return this.revealOperation?this.revealOperation.metadata.operation_result.status:"unknown"}get status(){return this.results.map(t=>rr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}confirmation(t,e){return d(this,void 0,void 0,function*(){if(typeof t<"u"&&t<1)throw new ta("Confirmation count must be at least 1");const{defaultConfirmationCount:i,confirmationPollingTimeoutSecond:n}=this.context.config;this._pollingConfig$.next({timeout:e||n});const s=t!==void 0?t:i;return new Promise((o,a)=>{this.confirmed$.pipe(Ce(()=>this.currentHead$),Dr(c=>c.header.level-this._foundAt>=s-1),ie()).subscribe(c=>{o(this._foundAt+(s-1))},a)})})}}class Gl extends ce{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}get status(){return this.results.filter(t=>ea.indexOf(t.kind)!==-1).map(t=>rr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}get fee(){return this.sumProp(this.params,"fee")}get gasLimit(){return this.sumProp(this.params,"gas_limit")}get storageLimit(){return this.sumProp(this.params,"storage_limit")}get consumedGas(){return String(this.sumProp(Ut({contents:this.results}),"consumed_gas"))}get storageDiff(){return String(this.sumProp(Ut({contents:this.results}),"paid_storage_size_diff"))}get errors(){return tr({contents:this.results})}}class oi{constructor(t){this.context=t}get rpc(){return this.context.rpc}get signer(){return this.context.signer}isRevealOpNeeded(t,e){return d(this,void 0,void 0,function*(){return!(!(yield this.isAccountRevealRequired(e))||!this.isRevealRequiredForOpType(t))})}isAccountRevealRequired(t){return d(this,void 0,void 0,function*(){return!(yield this.context.readProvider.isAccountRevealed(t,"head"))})}isRevealRequiredForOpType(t){let e=!1;for(const i of t)Yi(i)&&(e=!0);return e}prepareOperation({operation:t,source:e},i){return d(this,void 0,void 0,function*(){const n={};let s=[];const o=this.context.readProvider.getBlockHash("head~2"),a=this.context.readProvider.getNextProtocol("head");Array.isArray(t)?s=[...t]:s=[t];const c=i||(yield this.signer.publicKeyHash());let l=Promise.resolve(void 0);for(let m=0;m<s.length;m++)if(Yi(s[m])||s[m].kind==="reveal"){l=this.context.readProvider.getCounter(c,"head");break}const[h,p,y]=yield Promise.all([o,a,l]),E=parseInt(y||"0",10);(!n[c]||n[c]<E)&&(n[c]=E);const N=m=>({counter:`${++n[c]}`,fee:typeof m.fee>"u"?"0":`${m.fee}`,gas_limit:typeof m.gas_limit>"u"?"0":`${m.gas_limit}`,storage_limit:typeof m.storage_limit>"u"?"0":`${m.storage_limit}`}),F=m=>({source:typeof m.source>"u"?e||c:m.source}),w=(m=>m.map(G=>{switch(G.kind){case v.ACTIVATION:return Object.assign({},G);case v.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},G),{balance:typeof G.balance<"u"?`${G.balance}`:"0"}),F(G)),N(G));case v.TRANSACTION:{const P=Object.assign(Object.assign(Object.assign(Object.assign({},G),{amount:typeof G.amount<"u"?`${G.amount}`:"0"}),F(G)),N(G));if(P.source.toLowerCase().startsWith("kt1"))throw new Ds(`KT1 addresses are not supported as source since ${it.PsBabyM1}`);return P}case v.REVEAL:case v.DELEGATION:case v.REGISTER_GLOBAL_CONSTANT:case v.TX_ROLLUP_ORIGINATION:case v.TX_ROLLUP_SUBMIT_BATCH:return Object.assign(Object.assign(Object.assign({},G),F(G)),N(G));default:throw new ze(G.kind)}}))(s);return{opOb:{branch:h,contents:w,protocol:p},counter:E}})}forge({opOb:{branch:t,contents:e,protocol:i},counter:n}){return d(this,void 0,void 0,function*(){return{opbytes:yield this.context.forger.forge({branch:t,contents:e}),opOb:{branch:t,contents:e,protocol:i},counter:n}})}simulate(t){return d(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.runOperation(t),op:t,context:this.context.clone()}})}estimate(t,e){var{fee:i,gasLimit:n,storageLimit:s}=t,o=Re(t,["fee","gasLimit","storageLimit"]);return d(this,void 0,void 0,function*(){let a=i,c=n,l=s;if(i===void 0||n===void 0||s===void 0){const h=yield e(Object.assign({fee:i,gasLimit:n,storageLimit:s},o));a===void 0&&(a=h.suggestedFeeMutez),c===void 0&&(c=h.gasLimit),l===void 0&&(l=h.storageLimit)}return{fee:a,gasLimit:c,storageLimit:l}})}signAndInject(t){return d(this,void 0,void 0,function*(){const e=yield this.signer.sign(t.opbytes,new Uint8Array([3]));t.opbytes=e.sbytes,t.opOb.signature=e.prefixSig;const i=[],n=yield this.rpc.preapplyOperations([t.opOb]);if(!Array.isArray(n))throw new Fl(n);for(let o=0;o<n.length;o++)for(let a=0;a<n[o].contents.length;a++)i.push(n[o].contents[a]);const s=tr(n);if(s.length)throw new Zo(s,"Error occurred during validation simulation of operation");return{hash:yield this.context.injector.inject(t.opbytes),forgedBytes:t,opResponse:i,context:this.context.clone()}})}}const ea=[v.ACTIVATION,v.ORIGINATION,v.TRANSACTION,v.DELEGATION];class ra extends oi{constructor(t,e){super(t),this.estimator=e,this.operations=[]}withTransfer(t){if(q(t.to)!==L.VALID)throw new Z(t.to);return this.operations.push(Object.assign({kind:v.TRANSACTION},t)),this}withContractCall(t){return this.withTransfer(t.toTransferParams())}withDelegation(t){if(t.source&&q(t.source)!==L.VALID)throw new Z(t.source);if(t.delegate&&q(t.delegate)!==L.VALID)throw new Z(t.delegate);return this.operations.push(Object.assign({kind:v.DELEGATION},t)),this}withActivation({pkh:t,secret:e}){if(Zi(t)!==L.VALID)throw new Ms(t);return this.operations.push({kind:v.ACTIVATION,pkh:t,secret:e}),this}withOrigination(t){return this.operations.push(Object.assign({kind:v.ORIGINATION},t)),this}withRegisterGlobalConstant(t){return this.operations.push(Object.assign({kind:v.REGISTER_GLOBAL_CONSTANT},t)),this}withTxRollupOrigination(t){return this.operations.push(Object.assign({kind:v.TX_ROLLUP_ORIGINATION},t)),this}withTxRollupSubmitBatch(t){return this.operations.push(Object.assign({kind:v.TX_ROLLUP_SUBMIT_BATCH},t)),this}getRPCOp(t){return d(this,void 0,void 0,function*(){switch(t.kind){case v.TRANSACTION:return qr(Object.assign({},t));case v.ORIGINATION:return Gr(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case v.DELEGATION:return zr(Object.assign({},t));case v.ACTIVATION:return Object.assign({},t);case v.REGISTER_GLOBAL_CONSTANT:return Wr(Object.assign({},t));case v.TX_ROLLUP_ORIGINATION:return Jr(Object.assign({},t));case v.TX_ROLLUP_SUBMIT_BATCH:return Yr(Object.assign({},t));default:throw new ze(t.kind)}})}with(t){for(const e of t)switch(e.kind){case v.TRANSACTION:this.withTransfer(e);break;case v.ORIGINATION:this.withOrigination(e);break;case v.DELEGATION:this.withDelegation(e);break;case v.ACTIVATION:this.withActivation(e);break;case v.REGISTER_GLOBAL_CONSTANT:this.withRegisterGlobalConstant(e);break;case v.TX_ROLLUP_ORIGINATION:this.withTxRollupOrigination(e);break;case v.TX_ROLLUP_SUBMIT_BATCH:this.withTxRollupSubmitBatch(e);break;default:throw new ze(e.kind)}return this}send(t){return d(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.signer.publicKey(),n=yield this.estimator.batch(this.operations),s=yield this.isRevealOpNeeded(this.operations,e);let o=s?1:0;const a=[];for(const F of this.operations){if(Qo(F)){const A=yield this.estimate(F,()=>d(this,void 0,void 0,function*(){return n[o]}));a.push(yield this.getRPCOp(Object.assign(Object.assign({},F),A)))}else a.push(Object.assign({},F));o++}if(s){const F={kind:v.REVEAL},A=yield this.estimate(F,()=>d(this,void 0,void 0,function*(){return n[0]}));a.unshift(yield pr(Object.assign({},A),e,i))}const c=t&&t.source||e,l=yield this.prepareOperation({operation:a,source:c}),h=yield this.forge(l),{hash:p,context:y,forgedBytes:E,opResponse:N}=yield this.signAndInject(h);return new Gl(p,a,c,E,N,y)})}}class ql{constructor(t,e){this.context=t,this.estimator=e}batch(t){const e=new ra(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}const zl=(r,{ALLOCATION_BURN:t,ORIGINATION_BURN:e}={ALLOCATION_BURN:257,ORIGINATION_BURN:257})=>{const i=Ut({contents:r});let n=new V(0),s=new V(0),o=new V(0),a=new V(0),c=new V(0),l=new V(0);return i.forEach(h=>{o=o.plus(h.fee||0),a=a.plus(Array.isArray(h.originated_contracts)?h.originated_contracts.length*e:0),c=c.plus("allocated_destination_contract"in h?t:0),n=n.plus(h.consumed_gas||0),l=l.plus("paid_storage_size_diff"in h&&Number(h.paid_storage_size_diff)||0)}),s=s.plus(c).plus(a).plus(l),{totalFee:o,totalGas:n,totalStorage:s,totalAllocationBurn:c,totalOriginationBurn:a,totalPaidStorageDiff:l,totalStorageBurn:new V(s.multipliedBy(1e3))}};class Wl extends Error{constructor(){super("Taquito missed a block while waiting for operation confirmation and was not able to find the operation"),this.name="MissedBlockDuringConfirmationError"}}const Jl=60;class vr{constructor(t,e,i){if(this.opHash=t,this.context=e,this._newHead$=i,this._operationResult=new Vr(1),this._includedInBlock=new Vr(1),this._included=!1,this.newHead$=this._newHead$.pipe(Ui(n=>{if(!this._included&&this.lastHead&&n.header.level-this.lastHead.header.level>1)throw new Wl;this.lastHead=n}),hr({bufferSize:1,refCount:!0})),this.confirmed$=this.newHead$.pipe(Le(n=>{for(const s of n.operations)for(const o of s)if(o.hash===this.opHash)return this._included=!0,this._includedInBlock.next(n),this._operationResult.next(o.contents),n}),Dr(n=>typeof n<"u"),ie(),hr({bufferSize:1,refCount:!0})),Bs(this.opHash)!==L.VALID)throw new Vs(this.opHash);this.confirmed$.pipe(ie(),fn(()=>gr(void 0))).subscribe()}operationResults(){return d(this,void 0,void 0,function*(){return this._operationResult.pipe(ie()).toPromise()})}receipt(){return d(this,void 0,void 0,function*(){return zl(yield this.operationResults())})}getCurrentConfirmation(){return d(this,void 0,void 0,function*(){return this._included?ns([this._includedInBlock,$e(this.context.readProvider.getBlock("head"))]).pipe(Le(([t,e])=>e.header.level-t.header.level+1),ie()).toPromise():0})}isInCurrentBranch(t="head"){return d(this,void 0,void 0,function*(){if(!this._included)return!0;const e=yield this.context.readProvider.getBlockLevel(t),i=yield this._includedInBlock.pipe(ie()).toPromise(),n=e-i.header.level;if(n<=0)return!0;const s=Math.min(i.header.level+n,i.header.level+Jl);return new Set(yield this.context.readProvider.getLiveBlocks(s)).has(i.hash)})}confirmationObservable(t){if(typeof t<"u"&&t<1)throw new ta("Confirmation count must be at least 1");const{defaultConfirmationCount:e}=this.context.config,i=t!==void 0?t:e;if(i===void 0)throw new Ul("Default confirmation count can not be undefined!");return ns([this._includedInBlock,this.newHead$]).pipe(bo(([,n],[,s])=>n.hash===s.hash),Le(([n,s])=>({block:s,expectedConfirmation:i,currentConfirmation:s.header.level-n.header.level+1,completed:s.header.level-n.header.level>=i-1,isInCurrentBranch:()=>this.isInCurrentBranch(s.hash)})),Gu(({completed:n})=>!n,!0))}confirmation(t){return this.confirmationObservable(t).toPromise()}}class Yl extends vr{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}revealOperation(){return d(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===v.REVEAL)})}status(){return d(this,void 0,void 0,function*(){return this._included?(yield this.operationResults()).filter(e=>ea.indexOf(e.kind)!==-1).map(e=>rr(e)?e.metadata.operation_result.status:"unknown")[0]||"unknown":"pending"})}}class Xl extends vr{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}revealOperation(){return d(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===v.REVEAL)})}delegationOperation(){return d(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===v.DELEGATION)})}status(){return d(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.delegationOperation();return t?t.metadata.operation_result.status:"unknown"})}}class Ql extends vr{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}originationOperation(){return d(this,void 0,void 0,function*(){const t=yield this.operationResults();return xs(t,v.ORIGINATION)})}revealOperation(){return d(this,void 0,void 0,function*(){const t=yield this.operationResults();return xs(t,v.REVEAL)})}status(){return d(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.originationOperation();return t?t.metadata.operation_result.status:"unknown"})}contract(){return d(this,void 0,void 0,function*(){const t=yield this.originationOperation(),e=((t==null?void 0:t.metadata.operation_result.originated_contracts)||[])[0];return this.context.wallet.at(e)})}}class Zl extends vr{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}revealOperation(){return d(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===v.REVEAL)})}transactionOperation(){return d(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===v.TRANSACTION)})}status(){return d(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.transactionOperation();return t?t.metadata.operation_result.status:"unknown"})}}const tp=(r,t,e)=>r.pipe(Eo(t.config.confirmationPollingTimeoutSecond*1e3,hn(new Error("Confirmation polling timed out")),e),hr({refCount:!0,scheduler:e}));class ep{constructor(t){this.context=t,this.sharedHeadObs=mo(()=>Wo(this.context.stream.subscribeBlock("head")))}createNewHeadObservable(){return d(this,void 0,void 0,function*(){return tp(this.sharedHeadObs,this.context)})}createPastBlockWalker(t,e=1){return $e(this.context.readProvider.getBlock(t)).pipe(Ce(i=>e===1?gr(i):du(i.header.level,e-1).pipe(Du(i),yo(n=>d(this,void 0,void 0,function*(){return this.context.readProvider.getBlock(typeof n=="number"?n:n.header.level)})))))}createHeadObservableFromConfig({blockIdentifier:t}){return d(this,void 0,void 0,function*(){const e=[];return t&&e.push(this.createPastBlockWalker(t)),e.push(yield this.createNewHeadObservable()),Hi(...e)})}createOperation(t,e={}){return d(this,void 0,void 0,function*(){return new vr(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createBatchOperation(t,e={}){return d(this,void 0,void 0,function*(){return new Yl(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createTransactionOperation(t,e={}){return d(this,void 0,void 0,function*(){return new Zl(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createDelegationOperation(t,e={}){return d(this,void 0,void 0,function*(){return new Xl(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createOriginationOperation(t,e={}){return d(this,void 0,void 0,function*(){return new Ql(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}}class rp extends oi{constructor(t){super(t)}getBalance(t){return d(this,void 0,void 0,function*(){if(q(t)!==L.VALID)throw new Z(t);return this.context.readProvider.getBalance(t,"head")})}getDelegate(t){return d(this,void 0,void 0,function*(){if(q(t)!==L.VALID)throw new Z(t);return this.context.readProvider.getDelegate(t,"head")})}activate(t,e){return d(this,void 0,void 0,function*(){if(Zi(t)!==L.VALID)throw new Ms(t);const i={kind:v.ACTIVATION,pkh:t,secret:e},n=yield this.prepareOperation({operation:[i],source:t}),s=yield this.forge(n),o=`${s.opbytes}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;return new ce(yield this.rpc.injectOperation(o),Object.assign(Object.assign({},s),{opbytes:o}),[],this.context.clone())})}}const Ar=100,ip=1,np=.1,Ns=100;class wt{constructor(t,e,i,n,s=Ar){this._milligasLimit=t,this._storageLimit=e,this.opSize=i,this.minimalFeePerStorageByteMutez=n,this.baseFeeMutez=s}get burnFeeMutez(){return this.roundUp(Number(this.storageLimit)*Number(this.minimalFeePerStorageByteMutez))}get storageLimit(){const t=Math.max(Number(this._storageLimit),0);return t>0?t:0}get gasLimit(){return this.roundUp(Number(this._milligasLimit)/1e3+Ns)}get operationFeeMutez(){return(Number(this._milligasLimit)/1e3+Ns)*np+Number(this.opSize)*ip}roundUp(t){return Math.ceil(Number(t))}get minimalFeeMutez(){return this.roundUp(Ar+this.operationFeeMutez)}get suggestedFeeMutez(){return this.roundUp(this.operationFeeMutez+Ar*2)}get usingBaseFeeMutez(){return Math.max(Number(this.baseFeeMutez),Ar)+this.roundUp(this.operationFeeMutez)}get totalCost(){return this.minimalFeeMutez+this.burnFeeMutez}get consumedMilligas(){return Number(this._milligasLimit)}static createEstimateInstanceFromProperties(t){let e=0,i=0,n=0,s=0,o;return t.forEach(a=>{e+=a.milligasLimit,i+=a.storageLimit,n+=a.opSize,s=Math.max(a.minimalFeePerStorageByteMutez,s),a.baseFeeMutez&&(o=o?o+a.baseFeeMutez:a.baseFeeMutez)}),new wt(e,i,n,s,o)}static createArrayEstimateInstancesFromProperties(t){return t.map(e=>new wt(e.milligasLimit,e.storageLimit,e.opSize,e.minimalFeePerStorageByteMutez,e.baseFeeMutez))}}class Ts extends Error{constructor(){super("Unable to estimate the reveal operation, the public key is unknown"),this.name="Reveal Estimate Error"}}const Et=(r,t)=>({fee:typeof r.fee>"u"?t.fee:r.fee,gasLimit:typeof r.gasLimit>"u"?t.gasLimit:r.gasLimit,storageLimit:typeof r.storageLimit>"u"?t.storageLimit:r.storageLimit}),sp="edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg";class op extends oi{constructor(){super(...arguments),this.ALLOCATION_STORAGE=257,this.ORIGINATION_STORAGE=257,this.OP_SIZE_REVEAL=128}getKeys(){return d(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{publicKeyHash:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}getAccountLimits(t,e,i){return d(this,void 0,void 0,function*(){const n=yield this.context.readProvider.getBalance(t,"head"),{hard_gas_limit_per_operation:s,hard_gas_limit_per_block:o,hard_storage_limit_per_operation:a,cost_per_byte:c}=e;return{fee:0,gasLimit:i?Math.floor(this.ajustGasForBatchOperation(o,s,i).toNumber()):s.toNumber(),storageLimit:Math.floor(V.min(n.dividedBy(c),a).toNumber())}})}ajustGasForBatchOperation(t,e,i){return V.min(e,t.div(i+1))}getEstimationPropertiesFromOperationContent(t,e,i,n){const s=Ut({contents:[t]});let o=0,a=0,c=0;return s.forEach(l=>{c+="originated_contracts"in l&&typeof l.originated_contracts<"u"?l.originated_contracts.length*this.ORIGINATION_STORAGE:0,c+="allocated_destination_contract"in l?this.ALLOCATION_STORAGE:0,o+=Number(l.consumed_gas)||0,a+=Number(l.consumed_milligas)||0,c+="paid_storage_size_diff"in l&&Number(l.paid_storage_size_diff)||0,c+="storage_size"in l&&"global_address"in l&&Number(l.storage_size)||0,c+="originated_rollup"in l?n:0}),o!==0&&a===0&&(a=o*1e3),Qo(t)?{milligasLimit:a||0,storageLimit:Number(c||0),opSize:e,minimalFeePerStorageByteMutez:i.toNumber()}:{milligasLimit:0,storageLimit:0,opSize:e,minimalFeePerStorageByteMutez:i.toNumber(),baseFeeMutez:0}}prepareEstimate(t,e,i){return d(this,void 0,void 0,function*(){const n=yield this.prepareOperation(t,i),{opbytes:s,opOb:{branch:o,contents:a}}=yield this.forge(n),c={operation:{branch:o,contents:a,signature:sp},chain_id:yield this.context.readProvider.getChainId()},{opResponse:l}=yield this.simulate(c),{cost_per_byte:h,tx_rollup_origination_size:p}=e,y=[...tr(l,"backtracked"),...tr(l)];if(y.length)throw new Zo(y,"Error occurred during estimation");let E=1;return Array.isArray(t.operation)&&t.operation.length>1&&(E=l.contents[0].kind==="reveal"?t.operation.length-1:t.operation.length),l.contents.map(N=>this.getEstimationPropertiesFromOperationContent(N,N.kind==="reveal"?this.OP_SIZE_REVEAL/2:s.length/2/E,h,p!=null?p:0))})}originate(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=Re(t,["fee","storageLimit","gasLimit"]);return d(this,void 0,void 0,function*(){const{publicKeyHash:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Gr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},s),Et({fee:e,storageLimit:i,gasLimit:n},c)))),h=yield this.isRevealOpNeeded([l],o),p=h?yield this.addRevealOp([l],o):l,y=yield this.prepareEstimate({operation:p,source:o},a,o);return h&&y.shift(),wt.createEstimateInstanceFromProperties(y)})}transfer(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=Re(t,["fee","storageLimit","gasLimit"]);return d(this,void 0,void 0,function*(){if(q(s.to)!==L.VALID)throw new Z(s.to);if(s.source&&q(s.source)!==L.VALID)throw new Z(s.source);const o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield qr(Object.assign(Object.assign({},s),Et({fee:e,storageLimit:i,gasLimit:n},c))),h=yield this.isRevealOpNeeded([l],o),p=h?yield this.addRevealOp([l],o):l,y=yield this.prepareEstimate({operation:p,source:o},a,o);return h&&y.shift(),wt.createEstimateInstanceFromProperties(y)})}setDelegate(t){var{fee:e,gasLimit:i,storageLimit:n}=t,s=Re(t,["fee","gasLimit","storageLimit"]);return d(this,void 0,void 0,function*(){if(s.source&&q(s.source)!==L.VALID)throw new Z(s.source);if(s.delegate&&q(s.delegate)!==L.VALID)throw new Z(s.delegate);const o=(yield this.getKeys()).publicKeyHash,a=s.source||o,c=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getAccountLimits(a,c),h=yield zr(Object.assign(Object.assign({},s),Et({fee:e,storageLimit:n,gasLimit:i},l))),p=yield this.isRevealOpNeeded([h],o),y=p?yield this.addRevealOp([h],o):h,E=yield this.prepareEstimate({operation:y,source:o},c,o);return p&&E.shift(),wt.createEstimateInstanceFromProperties(E)})}batch(t){return d(this,void 0,void 0,function*(){const{publicKeyHash:e}=yield this.getKeys();let i=[];const n=yield this.context.readProvider.getProtocolConstants("head"),s=yield this.getAccountLimits(e,n,t.length);for(const c of t)switch(c.kind){case v.TRANSACTION:i.push(yield qr(Object.assign(Object.assign({},c),Et(c,s))));break;case v.ORIGINATION:i.push(yield Gr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},c),Et(c,s)))));break;case v.DELEGATION:i.push(yield zr(Object.assign(Object.assign({},c),Et(c,s))));break;case v.ACTIVATION:i.push(Object.assign(Object.assign({},c),s));break;case v.REGISTER_GLOBAL_CONSTANT:i.push(yield Wr(Object.assign(Object.assign({},c),Et(c,s))));break;case v.TX_ROLLUP_ORIGINATION:i.push(yield Jr(Object.assign(Object.assign({},c),Et(c,s))));break;case v.TX_ROLLUP_SUBMIT_BATCH:i.push(yield Yr(Object.assign(Object.assign({},c),Et(c,s))));break;default:throw new ze(t.kind)}i=(yield this.isRevealOpNeeded(i,e))?yield this.addRevealOp(i,e):i;const a=yield this.prepareEstimate({operation:i,source:e},n,e);return wt.createArrayEstimateInstancesFromProperties(a)})}registerDelegate(t){return d(this,void 0,void 0,function*(){const e=(yield this.getKeys()).publicKeyHash,i=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.getAccountLimits(e,i),s=yield Xo(Object.assign(Object.assign({},t),n),e),o=yield this.isRevealOpNeeded([s],e),a=o?yield this.addRevealOp([s],e):s,c=yield this.prepareEstimate({operation:a,source:e},i,e);return o&&c.shift(),wt.createEstimateInstanceFromProperties(c)})}reveal(t){return d(this,void 0,void 0,function*(){const{publicKeyHash:e,publicKey:i}=yield this.getKeys();if(!i)throw new Ts;if(yield this.isAccountRevealRequired(e)){const n=yield this.context.readProvider.getProtocolConstants("head"),s=yield this.getAccountLimits(e,n),o=yield pr(Object.assign(Object.assign({},t),s),e,i),a=yield this.prepareEstimate({operation:o,source:e},n,e);return wt.createEstimateInstanceFromProperties(a)}})}registerGlobalConstant(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=Re(t,["fee","storageLimit","gasLimit"]);return d(this,void 0,void 0,function*(){const o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Wr(Object.assign(Object.assign({},s),Et({fee:e,storageLimit:i,gasLimit:n},c))),h=yield this.isRevealOpNeeded([l],o),p=h?yield this.addRevealOp([l],o):l,y=yield this.prepareEstimate({operation:p,source:o},a,o);return h&&y.shift(),wt.createEstimateInstanceFromProperties(y)})}txRollupOriginate(t){return d(this,void 0,void 0,function*(){t=t||{};const{fee:e,storageLimit:i,gasLimit:n}=t,s=Re(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Jr(Object.assign(Object.assign({},s),Et({fee:e,storageLimit:i,gasLimit:n},c))),h=yield this.isRevealOpNeeded([l],o),p=h?yield this.addRevealOp([l],o):l,y=yield this.prepareEstimate({operation:p,source:o},a,o);return h&&y.shift(),wt.createEstimateInstanceFromProperties(y)})}txRollupSubmitBatch(t){return d(this,void 0,void 0,function*(){const{fee:e,storageLimit:i,gasLimit:n}=t,s=Re(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Yr(Object.assign(Object.assign({},s),Et({fee:e,storageLimit:i,gasLimit:n},c))),h=yield this.isRevealOpNeeded([l],o),p=h?yield this.addRevealOp([l],o):l,y=yield this.prepareEstimate({operation:p,source:o},a,o);return h&&y.shift(),wt.createEstimateInstanceFromProperties(y)})}addRevealOp(t,e){return d(this,void 0,void 0,function*(){const{publicKey:i}=yield this.getKeys();if(!i)throw new Ts;return t.unshift(yield pr(Object.assign({fee:we.REVEAL,gasLimit:Ee.REVEAL,storageLimit:Se.REVEAL}),e,yield this.signer.publicKey())),t})}}class Ls extends ce{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="delegation"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){const t=this.operationResults;return t?t.status:"unknown"}get delegate(){return this.delegate}get isRegisterOperation(){return this.delegate===this.source}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedGas(){const t=this.operationResults&&this.operationResults.consumed_gas;return t||void 0}get errors(){return this.operationResults&&this.operationResults.errors}}class ap extends ce{constructor(t,e,i,n,s,o){super(t,i,n,s),this.params=e,this.contractProvider=o;const a=this.operationResults&&this.operationResults.originated_contracts;Array.isArray(a)&&(this.contractAddress=a[0])}get status(){const t=this.operationResults;return t?t.status:"unknown"}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="origination"),e=t&&rr(t)&&t.metadata.operation_result;return e||void 0}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedGas(){const t=this.operationResults&&this.operationResults.consumed_gas;return t||void 0}get storageDiff(){const t=this.operationResults&&this.operationResults.paid_storage_size_diff;return t||void 0}get storageSize(){const t=this.operationResults&&this.operationResults.storage_size;return t||void 0}get errors(){return this.operationResults&&this.operationResults.errors}contract(t,e){return d(this,void 0,void 0,function*(){if(!this.contractAddress)throw new Hl("No contract was originated in this operation");return yield this.confirmation(t,e),this.contractProvider.at(this.contractAddress)})}}class cp extends ce{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i,this.globalConstantHash=this.operationResults&&this.operationResults.global_address}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="register_global_constant"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){const t=this.operationResults;return t?t.status:"unknown"}get registeredExpression(){return this.params.value}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){return this.operationResults&&this.operationResults.errors}}class up extends ce{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="reveal");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get publicKey(){return this.params.public_key}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}get consumedGas(){return String(this.sumProp(Ut({contents:this.operationResults}),"consumed_gas"))}get storageDiff(){return String(this.sumProp(Ut({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(Ut({contents:this.operationResults}),"storage_size"))}get errors(){return tr({contents:this.operationResults})}}class hp extends ce{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="transaction");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get amount(){return new V(this.params.amount)}get destination(){return this.params.destination}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}get consumedGas(){return String(this.sumProp(Ut({contents:this.operationResults}),"consumed_gas"))}get storageDiff(){return String(this.sumProp(Ut({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(Ut({contents:this.operationResults}),"storage_size"))}get errors(){return tr({contents:this.operationResults})}}class lp{constructor(t,e,i,n,s,o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=i,this.name=n,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}validateArgs(t,e,i){const n=e.ExtractSignatures();if(!n.find(s=>s.length===t.length))throw new Jo(i,n,t)}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}getSignature(){if(this.isAnonymous){const t=this.parameterSchema.ExtractSignatures().find(e=>e[0]===this.name);if(t)return t.shift(),t}else{const t=this.parameterSchema.ExtractSignatures();return t.length==1?t[0]:t}}send(t={}){return this.provider instanceof ai?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:i,source:n,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:n,gasLimit:e,storageLimit:i,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:He,value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}}class pp{constructor(t,e){this.walletProvider=t,this.context=e,this.operations=[]}withTransfer(t){if(q(t.to)!==L.VALID)throw new Z(t.to);return this.operations.push(Object.assign({kind:v.TRANSACTION},t)),this}withContractCall(t){return this.withTransfer(t.toTransferParams())}withDelegation(t){if(t.delegate&&q(t.delegate)!==L.VALID)throw new Z(t.delegate);return this.operations.push(Object.assign({kind:v.DELEGATION},t)),this}withOrigination(t){return this.operations.push(Object.assign({kind:v.ORIGINATION},t)),this}mapOperation(t){return d(this,void 0,void 0,function*(){switch(t.kind){case v.TRANSACTION:return this.walletProvider.mapTransferParamsToWalletParams(()=>d(this,void 0,void 0,function*(){return t}));case v.ORIGINATION:return this.walletProvider.mapOriginateParamsToWalletParams(()=>d(this,void 0,void 0,function*(){return this.context.parser.prepareCodeOrigination(Object.assign({},t))}));case v.DELEGATION:return this.walletProvider.mapDelegateParamsToWalletParams(()=>d(this,void 0,void 0,function*(){return t}));default:throw new ze(t.kind)}})}with(t){for(const e of t)switch(e.kind){case v.TRANSACTION:this.withTransfer(e);break;case v.ORIGINATION:this.withOrigination(e);break;case v.DELEGATION:this.withDelegation(e);break;default:throw new ze(e.kind)}return this}send(){return d(this,void 0,void 0,function*(){const t=[];for(const i of this.operations)t.push(yield this.mapOperation(i));const e=yield this.walletProvider.sendOperations(t);return this.context.operationFactory.createBatchOperation(e)})}}class ai{constructor(t){this.context=t,this.walletCommand=e=>({send:e})}get walletProvider(){return this.context.walletProvider}pkh({forceRefetch:t}={}){return d(this,void 0,void 0,function*(){return(!this._pkh||t)&&(this._pkh=yield this.walletProvider.getPKH()),this._pkh})}originate(t){return this.walletCommand(()=>d(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapOriginateParamsToWalletParams(()=>this.context.parser.prepareCodeOrigination(Object.assign({},t))),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createOriginationOperation(i)}))}setDelegate(t){if(t.delegate&&q(t.delegate)!==L.VALID)throw new Z(t.delegate);return this.walletCommand(()=>d(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>d(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createDelegationOperation(i)}))}registerDelegate(){return this.walletCommand(()=>d(this,void 0,void 0,function*(){const t=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>d(this,void 0,void 0,function*(){return{delegate:yield this.pkh()}})),e=yield this.walletProvider.sendOperations([t]);return this.context.operationFactory.createDelegationOperation(e)}))}transfer(t){if(q(t.to)!==L.VALID)throw new Z(t.to);return this.walletCommand(()=>d(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapTransferParamsToWalletParams(()=>d(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createTransactionOperation(i)}))}batch(t){const e=new pp(this.walletProvider,this.context);return Array.isArray(t)&&e.with(t),e}at(t,e=i=>i){return d(this,void 0,void 0,function*(){if(Ue(t)!==L.VALID)throw new Pr(t);const i=this.context.withExtensions().rpc,n=this.context.withExtensions().readProvider,s=yield n.getScript(t,"head"),o=yield n.getEntrypoints(t),a=new na(t,s,this,this.context.contract,o,i,n);return e(a,this.context)})}}class ia{constructor(t){this.context=t}getPKH(){return d(this,void 0,void 0,function*(){return this.context.signer.publicKeyHash()})}mapTransferParamsToWalletParams(t){return d(this,void 0,void 0,function*(){return Mi(yield t(),v.TRANSACTION)})}mapOriginateParamsToWalletParams(t){return d(this,void 0,void 0,function*(){return Mi(yield t(),v.ORIGINATION)})}mapDelegateParamsToWalletParams(t){return d(this,void 0,void 0,function*(){return Mi(yield t(),v.DELEGATION)})}sendOperations(t){return d(this,void 0,void 0,function*(){return(yield this.context.batch.batch(t).send()).hash})}}class fp{constructor(t,e,i,n,s="unit",o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=i,this.name=n,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}getSignature(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(t={}){return this.provider instanceof ai?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:i,source:n,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:n,gasLimit:e,storageLimit:i,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:He,value:this.isAnonymous?this.parameterSchema.EncodeObject({[this.name]:this.args}):this.parameterSchema.EncodeObject(this.args)}}}}const dp=(r,t,e,i,n,s,o,a,c,l="0")=>({script:[{prim:"parameter",args:[{prim:"pair",args:[r,e]}]},{prim:"storage",args:[{prim:"option",args:[t]}]},{prim:"code",args:[[{prim:"CAR"},i,{prim:"SOME"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}],storage:{prim:"None"},input:{prim:"Pair",args:[n,s]},amount:l,balance:o,chain_id:a,source:c});class gp{constructor(t,e,i,n,s,o="Unit"){this._rpc=t,this._readProvider=e,this._contractAddress=i,this._smartContractViewSchema=n,this._contractStorageType=s,this._args=o}getSignature(){return{parameter:this._smartContractViewSchema.extractArgsSchema(),result:this._smartContractViewSchema.extractResultSchema()}}executeView(t){return d(this,void 0,void 0,function*(){this.verifyContextExecution(t);const e=(yield this._readProvider.getBalance(this._contractAddress,"head")).toString(),i=yield this._readProvider.getChainId(),n=yield this._readProvider.getStorage(this._contractAddress,"head");return this.executeViewAndDecodeResult(dp(this._smartContractViewSchema.viewArgsType,this._smartContractViewSchema.viewReturnType,this._contractStorageType,this.adaptViewCodeToContext(this._smartContractViewSchema.instructions,t.viewCaller,e),this.transformArgsToMichelson(),n,e,i,t.source))})}verifyContextExecution(t){if(t.source&&q(t.source)!==L.VALID)throw new Is(`The source account who initialized the view execution is invalid: ${t.source}.`);if(!t.viewCaller||q(t.viewCaller)!==L.VALID)throw new Is(`The contract which is the caller of view is invalid: ${t.viewCaller}.`)}transformArgsToMichelson(){try{return this._smartContractViewSchema.encodeViewArgs(this._args)}catch(t){throw new Cl(this._smartContractViewSchema.viewName,this.getSignature(),this._args,t)}}adaptViewCodeToContext(t,e,i){const n={BALANCE:[{prim:"PUSH",args:[{prim:"mutez"},{int:i}]}],SENDER:[{prim:"PUSH",args:[{prim:"address"},{string:e}]}],SELF_ADDRESS:[{prim:"PUSH",args:[{prim:"address"},{string:this._contractAddress}]}],AMOUNT:[{prim:"PUSH",args:[{prim:"mutez"},{int:"0"}]}]};return t.forEach((s,o)=>{s.prim in n&&(t[o]=Object(n)[s.prim]),s.args&&s.args.length!==0?this.adaptViewCodeToContext(s.args,e,i):Array.isArray(s)&&this.adaptViewCodeToContext(s,e,i)}),t}executeViewAndDecodeResult(t){return d(this,void 0,void 0,function*(){let e;try{e=(yield this._rpc.runCode(t)).storage}catch(i){const n=jl(i);throw n?new Ps(`The simulation of the on-chain view named ${this._smartContractViewSchema.viewName} failed with: ${JSON.stringify(n)}`,this._smartContractViewSchema.viewName,n,i):i}if(!e.args)throw new Ps(`View simulation failed with an invalid result: ${e}`,this._smartContractViewSchema.viewName);return this._smartContractViewSchema.decodeViewResult(e.args[0])})}}class mp{constructor(t,e){this.provider=t,this.contractAddress=e}createContractMethodFlatParams(t,e,i,n=!0,s=!1){return new lp(this.provider,this.contractAddress,t,e,i,n,s)}createContractMethodObjectParam(t,e,i,n=!0,s=!1){return new fp(this.provider,this.contractAddress,t,e,i,n,s)}createContractViewObjectParam(t,e,i,n,s){return new gp(t,e,this.contractAddress,i,n,s)}}const He="default";class yp{constructor(t,e,i,n,s,o,a){this.currentContract=t,this.name=e,this.callbackParametersSchema=i,this.parameterSchema=n,this.args=s,this.rpc=o,this.readProvider=a}read(t){return d(this,void 0,void 0,function*(){if(Ue(t!=null?t:"")==L.VALID)throw new Ds("Since version 12, the lambda view no longer depends on a lambda contract. The read method no longer accepts a contract address as a parameter.");if(t&&$s(t)!==L.VALID)throw new Ea(t);const e=this.parameterSchema.Encode(...this.args),i=yield this.rpc.runView({contract:this.currentContract.address,entrypoint:this.name,input:e,chain_id:t||(yield this.readProvider.getChainId())});return this.callbackParametersSchema.Execute(i.data)})}}const bp=(r,t,e)=>{const i=t.ExtractSignatures();if(!i.find(n=>n.length===r.length))throw new Jo(e,i,r)},vp=r=>{let t=!1;if("prim"in r&&r.prim==="pair"&&r.args){const e=r.args[r.args.length-1];"prim"in e&&e.prim==="contract"&&(t=!0)}return t};class na{constructor(t,e,i,n,s,o,a){this.address=t,this.script=e,this.storageProvider=n,this.entrypoints=s,this.rpc=o,this.readProvider=a,this.methods={},this.methodsObject={},this.views={},this.contractViews={},this.contractMethodFactory=new mp(i,t),this.schema=gt.fromRPCResponse({script:this.script}),this.parameterSchema=Fe.fromRPCResponse({script:this.script}),this.viewSchema=dn.fromRPCResponse({script:this.script}),this.viewSchema.length!==0&&this._initializeOnChainViews(this,o,this.readProvider,this.viewSchema),this._initializeMethods(this,this.entrypoints.entrypoints,this.rpc,this.readProvider)}_initializeMethods(t,e,i,n){const s=this.parameterSchema,o=Object.keys(e);if(s.isMultipleEntryPoint)o.forEach(c=>{const l=new Fe(e[c]);if(this.methods[c]=function(...h){return t.contractMethodFactory.createContractMethodFlatParams(l,c,h)},this.methodsObject[c]=function(h){return t.contractMethodFactory.createContractMethodObjectParam(l,c,h)},vp(e[c])){const h=function(...p){const y=e[c].args[0],E=new Fe(y),N=e[c].args[1].args[0],F=new Fe(N);return bp(p,E,c),new yp(t,c,F,E,p,i,n)};this.views[c]=h}}),Object.keys(s.ExtractSchema()).filter(c=>Object.keys(e).indexOf(c)===-1).forEach(c=>{this.methods[c]=function(...l){return t.contractMethodFactory.createContractMethodFlatParams(s,c,l,!1,!0)},this.methodsObject[c]=function(l){return t.contractMethodFactory.createContractMethodObjectParam(s,c,l,!1,!0)}});else{const a=this.parameterSchema;this.methods[He]=function(...c){return t.contractMethodFactory.createContractMethodFlatParams(a,He,c,!1)},this.methodsObject[He]=function(c){return t.contractMethodFactory.createContractMethodObjectParam(a,He,c,!1)}}}_initializeOnChainViews(t,e,i,n){const s=this.schema.val;n.forEach(o=>{this.contractViews[o.viewName]=function(a){return t.contractMethodFactory.createContractViewObjectParam(e,i,o,s,a)}})}storage(){return this.storageProvider.getStorage(this.address,this.schema)}bigMap(t){return this.storageProvider.getBigMapKey(this.address,t,this.schema)}}class Ep{constructor(t,e,i){this.id=t,this.schema=e,this.provider=i}get(t,e){return d(this,void 0,void 0,function*(){try{return yield this.provider.getBigMapKeyByID(this.id.toString(),t,this.schema,e)}catch(i){if(i instanceof ri&&i.status===cr.NOT_FOUND)return;throw i}})}getMultipleValues(t,e,i=5){return d(this,void 0,void 0,function*(){return this.provider.getBigMapKeysByID(this.id.toString(),t,this.schema,e,i)})}toJSON(){return this.id.toString()}toString(){return this.id.toString()}}class wp{constructor(t,e){this.id=t,this.provider=e}getSaplingDiff(t){return d(this,void 0,void 0,function*(){return this.provider.getSaplingDiffByID(this.id.toString(),t)})}getId(){return this.id.toString()}}const Cs=r=>({big_map:(t,e)=>{if(!t||!("int"in t)||t.int===void 0)return{};{const i=new gt(e);return new Ep(new V(t.int),i,r)}},sapling_state:t=>!t||!("int"in t)||t.int===void 0?{}:new wp(new V(t.int),r)});class Sp extends ce{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i,this.originatedRollup=this.operationResults&&this.operationResults.originated_rollup}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="tx_rollup_origination"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){const t=this.operationResults;return t?t.status:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){return this.operationResults&&this.operationResults.errors}}class Op extends ce{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="tx_rollup_submit_batch"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){const t=this.operationResults;return t?t.status:"unknown"}get content(){return this.params.content}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){return this.operationResults&&this.operationResults.errors}}class _p extends oi{constructor(t,e){super(t),this.estimator=e,this.contractProviderTypeSymbol=Symbol.for("taquito--provider-type-symbol")}getStorage(t,e){return d(this,void 0,void 0,function*(){if(Ue(t)!==L.VALID)throw new Pr(t);const i=yield this.context.readProvider.getScript(t,"head");e||(e=i);let n;return gt.isSchema(e)?n=e:n=gt.fromRPCResponse({script:e}),n.Execute(i.storage,Cs(this))})}getBigMapKey(t,e,i){return d(this,void 0,void 0,function*(){if(Ue(t)!==L.VALID)throw new Pr(t);i||(i=(yield this.rpc.getContract(t)).script);let n;gt.isSchema(i)?n=i:n=gt.fromRPCResponse({script:i});const s=n.EncodeBigMapKey(e),o=yield this.rpc.getBigMapKey(t,s);return n.ExecuteOnBigMapValue(o)})}getBigMapKeyByID(t,e,i,n){return d(this,void 0,void 0,function*(){const{key:s,type:o}=i.EncodeBigMapKey(e),{packed:a}=yield this.context.packer.packData({data:s,type:o}),c=va(a),l=n?yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},n):yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},"head");return i.ExecuteOnBigMapValue(l,Cs(this))})}getBigMapKeysByID(t,e,i,n,s=5){return d(this,void 0,void 0,function*(){const o=yield this.getBlockForRequest(e,n),a=new dt;let c=0,l=[];for(;c<e.length;){const p=e.slice(c,c+s).map(y=>this.getBigMapValueOrUndefined(y,t,i,o));l=[...l,...yield Promise.all(p)],c+=s}for(let h=0;h<l.length;h++)a.set(e[h],l[h]);return a})}getBlockForRequest(t,e){return d(this,void 0,void 0,function*(){return t.length===1||typeof e<"u"?e:yield this.context.readProvider.getBlockLevel("head")})}getBigMapValueOrUndefined(t,e,i,n){return d(this,void 0,void 0,function*(){try{return yield this.getBigMapKeyByID(e,t,i,n)}catch(s){if(s instanceof ri&&s.status===cr.NOT_FOUND)return;throw s}})}getSaplingDiffByID(t,e){return d(this,void 0,void 0,function*(){return e?yield this.context.readProvider.getSaplingDiffById({id:t.toString()},e):yield this.context.readProvider.getSaplingDiffById({id:t.toString()},"head")})}addRevealOperationIfNeeded(t,e){return d(this,void 0,void 0,function*(){if(Yi(t)){const i=[t],n=yield this.signer.publicKey(),s=yield this.estimator.reveal();if(s){const o={kind:v.REVEAL},a=yield this.estimate(o,()=>d(this,void 0,void 0,function*(){return s}));return i.unshift(yield pr(Object.assign({},a),e,n)),i}}return t})}originate(t){return d(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.originate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield Gr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},t),e))),s=yield this.addRevealOperationIfNeeded(n,i),o=yield this.prepareOperation({operation:s,source:i}),a=yield this.forge(o),{hash:c,context:l,forgedBytes:h,opResponse:p}=yield this.signAndInject(a);return new ap(c,n,h,p,l,this)})}setDelegate(t){return d(this,void 0,void 0,function*(){if(t.source&&q(t.source)!==L.VALID)throw new Z(t.source);if(t.delegate&&q(t.delegate)!==L.VALID)throw new Z(t.delegate);if(/kt1/i.test(t.source))throw new Ll(t.source);const e=yield this.estimate(t,this.estimator.setDelegate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield zr(Object.assign(Object.assign({},t),e)),s=t.source||i,o=yield this.addRevealOperationIfNeeded(n,i),a=yield this.prepareOperation({operation:o,source:s}),c=yield this.forge(a),{hash:l,context:h,forgedBytes:p,opResponse:y}=yield this.signAndInject(c);return new Ls(l,n,s,p,y,h)})}registerDelegate(t){return d(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.registerDelegate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield Xo(Object.assign(Object.assign({},t),e),i),s=yield this.addRevealOperationIfNeeded(n,i),o=yield this.prepareOperation({operation:s}),a=yield this.forge(o),{hash:c,context:l,forgedBytes:h,opResponse:p}=yield this.signAndInject(a);return new Ls(c,n,i,h,p,l)})}transfer(t){return d(this,void 0,void 0,function*(){if(q(t.to)!==L.VALID)throw new Z(t.to);if(t.source&&q(t.source)!==L.VALID)throw new Z(t.source);const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.transfer.bind(this.estimator)),n=yield qr(Object.assign(Object.assign({},t),i)),s=t.source||e,o=yield this.addRevealOperationIfNeeded(n,e),a=yield this.prepareOperation({operation:o,source:t.source}),c=yield this.forge(a),{hash:l,context:h,forgedBytes:p,opResponse:y}=yield this.signAndInject(c);return new hp(l,n,s,p,y,h)})}reveal(t){return d(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimator.reveal(t);if(i){const n=yield this.estimate(t,()=>d(this,void 0,void 0,function*(){return i})),s=yield pr(Object.assign({},n),e,yield this.signer.publicKey()),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:l,forgedBytes:h,opResponse:p}=yield this.signAndInject(a);return new up(c,s,e,h,p,l)}else throw new Ml(`The publicKeyHash '${e}' has already been revealed.`)})}registerGlobalConstant(t){return d(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.registerGlobalConstant.bind(this.estimator)),n=yield Wr(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:l,forgedBytes:h,opResponse:p}=yield this.signAndInject(a);return new cp(c,n,e,h,p,l)})}txRollupOriginate(t){return d(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t||{},this.estimator.txRollupOriginate.bind(this.estimator)),n=yield Jr(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:l,forgedBytes:h,opResponse:p}=yield this.signAndInject(a);return new Sp(c,n,e,h,p,l)})}txRollupSubmitBatch(t){return d(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.txRollupSubmitBatch.bind(this.estimator)),n=yield Yr(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:l,forgedBytes:h,opResponse:p}=yield this.signAndInject(a);return new Op(c,n,e,h,p,l)})}at(t,e=i=>i){return d(this,void 0,void 0,function*(){if(Ue(t)!==L.VALID)throw new Pr(t);const i=this.context.withExtensions().rpc,n=this.context.withExtensions().readProvider,s=yield n.getScript(t,"head"),o=yield n.getEntrypoints(t),a=new na(t,s,this,this,o,i,n);return e(a,this.context)})}batch(t){const e=new ra(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class Rp{constructor(t){this.context=t}getNextProto(){return d(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}parseScript(t){return d(this,void 0,void 0,function*(){return new Te({protocol:yield this.getNextProto()}).parseScript(t)})}parseMichelineExpression(t){return d(this,void 0,void 0,function*(){return new Te({protocol:yield this.getNextProto()}).parseMichelineExpression(t)})}parseJSON(t){return d(this,void 0,void 0,function*(){return new Te({protocol:yield this.getNextProto()}).parseJSON(t)})}prepareCodeOrigination(t){return d(this,void 0,void 0,function*(){const e=t;if(e.code=yield this.formatCodeParam(t.code),t.init)e.init=yield this.formatInitParam(t.init);else if(t.storage){const i=e.code.find(o=>"prim"in o&&o.prim==="storage");if(!(i!=null&&i.args))throw new Kr("The storage section is missing from the script",t.code);const n=new gt(i.args[0]),s=yield this.findGlobalConstantsHashAndValue(n);if(Object.keys(s).length!==0){const a=new Te({expandGlobalConstant:s}).parseJSON(i.args[0]),c=new gt(a);e.init=c.Encode(t.storage)}else e.init=n.Encode(t.storage);delete e.storage}return e})}formatCodeParam(t){return d(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const i=yield this.parseScript(t);if(i===null)throw new Kr("Invalid code parameter",t);e=i}else{const i=yield this.parseJSON(t),n=["parameter","storage","code"];e=i.sort((s,o)=>n.indexOf(s.prim)-n.indexOf(o.prim))}return e})}formatInitParam(t){return d(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const i=yield this.parseMichelineExpression(t);if(i===null)throw new Yo("Invalid init parameter",t);e=i}else e=yield this.parseJSON(t);return e})}findGlobalConstantsHashAndValue(t){return d(this,void 0,void 0,function*(){const e=t.findToken("constant"),i={};if(e.length!==0)for(const n of e){const s=n.tokenVal.args;if(s){const o=s[0];if(o.string){const a=o.string,c=yield this.context.globalConstantsProvider.getGlobalConstantByHash(a);Object.assign(i,{[a]:c})}}}return i})}}class sa{constructor(t){this.context=t}packData(t){return d(this,void 0,void 0,function*(){return this.context.rpc.packData(t)})}}class Ap extends Error{constructor(){super("No globalThis constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance."),this.name="UnconfiguredGlobalConstantsProviderError"}}class oa{getGlobalConstantByHash(t){return d(this,void 0,void 0,function*(){throw new Ap})}}class aa{constructor(t){this.context=t}getBalance(t,e){return d(this,void 0,void 0,function*(){return this.context.rpc.getBalance(t,{block:String(e)})})}getDelegate(t,e){return d(this,void 0,void 0,function*(){return this.context.rpc.getDelegate(t,{block:String(e)})})}getNextProtocol(t){return d(this,void 0,void 0,function*(){return(yield this.context.rpc.getProtocols({block:String(t)})).next_protocol})}getProtocolConstants(t){return d(this,void 0,void 0,function*(){const{time_between_blocks:e,minimal_block_delay:i,hard_gas_limit_per_operation:n,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c}=yield this.context.rpc.getConstants({block:String(t)});return{time_between_blocks:e,minimal_block_delay:i,hard_gas_limit_per_operation:n,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c}})}getScript(t,e){return d(this,void 0,void 0,function*(){const{script:i}=yield this.context.rpc.getContract(t,{block:String(e)});return i})}getStorage(t,e){return d(this,void 0,void 0,function*(){return this.context.rpc.getStorage(t,{block:String(e)})})}getBlockHash(t){return d(this,void 0,void 0,function*(){const{hash:e}=yield this.context.rpc.getBlockHeader({block:String(t)});return e})}getBlockLevel(t){return d(this,void 0,void 0,function*(){const{level:e}=yield this.context.rpc.getBlockHeader({block:String(t)});return e})}getCounter(t,e){return d(this,void 0,void 0,function*(){const{counter:i}=yield this.context.rpc.getContract(t,{block:String(e)});return i||"0"})}getBlockTimestamp(t){return d(this,void 0,void 0,function*(){const{timestamp:e}=yield this.context.rpc.getBlockHeader({block:String(t)});return e})}getBigMapValue(t,e){return d(this,void 0,void 0,function*(){return this.context.rpc.getBigMapExpr(t.id,t.expr,{block:String(e)})})}getSaplingDiffById(t,e){return d(this,void 0,void 0,function*(){return this.context.rpc.getSaplingDiffById(t.id,{block:String(e)})})}getEntrypoints(t){return d(this,void 0,void 0,function*(){return this.context.rpc.getEntrypoints(t)})}getChainId(){return d(this,void 0,void 0,function*(){return this.context.rpc.getChainId()})}isAccountRevealed(t,e){return d(this,void 0,void 0,function*(){const i=yield this.context.rpc.getManagerKey(t,{block:String(e)});return i&&typeof i=="object"?!!i.key:!!i})}getBlock(t){return d(this,void 0,void 0,function*(){return this.context.rpc.getBlock({block:String(t)})})}getLiveBlocks(t){return this.context.rpc.getLiveBlocks({block:String(t)})}}const Pp=(r,t)=>r.hash===t.opHash,Ip=(r,t)=>{switch(r.kind){case"endorsement":return"metadata"in r&&r.metadata.delegate===t.source;case"activate_account":return"metadata"in r&&r.pkh===t.source;default:return"source"in r&&r.source===t.source}},xp=(r,t)=>"kind"in r&&r.kind===t.kind,Np=(r,t)=>{switch(r.kind){case"delegation":return r.delegate===t.destination;case"origination":if("metadata"in r&&"operation_result"in r.metadata&&"originated_contracts"in r.metadata.operation_result&&Array.isArray(r.metadata.operation_result.originated_contracts))return r.metadata.operation_result.originated_contracts.some(e=>e===t.destination);break;case"transaction":return r.destination===t.destination;default:return!1}},Tp=(r,t)=>"opHash"in t?Pp(r,t):"source"in t?Ip(r,t):"kind"in t?xp(r,t):"destination"in t?Np(r,t):!1,Lp=(r,t)=>{if(Array.isArray(t.and))return t.and.every(e=>Xi(r,e));if(Array.isArray(t.or))return t.or.some(e=>Xi(r,e));throw new Kl("Filter expression must contain either and/or property")},Xi=(r,t)=>{const e=[];return Array.isArray(t)?e.push(...t):e.push(t),e.every(i=>"and"in i||"or"in i?Lp(r,i):Tp(r,i))};class js extends Error{constructor(t){super(t),this.message=t,this.name="UnsupportedEventError"}}class Bi{constructor(t,e=!1,i=vo()){this.shouldRetry=e,this.operatorFunction=i,this.errorListeners=[],this.messageListeners=[],this.closeListeners=[],this.completed$=new We,t.pipe(Hu(this.completed$),Ui(n=>{this.call(this.messageListeners,n)},n=>{this.call(this.errorListeners,n)},()=>{this.call(this.closeListeners)}),this.shouldRetry?i:Ui(),fn(()=>lu)).subscribe()}call(t,e){for(const i of t)try{i(e)}catch(n){console.error(n)}}remove(t,e){const i=t.indexOf(e);i!==-1&&t.splice(i,1)}on(t,e){switch(t){case"data":this.messageListeners.push(e);break;case"error":this.errorListeners.push(e);break;case"close":this.closeListeners.push(e);break;default:throw new js(`Trying to register on an unsupported event: ${t}`)}}off(t,e){switch(t){case"data":this.remove(this.messageListeners,e);break;case"error":this.remove(this.errorListeners,e);break;case"close":this.remove(this.closeListeners,e);break;default:throw new js(`Trying to unregister on an unsupported event: ${t}`)}}close(){this.completed$.next()}}const Cp={shouldObservableSubscriptionRetry:!1,observableSubscriptionRetryFunction:vo()},jp=r=>$e(r.rpc.getBlock()).pipe(ie()),$p=r=>yo(t=>new W(e=>{for(const i of t.operations)for(const n of i)for(const s of n.contents)Xi(Object.assign({hash:n.hash},s),r)&&e.next(Object.assign({hash:n.hash},s));e.complete()}));class Qi{constructor(t,e={}){this.context=t,this._config$=new so(Object.assign(Object.assign({},Cp),e)),this.timer$=this._config$.pipe(cs("pollingIntervalMilliseconds"),Ce(i=>i?os(0,i):$e(this.getConfirmationPollingInterval()).pipe(Ce(n=>os(0,n))))),this.newBlock$=this.timer$.pipe(Ce(()=>jp(this.context)),Ru("hash"),$u(),no())}get config(){return this._config$.getValue()}getConfirmationPollingInterval(){return d(this,void 0,void 0,function*(){if(!this.config.pollingIntervalMilliseconds)try{const i=yield this.context.readProvider.getProtocolConstants("head"),s=(i.minimal_block_delay?i.minimal_block_delay.multipliedBy(1e3):i.time_between_blocks?i.time_between_blocks[0].multipliedBy(1e3):new V(5e3)).dividedBy(3);this.config.pollingIntervalMilliseconds=s.toNumber()===0?1e3:s.toNumber()}catch{return 5e3}return this.config.pollingIntervalMilliseconds})}subscribeBlock(t){return new Bi(this.newBlock$,this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribe(t){return new Bi(this.newBlock$.pipe(cs("hash")),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeOperation(t){return new Bi(this.newBlock$.pipe($p(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}}class ca{constructor(t){this.context=t}getNextProto(){return d(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}forge({branch:t,contents:e}){return d(this,void 0,void 0,function*(){return new la(yield this.getNextProto()).forge({branch:t,contents:e})})}}const Mp={defaultConfirmationCount:1,confirmationPollingTimeoutSecond:180};class Xr{constructor(t,e=new Ji,i,n=new so(Object.assign({},Mp)),s,o,a,c,l,h,p,y){this._rpc=t,this._signer=e,this._proto=i,this._config=n,this.providerDecorator=[],this.tz=new rp(this),this.estimate=new op(this),this.contract=new _p(this,this.estimate),this.batch=new ql(this,this.estimate),this.wallet=new ai(this),this.withExtensions=()=>{let E=this.clone();return this.providerDecorator.forEach(N=>{E=N(E)}),E},typeof this._rpc=="string"?this._rpcClient=new Nr(this._rpc):this._rpcClient=this._rpc,this._forger=s||new ca(this),this._injector=o||new xl(this),this.operationFactory=new ep(this),this._walletProvider=c||new ia(this),this._parser=l||new Rp(this),this._packer=a||new sa(this),this._globalConstantsProvider=h||new oa,this._readProvider=p||new aa(this),this._stream=y||new Qi(this)}get config(){return this._config.getValue()}set config(t){this._config.next(Object.assign({},t))}setPartialConfig(t){this._config.next(Object.assign(Object.assign({},this._config.getValue()),t))}get rpc(){return this._rpcClient}set rpc(t){this._rpcClient=t}get injector(){return this._injector}set injector(t){this._injector=t}get forger(){return this._forger}set forger(t){this._forger=t}get signer(){return this._signer}set signer(t){this._signer=t}get walletProvider(){return this._walletProvider}set walletProvider(t){this._walletProvider=t}set proto(t){this._proto=t}get proto(){return this._proto}get parser(){return this._parser}set parser(t){this._parser=t}get packer(){return this._packer}set packer(t){this._packer=t}get globalConstantsProvider(){return this._globalConstantsProvider}set globalConstantsProvider(t){this._globalConstantsProvider=t}get readProvider(){return this._readProvider}set readProvider(t){this._readProvider=t}get stream(){return this._stream}set stream(t){this._stream=t}isAnyProtocolActive(t=[]){return d(this,void 0,void 0,function*(){if(this._proto)return t.includes(this._proto);{const e=yield this.readProvider.getNextProtocol("head");return t.includes(e)}})}isAnySignerConfigured(){return!(this.signer instanceof Ji)}clone(){return new Xr(this.rpc,this.signer,this.proto,this._config,this.forger,this._injector,this.packer,this._walletProvider,this._parser,this._globalConstantsProvider,this._readProvider,this._stream)}registerProviderDecorator(t){this.providerDecorator.push(t)}}const Bp={commitHash:"6d90b3d5e616a6e9b9ad9dd8453b5068e7396fff",version:"13.0.1"};class Fp{packData(t){return d(this,void 0,void 0,function*(){const{bytes:e}=El(t.data,t.type);return{packed:e}})}}class Hp{constructor(t){this._rpc=t,this._options={},this.format=bn,typeof this._rpc=="string"?this._rpcClient=new Nr(this._rpc):this._rpcClient=this._rpc,this._context=new Xr(t),this._wallet=new ai(this._context),this.setProvider({rpc:this._rpcClient}),this.batch=this._context.batch.batch.bind(this._context.batch)}setProvider({rpc:t,stream:e,signer:i,protocol:n,config:s,forger:o,wallet:a,packer:c,globalConstantsProvider:l,readProvider:h}){this.setRpcProvider(t),this.setStreamProvider(e),this.setSignerProvider(i),this.setForgerProvider(o),this.setWalletProvider(a),this.setPackerProvider(c),this.setGlobalConstantsProvider(l),this.setReadProvider(h),this._context.proto=n,s&&this._context.setPartialConfig(s)}setSignerProvider(t){!this._options.signer&&typeof t>"u"?(this._context.signer=new Ji,this._options.signer=t):typeof t<"u"&&(this._context.signer=t,this._options.signer=t)}setRpcProvider(t){typeof t=="string"?this._rpcClient=new Nr(t):t===void 0||(this._rpcClient=t),this._options.rpc=this._rpcClient,this._context.rpc=this._rpcClient}setForgerProvider(t){if(typeof t<"u")this._options.forger=t,this._context.forger=t;else if(this._options.forger===void 0){const e=this.getFactory(ca)();this._options.forger=e,this._context.forger=e}}setStreamProvider(t){if(typeof t=="string"){const e=new Qi(new Xr(new Nr(t)));this._options.stream=e,this._context.stream=e}else if(typeof t<"u")this._options.stream=t,this._context.stream=t;else if(this._options.stream===void 0){const e=this.getFactory(Qi)();this._options.stream=e,this._context.stream=e}}setWalletProvider(t){if(!this._options.wallet&&typeof t>"u"){const e=this.getFactory(ia)();this._options.wallet=e,this._context.walletProvider=e}else typeof t<"u"&&(this._options.wallet=t,this._context.walletProvider=t)}setPackerProvider(t){if(!this._options.packer&&typeof t>"u"){const e=this.getFactory(sa)();this._context.packer=e,this._options.packer=e}else typeof t<"u"&&(this._context.packer=t,this._options.packer=t)}setGlobalConstantsProvider(t){if(!this._options.globalConstantsProvider&&typeof t>"u"){const e=new oa;this._context.globalConstantsProvider=e,this._options.globalConstantsProvider=e}else typeof t<"u"&&(this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t)}setReadProvider(t){const e=typeof t>"u"?this.getFactory(aa)():t;this._options.readProvider=e,this._context.readProvider=e}get tz(){return this._context.tz}get contract(){return this._context.contract}get wallet(){return this._wallet}get operation(){return this._context.operationFactory}get estimate(){return this._context.estimate}get stream(){return this._context.stream}get rpc(){return this._context.rpc}get signer(){return this._context.signer}get globalConstants(){return this._context.globalConstantsProvider}addExtension(t){Array.isArray(t)?t.forEach(e=>e.configureContext(this._context)):t.configureContext(this._context)}getFactory(t){return(...e)=>new t(this._context,...e)}getVersionInfo(){return Bp}}export{bc as H,Fp as M,gt as S,Hp as T,Gr as a,zr as b,qr as c};
